# PDS (Personal Data Server) Provisioning Configuration
# Add these variables to your .env file

# ========================================
# Core PDS Configuration
# ========================================

# Enable/disable PDS provisioning system
PDS_PROVISIONING_ENABLED=true

# PDS Mode: local | remote | hybrid
# - local: Run PDS locally (requires PDS server)
# - remote: Use external PDS provider (Bluesky)
# - hybrid: Try local first, fallback to remote
PDS_MODE=local

# Root domain for PDS instances
# DIDs will be: did:web:username-SUFFIX.${PDS_DOMAIN}
# Handles will be: @username.${PDS_DOMAIN}
PDS_DOMAIN=pnptv.app

# ========================================
# Encryption Configuration
# ========================================

# AES-256-GCM encryption key for credential storage
# Generate with: head -c 32 /dev/urandom | base64
# MUST be 32 bytes (256 bits)
PDS_ENCRYPTION_KEY=YourBase64EncodedEncryptionKeyHere

# Key rotation interval (days)
# Keys will be rotated automatically every N days
PDS_KEY_ROTATION_DAYS=90

# ========================================
# Local PDS Configuration
# ========================================

# Endpoint for local PDS server
# Must be reachable from application server
# Default: http://127.0.0.1:3000
PDS_LOCAL_ENDPOINT=http://127.0.0.1:3000

# Admin DID for local PDS provisioning requests
# Format: did:web:admin.pnptv.app (or similar)
PDS_ADMIN_DID=did:web:admin.pnptv.app

# Admin password for local PDS API
# Use a strong, randomly generated password
PDS_ADMIN_PASSWORD=your-secure-admin-password-here

# ========================================
# Remote PDS Configuration
# ========================================

# Remote PDS provider endpoint (fallback/hybrid mode)
# Default: https://pds.bluesky.social
PDS_REMOTE_PROVIDER=https://pds.bluesky.social

# Optional: Auth token for remote provider (if required)
# PDS_REMOTE_AUTH_TOKEN=your-auth-token

# ========================================
# Provisioning Behavior
# ========================================

# Maximum retry attempts for failed provisioning
PDS_MAX_RETRY_ATTEMPTS=3

# Initial retry delay in seconds
# Subsequent retries use exponential backoff
PDS_RETRY_DELAY_SECONDS=300

# Allow automatic retry of failed provisioning
PDS_ALLOW_AUTO_RETRY=true

# Block login if PDS provisioning fails (false = allow login)
PDS_BLOCK_LOGIN_ON_FAILURE=false

# ========================================
# Health Check Configuration
# ========================================

# How often to check PDS health (minutes)
PDS_HEALTH_CHECK_INTERVAL_MINUTES=60

# Health check timeout (seconds)
PDS_HEALTH_CHECK_TIMEOUT_SECONDS=10

# Number of failures before marking PDS as inaccessible
PDS_HEALTH_CHECK_FAILURE_THRESHOLD=3

# ========================================
# Backup Configuration
# ========================================

# Automatic backup interval (hours)
# 0 = only backup on provisioning
PDS_BACKUP_INTERVAL_HOURS=24

# Backup retention period (days)
PDS_BACKUP_RETENTION_DAYS=30

# ========================================
# Security Configuration
# ========================================

# Require 2FA to view PDS credentials
# false = show basic info, require 2FA for sensitive data
PDS_REQUIRE_2FA_FOR_CREDENTIALS=true

# Allow manual credential export (requires 2FA)
PDS_ALLOW_CREDENTIAL_EXPORT=true

# Audit log retention period (days)
PDS_AUDIT_LOG_RETENTION_DAYS=90

# ========================================
# Session Configuration
# ========================================

# Session secret for PDS session cookie
# MUST be different from JWT_SECRET
SESSION_SECRET=your-session-secret-key-here

# Session timeout (milliseconds)
# Default: 7 days
SESSION_MAX_AGE=604800000

# ========================================
# Development/Testing
# ========================================

# Enable verbose PDS logging
DEBUG_PDS=false

# Simulate provisioning failures (for testing)
# SIMULATION_FAILURE_RATE=0.1  # 10% failure rate

# Skip PDS provisioning (for testing without PDS)
# SKIP_PDS_PROVISIONING=false

# ========================================
# Monitoring
# ========================================

# Enable PDS metrics collection
PDS_METRICS_ENABLED=true

# Send alerts for critical failures
PDS_ALERTS_ENABLED=true

# Admin email for PDS alerts
PDS_ALERT_EMAIL=admin@pnptv.app

# ========================================
# Feature Flags
# ========================================

# Enable user-initiated PDS recovery
PDS_RECOVERY_ENABLED=true

# Enable PDS export/import
PDS_IMPORT_EXPORT_ENABLED=false

# Enable federation with external networks
PDS_FEDERATION_ENABLED=false

# Enable multi-signature for key rotation
PDS_MULTI_SIG_ENABLED=false
