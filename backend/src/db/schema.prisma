// path: backend/src/db/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String    @id @default(uuid())
  telegramId       String    @unique
  username         String?
  firstName        String?
  photoUrl         String?
  role             Role      @default(FREE)
  acceptedTermsAt  DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  memberships      Membership[]
  rooms            Room[]
  collections     Collection[]
}

model Membership {
  id            String   @id @default(uuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  plan          String
  status        String
  expiresAt     DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Room {
  id            String   @id @default(uuid())
  title         String
  visibility    Visibility
  status        Status   @default(OPEN)
  hostId        String
  host          User     @relation(fields: [hostId], references: [id])
  channelName   String   @unique
  joinTokenHash String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Collection {
  id            String   @id @default(uuid())
  type          Type
  title         String
  description   String?
  ownerId       String
  owner         User     @relation(fields: [ownerId], references: [id])
  visibility    Visibility
  items         Item[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Item {
  id          String   @id @default(uuid())
  collectionId String
  collection   Collection @relation(fields: [collectionId], references: [id])
  title        String
  url          String
  duration     Int?
  meta         Json?
  createdAt    DateTime @default(now())
}

enum Role {
  FREE
  PRIME
  ADMIN
}

enum Visibility {
  PUBLIC
  PRIVATE
  PRIME
}

enum Status {
  OPEN
  CLOSED
}

enum Type {
  PLAYLIST
  PODCAST
}