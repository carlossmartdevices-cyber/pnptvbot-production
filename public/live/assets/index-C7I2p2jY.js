import{r as se,a as re,g as ne,L as ie,M as z,P as R,b as Q,V as Z,c as o,X as ae,S as oe,d as q,e as le,R as A,f as ee,h as te,i as ce,j as de,C as ue,k as me,E as he,H as pe,l as fe,m as xe}from"./vendor-Ba3bi-Og.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();var D={exports:{}},T={};var H;function ge(){if(H)return T;H=1;var t=se(),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function h(m,c,y){var l,v={},f=null,g=null;y!==void 0&&(f=""+y),c.key!==void 0&&(f=""+c.key),c.ref!==void 0&&(g=c.ref);for(l in c)i.call(c,l)&&!a.hasOwnProperty(l)&&(v[l]=c[l]);if(m&&m.defaultProps)for(l in c=m.defaultProps,c)v[l]===void 0&&(v[l]=c[l]);return{$$typeof:r,type:m,key:f,ref:g,props:v,_owner:n.current}}return T.Fragment=s,T.jsx=h,T.jsxs=h,T}var X;function je(){return X||(X=1,D.exports=ge()),D.exports}var e=je(),M={},G;function ye(){if(G)return M;G=1;var t=re();return M.createRoot=t.createRoot,M.hydrateRoot=t.hydrateRoot,M}var ve=ye();const Ne=ne(ve);(function(){const r=window.Telegram?.WebApp,s=document.documentElement;if(r){const i=r.themeParams||{},n=(a,h)=>{h&&s.style.setProperty(a,h)};n("--tg-bg",i.bg_color),n("--tg-text",i.text_color),n("--tg-hint",i.hint_color),n("--tg-link",i.link_color),n("--tg-button",i.button_color),n("--tg-button-text",i.button_text_color),n("--tg-secondary-bg",i.secondary_bg_color),r.expand(),r.ready()}else s.style.setProperty("--tg-bg","#1c1c1e"),s.style.setProperty("--tg-text","#f5f5f7"),s.style.setProperty("--tg-hint","#8e8e93"),s.style.setProperty("--tg-link","#0a84ff"),s.style.setProperty("--tg-button","#0a84ff"),s.style.setProperty("--tg-button-text","#ffffff"),s.style.setProperty("--tg-secondary-bg","#2c2c2e")})();function we({title:t,telegramUser:r,onLogout:s}){return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-logo",children:[e.jsx("div",{className:"logo-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"15",rx:"2",ry:"2"}),e.jsx("polyline",{points:"17 2 12 7 7 2"})]})}),e.jsx("div",{className:"header-text",children:e.jsx("h1",{children:t})})]}),e.jsx("div",{className:"header-user-info",children:r&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"user-greeting",children:r.name}),e.jsx("button",{onClick:s,className:"logout-button",title:"Logout",children:e.jsx(ie,{size:15})})]})})]})}function be(t){if(!t)return"";const r=Math.floor(t/60),s=t%60;if(r>=60){const i=Math.floor(r/60),n=r%60;return`${i}:${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}return`${r}:${s.toString().padStart(2,"0")}`}function Pe(t){switch(t){case"video":return Z;case"audio":return z;case"podcast":return Q;default:return z}}function ke({media:t,onSelect:r}){return!t||t.length===0?e.jsx("div",{className:"media-grid empty",children:e.jsxs("div",{className:"empty-state",children:[e.jsx(z,{size:48}),e.jsx("h3",{children:"No media found"}),e.jsx("p",{children:"Check back later for new content!"})]})}):e.jsx("div",{className:"media-grid",children:t.map(s=>{const i=Pe(s.type);return e.jsxs("div",{className:`media-card ${s.type}`,onClick:()=>r(s),children:[e.jsxs("div",{className:"media-thumbnail",children:[s.cover_url?e.jsx("img",{src:s.cover_url,alt:s.title,loading:"lazy"}):e.jsx("div",{className:"thumbnail-placeholder",children:e.jsx(i,{size:32})}),e.jsx("div",{className:"media-overlay",children:e.jsx("button",{className:"play-btn",children:e.jsx(R,{size:24,fill:"white"})})}),s.duration&&e.jsx("span",{className:"media-duration",children:be(s.duration)}),e.jsx("span",{className:"media-type-badge",children:e.jsx(i,{size:12})})]}),e.jsxs("div",{className:"media-info",children:[e.jsx("h3",{className:"media-title",children:s.title}),e.jsx("p",{className:"media-artist",children:s.artist||"Unknown Artist"}),s.category&&e.jsx("span",{className:"media-category",children:s.category})]})]},s.id)})})}function Se({media:t,onClose:r,radioNowPlaying:s,onRadioToggle:i}){const[n,a]=o.useState(!1),[h,m]=o.useState(0),[c,y]=o.useState(0),[l,v]=o.useState(1),[f,g]=o.useState(!1),[E,_]=o.useState(!1),[J,b]=o.useState(!0),d=o.useRef(null),P=o.useRef(null),k=o.useRef(null),S=t.type==="video",L=t.type==="audio"||t.type==="podcast";o.useEffect(()=>{d.current&&t.url&&d.current.load()},[t]),o.useEffect(()=>{const x=()=>{b(!0),clearTimeout(k.current),k.current=setTimeout(()=>{n&&b(!1)},3e3)};return document.addEventListener("mousemove",x),()=>{document.removeEventListener("mousemove",x),clearTimeout(k.current)}},[n]);function j(){d.current&&(n?d.current.pause():d.current.play(),a(!n))}function N(){d.current&&m(d.current.currentTime)}function C(){d.current&&y(d.current.duration)}function $(x){const p=x.currentTarget.getBoundingClientRect(),W=(x.clientX-p.left)/p.width*c;d.current&&(d.current.currentTime=W,m(W))}function F(){d.current&&(d.current.muted=!f,g(!f))}function O(x){const p=parseFloat(x.target.value);v(p),d.current&&(d.current.volume=p,g(p===0))}function U(){document.fullscreenElement?(document.exitFullscreen(),_(!1)):(P.current?.requestFullscreen(),_(!0))}function V(x){d.current&&(d.current.currentTime=Math.max(0,Math.min(c,h+x)))}function u(x){const p=Math.floor(x/60),B=Math.floor(x%60);return`${p}:${B.toString().padStart(2,"0")}`}const w=c>0?h/c*100:0;return e.jsxs("div",{className:`video-player-container ${E?"fullscreen":""}`,ref:P,children:[e.jsx("button",{className:"player-close-btn",onClick:r,children:e.jsx(ae,{size:24})}),e.jsxs("div",{className:"player-media",children:[S&&t.url?e.jsx("video",{ref:d,className:"video-element",onTimeUpdate:N,onLoadedMetadata:C,onEnded:()=>a(!1),onClick:j,children:e.jsx("source",{src:t.url,type:"video/mp4"})}):e.jsxs("div",{className:"audio-display",children:[t.cover_url?e.jsx("img",{src:t.cover_url,alt:t.title,className:"audio-cover"}):e.jsx("div",{className:"audio-placeholder",children:e.jsx(R,{size:64})}),L&&t.url&&e.jsx("audio",{ref:d,onTimeUpdate:N,onLoadedMetadata:C,onEnded:()=>a(!1),children:e.jsx("source",{src:t.url,type:"audio/mpeg"})})]}),!n&&e.jsx("div",{className:"player-overlay",onClick:j,children:e.jsx("button",{className:"big-play-btn",children:e.jsx(R,{size:48,fill:"white"})})})]}),e.jsxs("div",{className:"player-info",children:[e.jsx("h2",{children:t.title}),e.jsx("p",{children:t.artist||"Unknown Artist"})]}),e.jsxs("div",{className:`player-controls ${J?"visible":""}`,children:[e.jsxs("div",{className:"progress-container",onClick:$,children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-filled",style:{width:`${w}%`}})}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{children:u(h)}),e.jsx("span",{children:u(c)})]})]}),e.jsxs("div",{className:"controls-row",children:[e.jsxs("div",{className:"controls-left",children:[e.jsx("button",{onClick:()=>V(-10),title:"Rewind 10s",children:e.jsx(oe,{size:20})}),e.jsx("button",{className:"play-pause-btn",onClick:j,children:n?e.jsx(q,{size:28}):e.jsx(R,{size:28,fill:"white"})}),e.jsx("button",{onClick:()=>V(10),title:"Forward 10s",children:e.jsx(le,{size:20})})]}),e.jsx("div",{className:"controls-center",children:s&&e.jsxs("button",{className:"radio-switch-btn",onClick:i,children:[e.jsx(A,{size:18}),e.jsx("span",{children:"Radio"})]})}),e.jsxs("div",{className:"controls-right",children:[e.jsxs("div",{className:"volume-control",children:[e.jsx("button",{onClick:F,children:f||l===0?e.jsx(ee,{size:20}):e.jsx(te,{size:20})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:f?0:l,onChange:O,className:"volume-slider"})]}),S&&e.jsx("button",{onClick:U,children:E?e.jsx(ce,{size:20}):e.jsx(de,{size:20})})]})]})]})]})}function K({nowPlaying:t,isExpanded:r,onToggle:s}){const[i,n]=o.useState(!1),[a,h]=o.useState(!1);if(!t)return null;const m=t.track||{},c=t.listenerCount||0;function y(){const l=window.location.origin+"/radio/";window.open(l,"_blank")}return e.jsxs("div",{className:`mini-radio-player ${r?"expanded":""}`,children:[e.jsxs("div",{className:"mini-radio-bar",onClick:s,children:[e.jsxs("div",{className:"mini-radio-info",children:[e.jsx("div",{className:"radio-icon-pulse",children:e.jsx(A,{size:16})}),e.jsxs("div",{className:"mini-track-info",children:[e.jsx("span",{className:"mini-track-title",children:m.title||"PNPtv Radio"}),e.jsx("span",{className:"mini-track-artist",children:m.artist||"Live 24/7"})]})]}),e.jsxs("div",{className:"mini-radio-actions",children:[e.jsx("button",{className:"mini-play-btn",onClick:l=>{l.stopPropagation(),n(!i)},children:i?e.jsx(q,{size:18}):e.jsx(R,{size:18,fill:"white"})}),r?e.jsx(ue,{size:20}):e.jsx(me,{size:20})]})]}),r&&e.jsxs("div",{className:"mini-radio-expanded",children:[e.jsxs("div",{className:"radio-now-playing",children:[m.thumbnailUrl?e.jsx("img",{src:m.thumbnailUrl,alt:m.title,className:"radio-thumb"}):e.jsx("div",{className:"radio-thumb-placeholder",children:e.jsx(A,{size:32})}),e.jsxs("div",{className:"radio-track-details",children:[e.jsx("h4",{children:"Now Playing"}),e.jsx("p",{className:"radio-track-title",children:m.title||"Unknown Track"}),e.jsx("p",{className:"radio-track-artist",children:m.artist||"Unknown Artist"})]})]}),e.jsxs("div",{className:"radio-controls",children:[e.jsx("button",{className:`radio-play-btn ${i?"playing":""}`,onClick:()=>n(!i),children:i?e.jsx(q,{size:24}):e.jsx(R,{size:24,fill:"white"})}),e.jsx("button",{className:"radio-mute-btn",onClick:()=>h(!a),children:a?e.jsx(ee,{size:20}):e.jsx(te,{size:20})})]}),e.jsxs("div",{className:"radio-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:c}),e.jsx("span",{className:"stat-label",children:"Listeners"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value live-badge",children:"LIVE"}),e.jsx("span",{className:"stat-label",children:"24/7"})]})]}),e.jsxs("button",{className:"open-radio-btn",onClick:y,children:[e.jsx(he,{size:16}),e.jsx("span",{children:"Open Full Player"})]})]})]})}const Ce=[{id:"all",label:"All",icon:pe},{id:"featured",label:"Featured",icon:fe},{id:"videos",label:"Videos",icon:Z},{id:"music",label:"Music",icon:z},{id:"podcast",label:"Podcasts",icon:Q},{id:"radio",label:"Radio",icon:A}];function Re({selected:t,onChange:r,radioActive:s}){return e.jsx("nav",{className:"category-nav",children:e.jsx("div",{className:"category-scroll",children:Ce.map(i=>{const n=i.icon,a=i.id==="radio";return e.jsxs("button",{className:`category-btn ${t===i.id?"active":""} ${a&&s?"live":""}`,onClick:()=>r(i.id),children:[e.jsx(n,{size:18}),e.jsx("span",{children:i.label}),a&&s&&e.jsx("span",{className:"live-dot"})]},i.id)})})})}const I=window.location.hostname==="localhost"?"http://localhost:3000/api":"/api";async function _e(t="all",r=null){try{let s=`${I}/media/library?type=${t}`;r&&(s+=`&category=${r}`);const i=await fetch(s);if(!i.ok)throw new Error("Failed to fetch media");return await i.json()}catch(s){return console.error("Error fetching media library:",s),[]}}async function Te(){try{const t=await fetch(`${I}/radio/now-playing`);if(!t.ok)throw new Error("Failed to fetch now playing");return await t.json()}catch(t){return console.error("Error fetching radio now playing:",t),null}}function Ee(){const t=new URLSearchParams(window.location.search);return{token:t.get("token"),uid:t.get("uid"),view:t.get("view")||"home",mediaId:t.get("id"),role:t.get("role")||"",isPrime:t.get("prime")==="true"||t.get("isPrime")==="true"}}async function Le(){try{const t=await fetch(`${I}/telegram-auth/check`);return t.ok&&(await t.json()).user||null}catch(t){return console.error("Error fetching Telegram user:",t),null}}function Me(t){if(t.current&&window.TelegramLoginWidget){const r=document.createElement("script");r.src="https://telegram.org/js/telegram-widget.js?22",r.setAttribute("data-telegram-bot","PNPtv_bot"),r.setAttribute("data-size","large"),r.setAttribute("data-onauth","window.onTelegramAuth(user)"),r.setAttribute("data-request-access","write"),t.current.innerHTML="",t.current.appendChild(r)}}async function ze(t,r,s,i){s(!0);try{const a=await(await fetch(`${I}/telegram-auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();a.success?r(a.user):i(a.message||"Telegram login failed.")}catch(n){console.error("Error during Telegram auth:",n),i("Network error during Telegram login.")}finally{s(!1)}}const Ae=({onAuthSuccess:t,authLoading:r})=>{const s=o.useRef(null);return o.useEffect(()=>{r||Me(s)},[r]),e.jsx("div",{className:"login-container",children:e.jsxs("div",{className:"login-card",children:[e.jsx("h1",{className:"login-title",children:"PNPtv Live"}),e.jsx("p",{className:"login-subtitle",children:"Log in with Telegram to continue"}),r?e.jsx("div",{className:"loading-container",children:e.jsx("div",{className:"spinner"})}):e.jsx("div",{ref:s,className:"telegram-login-widget"})]})})},Y=[{id:"1",title:"Welcome to PNPtv",artist:"PNPtv Team",type:"video",category:"featured",duration:180,cover_url:"https://picsum.photos/seed/pnp1/400/225",url:"https://www.w3schools.com/html/mov_bbb.mp4"},{id:"2",title:"Community Highlights",artist:"PNPtv Community",type:"video",category:"featured",duration:240,cover_url:"https://picsum.photos/seed/pnp2/400/225",url:"https://www.w3schools.com/html/movie.mp4"},{id:"3",title:"Latin Vibes Mix",artist:"DJ PNP",type:"audio",category:"music",duration:3600,cover_url:"https://picsum.photos/seed/pnp3/400/400",url:""},{id:"4",title:"PNPtv Podcast Ep. 1",artist:"The PNP Crew",type:"audio",category:"podcast",duration:2400,cover_url:"https://picsum.photos/seed/pnp4/400/400",url:""},{id:"5",title:"Best of the Week",artist:"Various Artists",type:"video",category:"videos",duration:600,cover_url:"https://picsum.photos/seed/pnp5/400/225",url:"https://www.w3schools.com/html/mov_bbb.mp4"},{id:"6",title:"Dance Party Mix",artist:"DJ Latino",type:"audio",category:"music",duration:4200,cover_url:"https://picsum.photos/seed/pnp6/400/400",url:""}];function Ie(){const[t,r]=o.useState(null),[s,i]=o.useState("home"),[n,a]=o.useState("all"),[h,m]=o.useState([]),[c,y]=o.useState(null),[l,v]=o.useState(null),[f,g]=o.useState(!1),[E,_]=o.useState(!0),[J,b]=o.useState(null),[d,P]=o.useState(null),[k,S]=o.useState(!0),[L,j]=o.useState(!1);o.useRef(null),o.useEffect(()=>{const u=Ee();r(u),i(u.view||"home"),(async()=>{S(!0);try{const p=await Le();p?(P(p),j(!0),N(),C()):j(!1)}catch(p){b(p.message),j(!1)}finally{S(!1)}})(),window.onTelegramAuth=async p=>{await ze(p,P,S,b),j(!0),N(),C()};const x=setInterval(C,3e4);return()=>{clearInterval(x)}},[L]);async function N(u=null){_(!0);try{const w=await _e("all",u);m(w.length>0?w:Y)}catch(w){console.error("Failed to load media, using demo data:",w),m(Y)}_(!1)}async function C(){try{const u=await Te();v(u)}catch(u){console.error("Failed to load radio status:",u)}}function $(u){a(u),u==="all"?N():u==="radio"?g(!0):N(u)}function F(u){y(u),i("player")}const O=async()=>{try{await fetch("/api/logout",{method:"POST"}),P(null),j(!1)}catch(u){console.error("Logout failed:",u),b("Failed to log out.")}};function U(){y(null),i("home")}return k?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[e.jsx("div",{className:"spinner-lg"}),e.jsx("p",{className:"text-muted-foreground mt-4",children:"Loading authentication..."})]}):L?s==="player"&&c?e.jsxs(e.Fragment,{children:[e.jsx(Se,{media:c,onClose:U,radioNowPlaying:l,onRadioToggle:()=>g(!f)}),l&&e.jsx(K,{nowPlaying:l,isExpanded:f,onToggle:()=>g(!f)})]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{title:"PNPtv Live",telegramUser:d,onLogout:O}),e.jsxs("main",{className:"container",children:[e.jsx(Re,{selected:n,onChange:$,radioActive:l!==null}),E?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx("div",{className:"spinner-lg"}),e.jsx("p",{className:"text-muted-foreground mt-4",children:"Loading media..."})]}):e.jsx(ke,{media:filteredMedia,onSelect:F}),l&&e.jsx(K,{nowPlaying:l,isExpanded:f,onToggle:()=>g(!f)})]})]}):e.jsx(Ae,{onAuthSuccess:()=>j(!0),authLoading:k})}Ne.createRoot(document.getElementById("root")).render(e.jsx(xe.StrictMode,{children:e.jsx(Ie,{})}));
