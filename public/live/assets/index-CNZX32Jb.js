import{r as te,a as re,g as ie,T as ae,U as ne,L as oe,M as z,P as R,b as Q,V as Z,c as n,X as le,S as ce,d as q,e as de,R as A,f as ee,h as se,i as ue,j as me,C as he,k as pe,E as xe,H as fe,l as je,m as ge}from"./vendor-nnExV_hp.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&a(f)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var D={exports:{}},E={};var H;function ve(){if(H)return E;H=1;var s=te(),r=Symbol.for("react.element"),t=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function f(m,c,v){var l,y={},p=null,j=null;v!==void 0&&(p=""+v),c.key!==void 0&&(p=""+c.key),c.ref!==void 0&&(j=c.ref);for(l in c)a.call(c,l)&&!o.hasOwnProperty(l)&&(y[l]=c[l]);if(m&&m.defaultProps)for(l in c=m.defaultProps,c)y[l]===void 0&&(y[l]=c[l]);return{$$typeof:r,type:m,key:p,ref:j,props:y,_owner:i.current}}return E.Fragment=t,E.jsx=f,E.jsxs=f,E}var X;function ye(){return X||(X=1,D.exports=ve()),D.exports}var e=ye(),_={},G;function Ne(){if(G)return _;G=1;var s=re();return _.createRoot=s.createRoot,_.hydrateRoot=s.hydrateRoot,_}var we=Ne();const be=ie(we);function Pe({title:s,subtitle:r,telegramUser:t,onLogout:a,loginRef:i}){return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-logo",children:[e.jsx("div",{className:"logo-icon",children:e.jsx(ae,{size:28})}),e.jsxs("div",{className:"header-text",children:[e.jsx("h1",{children:s}),e.jsx("p",{children:r})]})]}),e.jsx("div",{className:"header-user-info",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"user-greeting",children:[e.jsx(ne,{size:16}),e.jsxs("span",{children:["Welcome, ",t.name]})]}),e.jsxs("button",{onClick:a,className:"logout-button",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:"Logout"})]})]}):e.jsx("div",{ref:i})})]})}function Se(s){if(!s)return"";const r=Math.floor(s/60),t=s%60;if(r>=60){const a=Math.floor(r/60),i=r%60;return`${a}:${i.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}return`${r}:${t.toString().padStart(2,"0")}`}function Ce(s){switch(s){case"video":return Z;case"audio":return z;case"podcast":return Q;default:return z}}function ke({media:s,onSelect:r}){return!s||s.length===0?e.jsx("div",{className:"media-grid empty",children:e.jsxs("div",{className:"empty-state",children:[e.jsx(z,{size:48}),e.jsx("h3",{children:"No media found"}),e.jsx("p",{children:"Check back later for new content!"})]})}):e.jsx("div",{className:"media-grid",children:s.map(t=>{const a=Ce(t.type);return e.jsxs("div",{className:`media-card ${t.type}`,onClick:()=>r(t),children:[e.jsxs("div",{className:"media-thumbnail",children:[t.cover_url?e.jsx("img",{src:t.cover_url,alt:t.title,loading:"lazy"}):e.jsx("div",{className:"thumbnail-placeholder",children:e.jsx(a,{size:32})}),e.jsx("div",{className:"media-overlay",children:e.jsx("button",{className:"play-btn",children:e.jsx(R,{size:24,fill:"white"})})}),t.duration&&e.jsx("span",{className:"media-duration",children:Se(t.duration)}),e.jsx("span",{className:"media-type-badge",children:e.jsx(a,{size:12})})]}),e.jsxs("div",{className:"media-info",children:[e.jsx("h3",{className:"media-title",children:t.title}),e.jsx("p",{className:"media-artist",children:t.artist||"Unknown Artist"}),t.category&&e.jsx("span",{className:"media-category",children:t.category})]})]},t.id)})})}function Re({media:s,onClose:r,radioNowPlaying:t,onRadioToggle:a}){const[i,o]=n.useState(!1),[f,m]=n.useState(0),[c,v]=n.useState(0),[l,y]=n.useState(1),[p,j]=n.useState(!1),[M,T]=n.useState(!1),[J,b]=n.useState(!0),d=n.useRef(null),P=n.useRef(null),S=n.useRef(null),C=s.type==="video",L=s.type==="audio"||s.type==="podcast";n.useEffect(()=>{d.current&&s.url&&d.current.load()},[s]),n.useEffect(()=>{const x=()=>{b(!0),clearTimeout(S.current),S.current=setTimeout(()=>{i&&b(!1)},3e3)};return document.addEventListener("mousemove",x),()=>{document.removeEventListener("mousemove",x),clearTimeout(S.current)}},[i]);function g(){d.current&&(i?d.current.pause():d.current.play(),o(!i))}function N(){d.current&&m(d.current.currentTime)}function k(){d.current&&v(d.current.duration)}function $(x){const h=x.currentTarget.getBoundingClientRect(),W=(x.clientX-h.left)/h.width*c;d.current&&(d.current.currentTime=W,m(W))}function I(){d.current&&(d.current.muted=!p,j(!p))}function F(x){const h=parseFloat(x.target.value);y(h),d.current&&(d.current.volume=h,j(h===0))}function U(){document.fullscreenElement?(document.exitFullscreen(),T(!1)):(P.current?.requestFullscreen(),T(!0))}function V(x){d.current&&(d.current.currentTime=Math.max(0,Math.min(c,f+x)))}function u(x){const h=Math.floor(x/60),B=Math.floor(x%60);return`${h}:${B.toString().padStart(2,"0")}`}const w=c>0?f/c*100:0;return e.jsxs("div",{className:`video-player-container ${M?"fullscreen":""}`,ref:P,children:[e.jsx("button",{className:"player-close-btn",onClick:r,children:e.jsx(le,{size:24})}),e.jsxs("div",{className:"player-media",children:[C&&s.url?e.jsx("video",{ref:d,className:"video-element",onTimeUpdate:N,onLoadedMetadata:k,onEnded:()=>o(!1),onClick:g,children:e.jsx("source",{src:s.url,type:"video/mp4"})}):e.jsxs("div",{className:"audio-display",children:[s.cover_url?e.jsx("img",{src:s.cover_url,alt:s.title,className:"audio-cover"}):e.jsx("div",{className:"audio-placeholder",children:e.jsx(R,{size:64})}),L&&s.url&&e.jsx("audio",{ref:d,onTimeUpdate:N,onLoadedMetadata:k,onEnded:()=>o(!1),children:e.jsx("source",{src:s.url,type:"audio/mpeg"})})]}),!i&&e.jsx("div",{className:"player-overlay",onClick:g,children:e.jsx("button",{className:"big-play-btn",children:e.jsx(R,{size:48,fill:"white"})})})]}),e.jsxs("div",{className:"player-info",children:[e.jsx("h2",{children:s.title}),e.jsx("p",{children:s.artist||"Unknown Artist"})]}),e.jsxs("div",{className:`player-controls ${J?"visible":""}`,children:[e.jsxs("div",{className:"progress-container",onClick:$,children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-filled",style:{width:`${w}%`}})}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{children:u(f)}),e.jsx("span",{children:u(c)})]})]}),e.jsxs("div",{className:"controls-row",children:[e.jsxs("div",{className:"controls-left",children:[e.jsx("button",{onClick:()=>V(-10),title:"Rewind 10s",children:e.jsx(ce,{size:20})}),e.jsx("button",{className:"play-pause-btn",onClick:g,children:i?e.jsx(q,{size:28}):e.jsx(R,{size:28,fill:"white"})}),e.jsx("button",{onClick:()=>V(10),title:"Forward 10s",children:e.jsx(de,{size:20})})]}),e.jsx("div",{className:"controls-center",children:t&&e.jsxs("button",{className:"radio-switch-btn",onClick:a,children:[e.jsx(A,{size:18}),e.jsx("span",{children:"Radio"})]})}),e.jsxs("div",{className:"controls-right",children:[e.jsxs("div",{className:"volume-control",children:[e.jsx("button",{onClick:I,children:p||l===0?e.jsx(ee,{size:20}):e.jsx(se,{size:20})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:p?0:l,onChange:F,className:"volume-slider"})]}),C&&e.jsx("button",{onClick:U,children:M?e.jsx(ue,{size:20}):e.jsx(me,{size:20})})]})]})]})]})}function Y({nowPlaying:s,isExpanded:r,onToggle:t}){const[a,i]=n.useState(!1),[o,f]=n.useState(!1);if(!s)return null;const m=s.track||{},c=s.listenerCount||0;function v(){const l=window.location.origin+"/radio/";window.open(l,"_blank")}return e.jsxs("div",{className:`mini-radio-player ${r?"expanded":""}`,children:[e.jsxs("div",{className:"mini-radio-bar",onClick:t,children:[e.jsxs("div",{className:"mini-radio-info",children:[e.jsx("div",{className:"radio-icon-pulse",children:e.jsx(A,{size:16})}),e.jsxs("div",{className:"mini-track-info",children:[e.jsx("span",{className:"mini-track-title",children:m.title||"PNPtv Radio"}),e.jsx("span",{className:"mini-track-artist",children:m.artist||"Live 24/7"})]})]}),e.jsxs("div",{className:"mini-radio-actions",children:[e.jsx("button",{className:"mini-play-btn",onClick:l=>{l.stopPropagation(),i(!a)},children:a?e.jsx(q,{size:18}):e.jsx(R,{size:18,fill:"white"})}),r?e.jsx(he,{size:20}):e.jsx(pe,{size:20})]})]}),r&&e.jsxs("div",{className:"mini-radio-expanded",children:[e.jsxs("div",{className:"radio-now-playing",children:[m.thumbnailUrl?e.jsx("img",{src:m.thumbnailUrl,alt:m.title,className:"radio-thumb"}):e.jsx("div",{className:"radio-thumb-placeholder",children:e.jsx(A,{size:32})}),e.jsxs("div",{className:"radio-track-details",children:[e.jsx("h4",{children:"Now Playing"}),e.jsx("p",{className:"radio-track-title",children:m.title||"Unknown Track"}),e.jsx("p",{className:"radio-track-artist",children:m.artist||"Unknown Artist"})]})]}),e.jsxs("div",{className:"radio-controls",children:[e.jsx("button",{className:`radio-play-btn ${a?"playing":""}`,onClick:()=>i(!a),children:a?e.jsx(q,{size:24}):e.jsx(R,{size:24,fill:"white"})}),e.jsx("button",{className:"radio-mute-btn",onClick:()=>f(!o),children:o?e.jsx(ee,{size:20}):e.jsx(se,{size:20})})]}),e.jsxs("div",{className:"radio-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:c}),e.jsx("span",{className:"stat-label",children:"Listeners"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value live-badge",children:"LIVE"}),e.jsx("span",{className:"stat-label",children:"24/7"})]})]}),e.jsxs("button",{className:"open-radio-btn",onClick:v,children:[e.jsx(xe,{size:16}),e.jsx("span",{children:"Open Full Player"})]})]})]})}const Te=[{id:"all",label:"All",icon:fe},{id:"featured",label:"Featured",icon:je},{id:"videos",label:"Videos",icon:Z},{id:"music",label:"Music",icon:z},{id:"podcast",label:"Podcasts",icon:Q},{id:"radio",label:"Radio",icon:A}];function Ee({selected:s,onChange:r,radioActive:t}){return e.jsx("nav",{className:"category-nav",children:e.jsx("div",{className:"category-scroll",children:Te.map(a=>{const i=a.icon,o=a.id==="radio";return e.jsxs("button",{className:`category-btn ${s===a.id?"active":""} ${o&&t?"live":""}`,onClick:()=>r(a.id),children:[e.jsx(i,{size:18}),e.jsx("span",{children:a.label}),o&&t&&e.jsx("span",{className:"live-dot"})]},a.id)})})})}const O=window.location.hostname==="localhost"?"http://localhost:3000/api":"/api";async function Me(s="all",r=null){try{let t=`${O}/media/library?type=${s}`;r&&(t+=`&category=${r}`);const a=await fetch(t);if(!a.ok)throw new Error("Failed to fetch media");return await a.json()}catch(t){return console.error("Error fetching media library:",t),[]}}async function Le(){try{const s=await fetch(`${O}/radio/now-playing`);if(!s.ok)throw new Error("Failed to fetch now playing");return await s.json()}catch(s){return console.error("Error fetching radio now playing:",s),null}}function _e(){const s=new URLSearchParams(window.location.search);return{token:s.get("token"),uid:s.get("uid"),view:s.get("view")||"home",mediaId:s.get("id"),role:s.get("role")||"",isPrime:s.get("prime")==="true"||s.get("isPrime")==="true"}}async function ze(){try{const s=await fetch(`${O}/telegram-auth/check`);return s.ok&&(await s.json()).user||null}catch(s){return console.error("Error fetching Telegram user:",s),null}}function Ae(s){if(s.current&&window.TelegramLoginWidget){const r=document.createElement("script");r.src="https://telegram.org/js/telegram-widget.js?22",r.setAttribute("data-telegram-bot","PNPtv_bot"),r.setAttribute("data-size","large"),r.setAttribute("data-onauth","window.onTelegramAuth(user)"),r.setAttribute("data-request-access","write"),s.current.innerHTML="",s.current.appendChild(r)}}async function Oe(s,r,t,a){t(!0);try{const o=await(await fetch(`${O}/telegram-auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();o.success?r(o.user):a(o.message||"Telegram login failed.")}catch(i){console.error("Error during Telegram auth:",i),a("Network error during Telegram login.")}finally{t(!1)}}const $e=({onAuthSuccess:s,authLoading:r})=>{const t=n.useRef(null);return n.useEffect(()=>{r||Ae(t)},[r]),e.jsx("div",{className:"login-container",children:e.jsxs("div",{className:"login-card",children:[e.jsx("h1",{className:"login-title",children:"Welcome to PNPtv Live"}),e.jsx("p",{className:"login-subtitle",children:"Please log in with Telegram to continue."}),r?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx("div",{className:"spinner-sm"}),e.jsx("p",{className:"text-muted-foreground ml-2",children:"Checking authentication..."})]}):e.jsx("div",{ref:t,className:"telegram-login-widget"})]})})},K=[{id:"1",title:"Welcome to PNPtv",artist:"PNPtv Team",type:"video",category:"featured",duration:180,cover_url:"https://picsum.photos/seed/pnp1/400/225",url:"https://www.w3schools.com/html/mov_bbb.mp4"},{id:"2",title:"Community Highlights",artist:"PNPtv Community",type:"video",category:"featured",duration:240,cover_url:"https://picsum.photos/seed/pnp2/400/225",url:"https://www.w3schools.com/html/movie.mp4"},{id:"3",title:"Latin Vibes Mix",artist:"DJ PNP",type:"audio",category:"music",duration:3600,cover_url:"https://picsum.photos/seed/pnp3/400/400",url:""},{id:"4",title:"PNPtv Podcast Ep. 1",artist:"The PNP Crew",type:"audio",category:"podcast",duration:2400,cover_url:"https://picsum.photos/seed/pnp4/400/400",url:""},{id:"5",title:"Best of the Week",artist:"Various Artists",type:"video",category:"videos",duration:600,cover_url:"https://picsum.photos/seed/pnp5/400/225",url:"https://www.w3schools.com/html/mov_bbb.mp4"},{id:"6",title:"Dance Party Mix",artist:"DJ Latino",type:"audio",category:"music",duration:4200,cover_url:"https://picsum.photos/seed/pnp6/400/400",url:""}];function Ie(){const[s,r]=n.useState(null),[t,a]=n.useState("home"),[i,o]=n.useState("all"),[f,m]=n.useState([]),[c,v]=n.useState(null),[l,y]=n.useState(null),[p,j]=n.useState(!1),[M,T]=n.useState(!0),[J,b]=n.useState(null),[d,P]=n.useState(null),[S,C]=n.useState(!0),[L,g]=n.useState(!1);n.useRef(null),n.useEffect(()=>{const u=_e();r(u),a(u.view||"home"),(async()=>{C(!0);try{const h=await ze();h?(P(h),g(!0),N(),k()):g(!1)}catch(h){b(h.message),g(!1)}finally{C(!1)}})(),window.onTelegramAuth=async h=>{await Oe(h,P,C,b),g(!0),N(),k()};const x=setInterval(k,3e4);return()=>{clearInterval(x)}},[L]);async function N(u=null){T(!0);try{const w=await Me("all",u);m(w.length>0?w:K)}catch(w){console.error("Failed to load media, using demo data:",w),m(K)}T(!1)}async function k(){try{const u=await Le();y(u)}catch(u){console.error("Failed to load radio status:",u)}}function $(u){o(u),u==="all"?N():u==="radio"?j(!0):N(u)}function I(u){v(u),a("player")}const F=async()=>{try{await fetch("/api/logout",{method:"POST"}),P(null),g(!1)}catch(u){console.error("Logout failed:",u),b("Failed to log out.")}};function U(){v(null),a("home")}return S?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[e.jsx("div",{className:"spinner-lg"}),e.jsx("p",{className:"text-muted-foreground mt-4",children:"Loading authentication..."})]}):L?t==="player"&&c?e.jsxs(e.Fragment,{children:[e.jsx(Re,{media:c,onClose:U,radioNowPlaying:l,onRadioToggle:()=>j(!p)}),l&&e.jsx(Y,{nowPlaying:l,isExpanded:p,onToggle:()=>j(!p)})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{title:"PNPtv Live",subtitle:"Your Media Center",telegramUser:d,onLogout:F}),e.jsxs("main",{className:"container",children:[e.jsxs("section",{className:"hero-section",children:[e.jsxs("div",{className:"hero-copy",children:[e.jsx("p",{className:"hero-eyebrow",children:"Live Streaming Platform"}),e.jsx("h2",{children:"Experience live events, shows, and more."}),e.jsx("p",{children:"Join live streams, interact with creators, and enjoy exclusive content. All powered by PNPtv."}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsx("span",{className:"badge",children:"Live Events"}),e.jsx("span",{className:"badge",children:"Creator Streams"}),e.jsx("span",{className:"badge",children:"24/7 Radio"})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-lg font-semibold",children:"Radio status"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{children:l?"Live now":"Offline"}),e.jsx("span",{className:`w-3 h-3 rounded-full ${l?"bg-green-500":"bg-gray-500"}`})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:l?.title||"Check back soon for the live mix."}),l&&e.jsx("button",{type:"button",className:"button mt-4",onClick:()=>j(!0),children:"Open radio"})]})]}),e.jsx(Ee,{selected:i,onChange:$,radioActive:l!==null}),M?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx("div",{className:"spinner-lg"}),e.jsx("p",{className:"text-muted-foreground mt-4",children:"Loading media..."})]}):e.jsx(ke,{media:filteredMedia,onSelect:I}),l&&e.jsx(Y,{nowPlaying:l,isExpanded:p,onToggle:()=>j(!p)})]})]}):e.jsx($e,{onAuthSuccess:()=>g(!0),authLoading:S})}be.createRoot(document.getElementById("root")).render(e.jsx(ge.StrictMode,{children:e.jsx(Ie,{})}));
