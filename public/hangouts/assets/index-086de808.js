import{r as l,a as M,S as B,R as W,G,L as J,b as z}from"./vendor-1b7ccb23.js";import"./agora-2d0f9cfc.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();var I={exports:{}},v={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H=l,q=Symbol.for("react.element"),Q=Symbol.for("react.fragment"),V=Object.prototype.hasOwnProperty,K=H.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Y={key:!0,ref:!0,__self:!0,__source:!0};function L(t,s,i){var o,r={},a=null,c=null;i!==void 0&&(a=""+i),s.key!==void 0&&(a=""+s.key),s.ref!==void 0&&(c=s.ref);for(o in s)V.call(s,o)&&!Y.hasOwnProperty(o)&&(r[o]=s[o]);if(t&&t.defaultProps)for(o in s=t.defaultProps,s)r[o]===void 0&&(r[o]=s[o]);return{$$typeof:q,type:t,key:a,ref:c,props:r,_owner:K.current}}v.Fragment=Q;v.jsx=L;v.jsxs=L;I.exports=v;var e=I.exports,A,E=M;A=E.createRoot,E.hydrateRoot;const X="modulepreload",Z=function(t){return"/hangouts/"+t},_={},U=function(s,i,o){if(!i||i.length===0)return s();const r=document.getElementsByTagName("link");return Promise.all(i.map(a=>{if(a=Z(a),a in _)return;_[a]=!0;const c=a.endsWith(".css"),m=c?'[rel="stylesheet"]':"";if(!!o)for(let f=r.length-1;f>=0;f--){const p=r[f];if(p.href===a&&(!c||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${m}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":X,c||(h.as="script",h.crossOrigin=""),h.href=a,document.head.appendChild(h),c)return new Promise((f,p)=>{h.addEventListener("load",f),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>s()).catch(a=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a})},N=()=>{var t;try{return((t=window.Telegram)==null?void 0:t.WebApp)||null}catch(s){return console.error("Telegram WebApp unavailable:",s),null}},ee=()=>!!N(),g=()=>{var t;try{const s=N();if(!s)return null;const i=(t=s.initDataUnsafe)==null?void 0:t.user;if(!(i!=null&&i.id))return null;const o=i.username?`@${i.username}`:i.first_name||i.last_name||"Anonymous";return{id:i.id,username:i.username||null,firstName:i.first_name||null,lastName:i.last_name||null,languageCode:i.language_code||null,displayName:o,initData:s.initData||null,isTelegram:!0}}catch(s){return console.error("Failed to read Telegram user:",s),null}},se=()=>{const t=N();if(!t)return!1;try{return t.expand(),t.ready(),!0}catch(s){return console.error("Telegram WebApp init failed:",s),!1}},D=t=>{const s={"Content-Type":"application/json"};return t&&(s["x-telegram-init-data"]=t),s},C=async()=>{const t=await fetch("/api/hangouts/public",{method:"GET"}),s=await t.json();if(!t.ok||!s.success)throw new Error(s.error||"Failed to load rooms");return s.rooms||[]},te=async({title:t,maxParticipants:s,isPublic:i,enforceCamera:o,allowGuests:r}={})=>{const a=g(),c={title:t,maxParticipants:s,isPublic:i,enforceCamera:o,allowGuests:r,creatorId:a==null?void 0:a.id,creatorName:a==null?void 0:a.displayName,initData:a==null?void 0:a.initData},m=await fetch("/api/hangouts/create",{method:"POST",headers:D(a==null?void 0:a.initData),body:JSON.stringify(c)}),d=await m.json();if(!m.ok||!d.success)throw new Error(d.error||"Failed to create room");return d},ae=async t=>{const s=g(),i=await fetch(`/api/hangouts/join/${encodeURIComponent(t)}`,{method:"POST",headers:D(s==null?void 0:s.initData),body:JSON.stringify({userId:s==null?void 0:s.id,userName:s==null?void 0:s.displayName,initData:s==null?void 0:s.initData})}),o=await i.json();if(!i.ok||!o.success)throw new Error(o.error||"Failed to join room");return o},ne=()=>{const t=new URLSearchParams(window.location.search||"");return{room:t.get("room"),token:t.get("token"),uid:t.get("uid"),username:t.get("username")||"Anonymous",type:t.get("type")||"private",appId:t.get("appId")||"",callId:t.get("callId")||""}},O=({baseUrl:t="/hangouts/",room:s,token:i,uid:o,username:r,type:a,appId:c,callId:m}={})=>{const d=new URL(t,window.location.origin);return s&&d.searchParams.set("room",s),i&&d.searchParams.set("token",i),o&&d.searchParams.set("uid",String(o)),r&&d.searchParams.set("username",r),a&&d.searchParams.set("type",a),c&&d.searchParams.set("appId",c),m&&d.searchParams.set("callId",m),d.pathname+(d.search||"")},ue=()=>{var t;if((t=window.history)!=null&&t.replaceState){const s=`${window.location.origin}${window.location.pathname}`;window.history.replaceState({},document.title,s)}},ie=t=>{const s=Math.max(0,Math.floor(t/1e3));if(s<60)return`${s}s`;const i=Math.floor(s/60);return i<60?`${i}m`:`${Math.floor(i/60)}h`};function re({telegramUser:t}){const[s,i]=l.useState([]),[o,r]=l.useState(!0),[a,c]=l.useState(""),[m,d]=l.useState(""),[h,f]=l.useState(10),[p,w]=l.useState(!0),[P,T]=l.useState(!1),[S,k]=l.useState(""),[y,j]=l.useState(""),b=ee()&&(t==null?void 0:t.initData);l.useEffect(()=>{let n=!0;return(async()=>{try{r(!0);const x=await C();n&&(i(x),c(""))}catch(x){n&&(i([]),c((x==null?void 0:x.message)||"Failed to load rooms."))}finally{n&&r(!1)}})(),()=>{n=!1}},[]),l.useEffect(()=>{if(!y)return;const n=setTimeout(()=>j(""),1800);return()=>clearTimeout(n)},[y]);const R=async()=>{r(!0);try{const n=await C();i(n),c("")}catch(n){c((n==null?void 0:n.message)||"Failed to load rooms.")}finally{r(!1)}},F=async()=>{if(p&&!b){j("Open from Telegram to create public rooms.");return}try{T(!0);const n=await te({title:m,maxParticipants:h,isPublic:p,allowGuests:!0,enforceCamera:!1}),u=O({room:n.room,token:n.token,uid:n.uid,username:(t==null?void 0:t.displayName)||"Host",type:n.isPublic?"public":"private",appId:n.appId,callId:n.callId});window.location.href=u}catch(n){j((n==null?void 0:n.message)||"Failed to create room.")}finally{T(!1)}},$=async n=>{if(!b){j("Open from Telegram to join rooms.");return}try{k(n);const u=await ae(n),x=O({room:u.room,token:u.token,uid:u.uid,username:(t==null?void 0:t.displayName)||"Guest",type:u.isPublic?"public":"private",appId:u.appId,callId:u.callId});window.location.href=x}catch(u){j((u==null?void 0:u.message)||"Failed to join room.")}finally{k("")}};return e.jsxs("div",{className:"app",children:[e.jsx("div",{className:"bg"}),e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"brand",children:[e.jsx("div",{className:"brandMark",children:e.jsx(B,{size:18})}),e.jsxs("div",{className:"brandText",children:[e.jsx("div",{className:"brandName",children:"PNPtv Hangouts"}),e.jsx("div",{className:"brandTag",children:"Rooms | Live | Private-by-default | 18+"})]})]}),e.jsx("button",{className:"iconBtn",onClick:R,disabled:o,title:"Refresh rooms",children:e.jsx(W,{size:18})})]}),e.jsxs("main",{className:"main",children:[e.jsxs("section",{className:"hero",children:[e.jsx("div",{className:"heroTitle",children:"Find a room or start one."}),e.jsx("div",{className:"heroText",children:t?e.jsxs(e.Fragment,{children:["Connected as ",e.jsx("span",{className:"monoInline",children:t.displayName}),". Public rooms appear below."]}):e.jsx(e.Fragment,{children:"Open from Telegram for instant join and creator credit."})}),!b&&e.jsx("div",{className:"notice info",children:"This feature requires Telegram authentication. Open this link inside Telegram to join or create public rooms."})]}),e.jsxs("section",{className:"card glass",children:[e.jsxs("div",{className:"formGrid",children:[e.jsxs("label",{className:"field",children:[e.jsx("div",{className:"label",children:"Title"}),e.jsx("input",{value:m,onChange:n=>d(n.target.value),placeholder:"e.g., Late-night vibez"})]}),e.jsxs("label",{className:"field",children:[e.jsx("div",{className:"label",children:"Visibility"}),e.jsxs("div",{className:"segmented",children:[e.jsxs("button",{className:p?"seg active":"seg",onClick:()=>w(!0),type:"button",children:[e.jsx(G,{size:16})," Public"]}),e.jsxs("button",{className:p?"seg":"seg active",onClick:()=>w(!1),type:"button",children:[e.jsx(J,{size:16})," Private"]})]})]}),e.jsxs("label",{className:"field",children:[e.jsx("div",{className:"label",children:"Max participants"}),e.jsx("input",{type:"number",min:2,max:50,value:h,onChange:n=>f(Number(n.target.value))})]})]}),e.jsx("div",{className:"hint",children:"Public rooms send a community notification with a join link. Private rooms stay invite-only."}),e.jsxs("div",{className:"heroActions",children:[e.jsx("button",{className:"btn",onClick:F,disabled:P,children:P?"Creating...":"Create room"}),e.jsx("button",{className:"btn btnGhost",onClick:R,disabled:o,children:"Refresh"})]})]}),e.jsx("div",{className:"sectionTitle",children:"Public rooms"}),a&&e.jsx("div",{className:"notice error",children:a}),o?e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("div",{className:"muted",children:"Loading rooms..."})]}):s.length===0?e.jsxs("div",{className:"empty",children:[e.jsx("div",{className:"emptyTitle",children:"No public rooms right now"}),e.jsx("div",{className:"emptyText",children:"Create one and it will appear here."})]}):e.jsx("div",{className:"grid",children:s.map(n=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"cardTop",children:[e.jsx("div",{className:"pill",children:"Public"}),e.jsx("button",{className:"btn btnSmall",onClick:()=>$(n.id),disabled:S===n.id,children:S===n.id?"Joining...":"Join"})]}),e.jsx("div",{className:"cardTitle",children:n.title||"Untitled room"}),e.jsxs("div",{className:"cardDesc",children:["Host: ",e.jsx("span",{className:"monoInline",children:n.creatorName||"Unknown"})]}),e.jsxs("div",{className:"cardMeta",children:[e.jsxs("span",{className:"pill subtle",children:[n.currentParticipants||0,"/",n.maxParticipants||0]}),n.createdAt&&e.jsxs("span",{className:"pill subtle",children:[ie(Date.now()-new Date(n.createdAt).getTime())," ago"]})]})]},n.id))})]}),y&&e.jsx("div",{className:"toast",children:y})]})}const oe=l.lazy(()=>U(()=>import("./CallRoom-f06c0e5b.js"),["assets/CallRoom-f06c0e5b.js","assets/vendor-1b7ccb23.js","assets/agora-2d0f9cfc.js"]));function ce(){const t=l.useMemo(()=>ne(),[]),[s,i]=l.useState(null);return l.useEffect(()=>{se()&&i(g())},[]),!(t.room&&t.token&&t.uid)?e.jsx(re,{telegramUser:s}):e.jsx(l.Suspense,{fallback:e.jsxs("div",{className:"app",children:[e.jsx("div",{className:"bg"}),e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("div",{className:"muted",children:"Loading call..."})]})]}),children:e.jsx(oe,{params:t,telegramUser:s})})}A(document.getElementById("root")).render(e.jsx(z.StrictMode,{children:e.jsx(ce,{})}));export{e as j,ue as s};
