<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>PNPtv Videorama!</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1C1C1E;
            --bg-card: rgba(44, 44, 46, 0.7);
            --text-main: #FFFFFF;
            --text-muted: #8E8E93;
            --neon-pink: #FF00CC;
            --neon-amber: #FFB454;
            --glass-border: rgba(255, 255, 255, 0.06);
            --card-radius: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
            padding-top: 60px;
        }

        /* Ambient Glow */
        .ambient-glow {
            position: fixed; top: -30%; left: 50%; transform: translateX(-50%);
            width: 120vw; height: 120vw;
            background: radial-gradient(circle, rgba(255, 0, 204, 0.1) 0%, transparent 65%);
            z-index: -1; pointer-events: none;
        }

        /* Override Materialize Navbar */
        nav {
            background: rgba(28, 28, 30, 0.95) !important;
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            box-shadow: none !important;
            border-bottom: 1px solid var(--glass-border);
            height: 60px; line-height: 60px;
            position: fixed; top: 0; width: 100%; z-index: 1000;
        }

        nav .brand-logo {
            font-family: 'Inter', sans-serif !important;
            font-weight: 900 !important; font-size: 20px !important;
            letter-spacing: -0.5px;
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-amber));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            margin-left: 16px !important;
        }

        nav ul li a { color: var(--text-muted) !important; }
        nav ul li a:hover { background: rgba(255, 255, 255, 0.05) !important; }
        nav ul li a i { color: var(--text-muted); }

        /* Main Container */
        .main-container {
            background: transparent;
            max-width: 1100px; margin: 20px auto;
            border-radius: 0; box-shadow: none;
        }

        /* Header Section */
        .header-section {
            background: transparent;
            color: var(--text-main);
            padding: 32px 20px 20px; text-align: center;
        }

        .header-section h1 {
            font-family: 'Inter', sans-serif; font-size: clamp(24px, 6vw, 36px);
            font-weight: 900; text-shadow: none;
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-amber));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }

        .header-section p { color: var(--text-muted); font-size: 14px; }

        /* Search Section */
        .search-section {
            padding: 20px; background: transparent; border: none;
        }

        .search-wrapper { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }

        .search-section .input-field { margin: 0 !important; }

        .search-section .input-field input {
            background: rgba(255, 255, 255, 0.05) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 12px !important; border-bottom: 1px solid var(--glass-border) !important;
            color: var(--text-main) !important; padding: 0 16px !important;
            height: 44px !important; font-family: 'Inter', sans-serif !important;
            box-shadow: none !important;
        }

        .search-section .input-field input:focus {
            border-color: var(--neon-amber) !important;
            box-shadow: none !important;
        }

        .search-section .input-field .prefix { color: var(--text-muted) !important; top: 8px; }

        .btn-search {
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-amber)) !important;
            border-radius: 12px !important; box-shadow: 0 4px 16px rgba(255, 0, 204, 0.2) !important;
            font-family: 'Inter', sans-serif !important; font-weight: 700 !important;
            text-transform: uppercase !important; letter-spacing: 0.5px !important;
            height: 44px; line-height: 44px;
        }

        .filter-chips { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 16px; }

        .filter-chips .chip {
            background: rgba(255, 255, 255, 0.05) !important;
            border: 1px solid var(--glass-border) !important;
            color: var(--text-muted) !important; border-radius: 20px !important;
            font-family: 'Inter', sans-serif !important; font-size: 13px !important;
            font-weight: 600 !important; height: 34px; line-height: 34px;
            padding: 0 14px !important;
        }

        .filter-chips .chip:hover, .filter-chips .chip.active {
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-amber)) !important;
            color: white !important; border-color: transparent !important;
        }

        .filter-chips .chip i { font-size: 16px !important; margin-right: 4px; }

        /* Content Area */
        .content-area { padding: 20px; min-height: 400px; }

        /* Playlist Grid */
        .playlist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        /* Playlist Card */
        .playlist-card {
            background: var(--bg-card); backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius); overflow: hidden;
            transition: all 0.3s ease; cursor: pointer;
            display: flex; flex-direction: column;
            box-shadow: none;
        }

        .playlist-card:hover {
            transform: translateY(-4px);
            border-color: rgba(255, 180, 84, 0.3);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
        }

        .playlist-thumbnail {
            width: 100%; height: 160px;
            background: linear-gradient(135deg, rgba(255, 0, 204, 0.3), rgba(255, 180, 84, 0.3));
            display: flex; align-items: center; justify-content: center;
            position: relative; overflow: hidden;
        }

        .playlist-thumbnail img { width: 100%; height: 100%; object-fit: cover; }

        .playlist-thumbnail .overlay {
            position: absolute; inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s;
        }

        .playlist-card:hover .overlay { opacity: 1; }

        .overlay-icon {
            background: linear-gradient(135deg, var(--neon-pink), var(--neon-amber));
            border-radius: 50%; width: 52px; height: 52px;
            display: flex; align-items: center; justify-content: center;
            color: white;
        }

        .playlist-content { padding: 16px; flex-grow: 1; display: flex; flex-direction: column; }

        .playlist-content h3 {
            color: var(--text-main); font-size: 15px; font-weight: 700;
            margin: 0 0 8px 0; line-height: 1.3;
        }

        .playlist-content p {
            color: var(--text-muted); font-size: 13px; margin: 0 0 12px 0;
            line-height: 1.4; flex-grow: 1;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }

        .playlist-info {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 16px; border-top: 1px solid var(--glass-border);
            font-size: 12px; color: var(--text-muted);
        }

        .video-count { display: flex; align-items: center; gap: 4px; }

        .btn-play {
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-amber)) !important;
            color: white !important; border: none !important;
            margin: 0 16px 16px !important; border-radius: 12px !important;
            font-family: 'Inter', sans-serif !important; font-weight: 700 !important;
            text-transform: uppercase !important; letter-spacing: 0.5px !important;
            box-shadow: 0 4px 16px rgba(255, 0, 204, 0.2) !important;
        }

        .btn-icon-small {
            background: none; border: none; padding: 0;
            cursor: pointer; display: inline-flex;
        }

        /* Badge */
        .badge {
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-amber)) !important;
            border-radius: 10px !important; padding: 2px 10px !important;
            font-size: 10px !important; font-weight: 700 !important;
            color: white !important; letter-spacing: 0.5px;
        }

        .creator-badge {
            background: rgba(255, 180, 84, 0.1) !important;
            border-left: 2px solid var(--neon-amber) !important;
            padding: 2px 8px !important; border-radius: 4px !important;
            font-size: 11px !important; color: var(--neon-amber) !important;
            font-weight: 600 !important;
        }

        .creator-badge[title*="PNPtv"] {
            border-left-color: var(--neon-pink) !important;
            color: var(--neon-pink) !important;
            background: rgba(255, 0, 204, 0.1) !important;
        }

        /* Tabs Override */
        .tabs { background: rgba(28, 28, 30, 0.8) !important; border: none !important; }
        .tabs .tab a { color: var(--text-muted) !important; font-family: 'Inter', sans-serif !important; font-weight: 600 !important; }
        .tabs .tab a.active { color: var(--neon-amber) !important; }
        .tabs .indicator { background-color: var(--neon-amber) !important; }

        /* Tabs Container Row */
        .row[style*="border-bottom"] { border-bottom-color: var(--glass-border) !important; background: transparent !important; }

        /* Modal Override */
        .modal {
            background: #2C2C2E !important; color: var(--text-main) !important;
            border-radius: 20px !important;
        }

        .modal .modal-content h4, .modal .modal-content h5 {
            color: var(--text-main) !important; font-family: 'Inter', sans-serif !important;
            font-weight: 800 !important;
        }

        .modal .modal-content p { color: var(--text-muted) !important; }

        .modal .modal-footer {
            background: rgba(44, 44, 46, 0.9) !important;
            border-top: 1px solid var(--glass-border) !important;
        }

        .modal .modal-footer .btn-flat { color: var(--text-muted) !important; }

        .modal .input-field input,
        .modal .input-field textarea {
            color: var(--text-main) !important;
            border-bottom: 1px solid var(--glass-border) !important;
        }

        .modal .input-field input:focus,
        .modal .input-field textarea:focus {
            border-bottom-color: var(--neon-amber) !important;
            box-shadow: 0 1px 0 0 var(--neon-amber) !important;
        }

        .modal .input-field label { color: var(--text-muted) !important; }
        .modal .input-field label.active { color: var(--neon-amber) !important; }

        /* Video Player Modal */
        #videoPlayerModal .modal-content > div > div:first-child {
            background: linear-gradient(135deg, rgba(255, 0, 204, 0.8), rgba(255, 180, 84, 0.8)) !important;
        }

        #videoPlayerModal [style*="background: #f5f5f5"] {
            background: #2C2C2E !important;
            border-top-color: var(--glass-border) !important;
        }

        #videoPlayerModal .btn {
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-amber)) !important;
            border-radius: 10px !important; font-family: 'Inter', sans-serif !important;
            font-weight: 700 !important;
        }

        /* Video List in Modal */
        .video-list .video-item {
            background: rgba(255, 255, 255, 0.03) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 12px !important; margin-bottom: 8px;
        }

        .video-list .video-item:hover {
            background: rgba(255, 255, 255, 0.06) !important;
            border-color: rgba(255, 180, 84, 0.3) !important;
        }

        .video-item h6 { color: var(--text-main) !important; }
        .video-item p { color: var(--text-muted) !important; }

        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-state i { font-size: 48px; color: rgba(255, 255, 255, 0.1); margin-bottom: 16px; }
        .empty-state h3 { color: var(--text-main); font-size: 18px; font-weight: 700; }
        .empty-state p { color: var(--text-muted); font-size: 14px; }

        /* Footer */
        .footer-section {
            border-top: 1px solid var(--glass-border);
            padding: 24px 20px; text-align: center;
            background: transparent;
        }

        .footer-section p { color: rgba(255, 255, 255, 0.3); font-size: 12px; }

        /* FAB */
        .btn-fab {
            background: linear-gradient(135deg, var(--neon-pink), var(--neon-amber)) !important;
            box-shadow: 0 4px 16px rgba(255, 0, 204, 0.3) !important;
        }

        /* Toast Override */
        .toast { background: #2C2C2E !important; color: var(--text-main) !important; border-radius: 12px !important; }

        /* Scrollbar */
        .video-list::-webkit-scrollbar { width: 4px; }
        .video-list::-webkit-scrollbar-track { background: transparent; }
        .video-list::-webkit-scrollbar-thumb { background: var(--neon-amber); border-radius: 4px; }

        /* Select Override */
        .select-wrapper input.select-dropdown { color: var(--text-main) !important; border-bottom-color: var(--glass-border) !important; }
        .dropdown-content { background-color: #2C2C2E !important; }
        .dropdown-content li > a, .dropdown-content li > span { color: var(--text-main) !important; }
        .dropdown-content li:hover { background-color: rgba(255, 180, 84, 0.1) !important; }

        /* Create Playlist Button */
        #createPlaylistBtn {
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-amber)) !important;
            border-radius: 12px !important; font-family: 'Inter', sans-serif !important;
            font-weight: 700 !important; font-size: 13px !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body { padding-top: 56px; }
            .header-section h1 { font-size: 24px; }
            .playlist-grid { grid-template-columns: 1fr; }
            .search-wrapper { flex-direction: column; }
            .main-container { margin: 8px auto; }
            nav .brand-logo { font-size: 17px !important; }
        }
    </style>
</head>
<body>
    <div class="ambient-glow"></div>

    <!-- Navigation -->
    <nav>
        <div class="nav-wrapper">
            <a href="/" class="brand-logo">PNPtv Videorama!</a>
            <ul class="right hide-on-med-and-down">
                <li><a href="/" title="Home"><i class="material-icons">home</i></a></li>
                <li><a href="/radio.html" title="Radio"><i class="material-icons">radio</i></a></li>
                <li><a href="/videorama-app/" title="Videorama"><i class="material-icons">videocam</i></a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <div class="header-section">
            <h1>PNPtv Videorama!</h1>
            <p>Discover and enjoy curated playlists from PNPtv</p>
        </div>

        <!-- Search & Filter -->
        <div class="search-section">
            <div class="search-wrapper">
                <div class="input-field" style="flex: 1; min-width: 250px;">
                    <i class="material-icons prefix">search</i>
                    <input id="searchInput" type="text" placeholder="Search playlists...">
                </div>
                <button class="btn btn-search" onclick="handleSearch()">
                    <i class="material-icons left">search</i>Search
                </button>
            </div>

            <div class="filter-chips">
                <div class="chip" data-filter="all" onclick="filterPlaylists(this)">All</div>
                <div class="chip" data-filter="featured" onclick="filterPlaylists(this)">Featured</div>
                <div class="chip" data-filter="music" onclick="filterPlaylists(this)">Music</div>
                <div class="chip" data-filter="podcast" onclick="filterPlaylists(this)">Podcasts</div>
                <div class="chip" data-filter="education" onclick="filterPlaylists(this)">Education</div>
                <div class="chip" data-filter="entertainment" onclick="filterPlaylists(this)">Entertainment</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="row" style="margin: 0; display: flex; align-items: center; padding: 10px 20px; border-bottom: 1px solid rgba(255,255,255,0.06);">
            <div class="col s12" style="flex: 1;">
                <ul class="tabs" style="margin: 0;">
                    <li class="tab col s6 m3"><a class="active" href="#tab-playlists">Playlists</a></li>
                    <li class="tab col s6 m3"><a href="#tab-favorites">Favorites</a></li>
                </ul>
            </div>
            <button class="btn" id="createPlaylistBtn" onclick="openCreatePlaylistModal()" style="margin-left: auto;">
                <i class="material-icons left">add_circle</i>Create
            </button>
        </div>

        <!-- Create Playlist Modal -->
        <div id="createPlaylistModal" class="modal">
            <div class="modal-content">
                <h4>Create a New Playlist</h4>
                <p>Share your music taste with the PNPtv community!</p>
                <div class="input-field">
                    <input id="playlistTitle" type="text" placeholder="Playlist Title">
                    <label for="playlistTitle">Title</label>
                </div>
                <div class="input-field">
                    <textarea id="playlistDescription" class="materialize-textarea" placeholder="Describe your playlist..."></textarea>
                    <label for="playlistDescription">Description</label>
                </div>
                <div class="input-field">
                    <select id="playlistCategory">
                        <option value="">Select Category</option>
                        <option value="music">Music</option>
                        <option value="podcast">Podcast</option>
                        <option value="education">Education</option>
                        <option value="entertainment">Entertainment</option>
                    </select>
                    <label>Category</label>
                </div>
                <div class="input-field">
                    <input id="creatorName" type="text" placeholder="Your Name">
                    <label for="creatorName">Creator Name</label>
                </div>
                <div class="input-field">
                    <input id="creatorEmoji" type="text" value="" placeholder="Pick an emoji" maxlength="2">
                    <label for="creatorEmoji">Creator Emoji (optional)</label>
                </div>
                <div class="input-field">
                    <input id="videoLinks" type="text" placeholder="YouTube links (comma-separated)">
                    <label for="videoLinks">Video Links (comma-separated)</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-flat" onclick="closeCreatePlaylistModal()">Cancel</button>
                <button class="btn btn-play" onclick="savePlaylist()">
                    <i class="material-icons left">check</i>Create Playlist
                </button>
            </div>
        </div>

        <!-- Video Player Modal -->
        <div id="videoPlayerModal" class="modal" style="max-width: 90%; width: 1200px; height: 90%;">
            <div class="modal-content" style="padding: 0; height: 100%;">
                <div style="position: relative; height: 100%; display: flex; flex-direction: column;">
                    <div style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.06); background: linear-gradient(135deg, rgba(255,0,204,0.8), rgba(255,180,84,0.8)); color: white;">
                        <h5 id="videoPlayerTitle" style="margin: 0; font-weight: 700;">Now Playing</h5>
                        <p id="videoPlayerSubtitle" style="margin: 5px 0 0 0; opacity: 0.9; color: white !important;">Loading...</p>
                    </div>
                    <div id="videoPlayerContainer" style="flex: 1; background: #000; position: relative;">
                        <iframe id="videoPlayerFrame"
                                style="width: 100%; height: 100%; border: none;"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen></iframe>
                    </div>
                    <div style="padding: 15px; background: #2C2C2E; border-top: 1px solid rgba(255,255,255,0.06);">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <button class="btn" onclick="playPreviousVideo()" id="prevBtn">
                                <i class="material-icons left">skip_previous</i>Prev
                            </button>
                            <div style="text-align: center; flex: 1; color: var(--text-muted); font-size: 13px;">
                                <span id="videoPosition">1 / 9</span>
                            </div>
                            <button class="btn" onclick="playNextVideo()" id="nextBtn">
                                <i class="material-icons right">skip_next</i>Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding: 10px 24px;">
                <button class="btn-flat" onclick="closeVideoPlayer()">Close</button>
            </div>
        </div>

        <div class="row" style="margin: 0;">
            <!-- Playlists Tab -->
            <div id="tab-playlists" class="col s12" style="padding: 20px;">
                <div id="playlistsContainer" class="playlist-grid"></div>
                <div id="emptyState" class="empty-state" style="display: none;">
                    <i class="material-icons">not_interested</i>
                    <h3>No playlists found</h3>
                    <p>Try adjusting your search filters</p>
                </div>
            </div>

            <!-- Favorites Tab -->
            <div id="tab-favorites" class="col s12" style="padding: 20px;">
                <div id="favoritesContainer" class="playlist-grid"></div>
                <div id="emptyFavorites" class="empty-state">
                    <i class="material-icons">favorite_border</i>
                    <h3>No favorites yet</h3>
                    <p>Start adding playlists to your favorites by clicking the heart icon</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer-section">
            <p>&copy; 2026 PNPtv. Powered by Invidious. All rights reserved.</p>
        </div>
    </div>

    <!-- FAB -->
    <div class="fab-container" style="position: fixed; bottom: 24px; right: 24px; z-index: 999;">
        <button class="btn-fab" onclick="scrollToTop()" title="Back to top"
                style="width: 48px; height: 48px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;">
            <i class="material-icons" style="color: white;">arrow_upward</i>
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        // PNPtv Featured Playlist (Official)
        let playlists = [
            {
                id: 1,
                title: 'Emotional Rollercoaster',
                description: 'A narrative journey through impulse, mental noise, intrusive thoughts, emotional numbness, breaking points, acceptance, and landing back in reality. Listen in order. Let each song do its work. It\'s not a party. It\'s a journey.',
                category: 'music',
                icon: 'ðŸŽ¢',
                videoCount: 12,
                featured: true,
                creator: 'PNPtv',
                creatorBadge: 'ðŸ‘‘',
                thumbnail: 'https://i.ytimg.com/vi/_9BGLtqqkVI/hqdefault.jpg',
                videos: [
                    { title: '1. Hash Pipe - Weezer', url: 'https://www.youtube.com/watch?v=_9BGLtqqkVI', description: 'Impulso inicial: energÃ­a caÃ³tica, decisiones rÃ¡pidas, cero filtro. El momento donde todo arranca sin pensar demasiado.' },
                    { title: '2. Come Undone - Robbie Williams', url: 'https://www.youtube.com/watch?v=4D35vfQ7eZg', description: 'La euforia empieza a agrietarse. Sigue siendo intensa, pero ya convive con ansiedad y pÃ©rdida de control.' },
                    { title: '3. Don\'t Let Me Get Me - P!nk', url: 'https://www.youtube.com/watch?v=asaCQOZpqUQ', description: 'Auto-conflicto. FrustraciÃ³n. La mente girando contra sÃ­ misma.' },
                    { title: '4. Berghain - RosalÃ­a feat. BjÃ¶rk & Yves Tumor', url: 'https://www.youtube.com/watch?v=6TKYd-pHo1A', description: 'Pensamientos intrusivos: introspecciÃ³n intensa, diÃ¡logo interno invasivo, ideas que no se pueden apagar.' },
                    { title: '5. Numb / Encore - Linkin Park & Jay-Z', url: 'https://www.youtube.com/watch?v=yS8lkzNF-eU', description: 'SaturaciÃ³n total. El ruido interno ya es constante y abrumador.' },
                    { title: '6. Habits (Stay High) - Tove Lo', url: 'https://www.youtube.com/watch?v=SYM-RJwSGQ8', description: 'El intento de escapar. RepeticiÃ³n emocional. Loop.' },
                    { title: '7. Novacane - Frank Ocean', url: 'https://www.youtube.com/watch?v=8PtP3AO4Rgo', description: 'Anestesia emocional. Nada dueleâ€¦ pero nada se siente.' },
                    { title: '8. When It Hurts So Bad - Lauryn Hill', url: 'https://www.youtube.com/watch?v=tG21lp8fNpM', description: 'El quiebre. La emociÃ³n que ya no se puede evitar.' },
                    { title: '9. Don\'t Leave Home - Dido', url: 'https://www.youtube.com/watch?v=vuGL6RZg_Gs', description: 'Aislamiento. Miedo. Necesidad de refugio.' },
                    { title: '10. Tears Dry on Their Own - Amy Winehouse', url: 'https://www.youtube.com/watch?v=j-GqgTX43wo', description: 'AceptaciÃ³n silenciosa. No todo se arregla, pero se sigue.' },
                    { title: '11. La Plata - Diomedes DÃ­az', url: 'https://www.youtube.com/watch?v=0MWlFi9d4c0', description: 'Aterrizaje terrenal. Memoria, culpa, realidad cotidiana.' },
                    { title: '12. Thank U - Alanis Morissette', url: 'https://www.youtube.com/watch?v=JXRmZRmpsbE', description: 'No es felicidad forzada. Es conciencia. Gratitud por lo aprendido.' }
                ]
            }
        ];

        let currentFilter = 'all';
        let favorites = JSON.parse(localStorage.getItem('playlistFavorites')) || [];
        let userPlaylists = JSON.parse(localStorage.getItem('userPlaylists')) || [];

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            const div = document.createElement('div');
            div.textContent = unsafe;
            return div.innerHTML;
        }

        async function getAllPlaylists() {
            let allPlaylists = [...playlists];
            userPlaylists.forEach(userPlaylist => {
                allPlaylists.push({ ...userPlaylist, featured: Math.random() < 0.3 });
            });
            try {
                const response = await fetch('/api/playlists/public');
                if (response.ok) {
                    const apiPlaylists = await response.json();
                    apiPlaylists.forEach(p => {
                        allPlaylists.push({
                            id: p.id, title: p.title, description: p.description,
                            category: p.category, icon: p.icon || '', videoCount: p.videoCount,
                            thumbnail: p.thumbnail, videos: p.videos, featured: p.featured,
                            creator: p.creator || 'User', creatorBadge: p.creatorBadge || ''
                        });
                    });
                }
            } catch (error) { console.log('Could not load API playlists:', error); }
            return allPlaylists;
        }

        document.addEventListener('DOMContentLoaded', async function () {
            M.Tabs.init(document.querySelectorAll('.tabs'));
            M.Modal.init(document.getElementById('createPlaylistModal'));
            M.updateTextFields();
            M.FormSelect.init(document.querySelectorAll('select'));
            document.querySelector('.filter-chips .chip').classList.add('active');
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
            initializeVideoPlayer();
            await renderPlaylists();
            await renderFavorites();
        });

        async function renderPlaylists(filter = 'all') {
            const container = document.getElementById('playlistsContainer');
            const emptyState = document.getElementById('emptyState');
            let allPlaylists = await getAllPlaylists();
            let filtered = filter !== 'all' ? allPlaylists.filter(p => p.category === filter) : allPlaylists;

            if (filtered.length === 0) {
                container.style.display = 'none'; emptyState.style.display = 'block'; return;
            }
            container.style.display = 'grid'; emptyState.style.display = 'none';

            container.innerHTML = filtered.map(playlist => `
                <div class="playlist-card" onclick="viewPlaylist(${playlist.id})">
                    <div class="playlist-thumbnail">
                        <img src="${escapeHtml(playlist.thumbnail)}" alt="${escapeHtml(playlist.title)}">
                        <div class="overlay"><div class="overlay-icon"><i class="material-icons">play_arrow</i></div></div>
                    </div>
                    <div class="playlist-content">
                        <h3>${escapeHtml(playlist.title)}</h3>
                        <p>${escapeHtml(playlist.description)}</p>
                        <div style="margin-top: auto; display: flex; gap: 8px; align-items: center;">
                            ${playlist.featured ? '<span class="badge featured">Featured</span>' : ''}
                            <span class="creator-badge" title="Created by ${escapeHtml(playlist.creator)}">
                                ${escapeHtml(playlist.creatorBadge || '')} ${escapeHtml(playlist.creator)}
                            </span>
                        </div>
                    </div>
                    <div class="playlist-info">
                        <div class="video-count">
                            <i class="material-icons" style="font-size: 14px;">play_circle</i>
                            ${playlist.videoCount} videos
                        </div>
                        <button class="btn-icon-small" onclick="toggleFavorite(event, ${playlist.id})">
                            <i class="material-icons" style="font-size: 18px; color: ${favorites.includes(playlist.id) ? 'var(--neon-pink)' : 'var(--text-muted)'};">
                                ${favorites.includes(playlist.id) ? 'favorite' : 'favorite_border'}
                            </i>
                        </button>
                    </div>
                    <button class="btn btn-play" onclick="playPlaylist(event, ${playlist.id})">
                        <i class="material-icons left">play_arrow</i>Play All
                    </button>
                </div>
            `).join('');
        }

        async function renderFavorites() {
            const container = document.getElementById('favoritesContainer');
            const emptyFavorites = document.getElementById('emptyFavorites');
            let allPlaylists = await getAllPlaylists();
            const favoritePlaylists = allPlaylists.filter(p => favorites.includes(p.id));

            if (favoritePlaylists.length === 0) {
                container.style.display = 'none'; emptyFavorites.style.display = 'block'; return;
            }
            container.style.display = 'grid'; emptyFavorites.style.display = 'none';

            container.innerHTML = favoritePlaylists.map(playlist => `
                <div class="playlist-card" onclick="viewPlaylist(${playlist.id})">
                    <div class="playlist-thumbnail">
                        <img src="${escapeHtml(playlist.thumbnail)}" alt="${escapeHtml(playlist.title)}">
                        <div class="overlay"><div class="overlay-icon"><i class="material-icons">play_arrow</i></div></div>
                    </div>
                    <div class="playlist-content">
                        <h3>${escapeHtml(playlist.title)}</h3>
                        <p>${escapeHtml(playlist.description)}</p>
                    </div>
                    <div class="playlist-info">
                        <div class="video-count">
                            <i class="material-icons" style="font-size: 14px;">play_circle</i>
                            ${playlist.videoCount} videos
                        </div>
                        <button class="btn-icon-small" onclick="toggleFavorite(event, ${playlist.id})">
                            <i class="material-icons" style="font-size: 18px; color: var(--neon-pink);">favorite</i>
                        </button>
                    </div>
                    <button class="btn btn-play" onclick="playPlaylist(event, ${playlist.id})">
                        <i class="material-icons left">play_arrow</i>Play All
                    </button>
                </div>
            `).join('');
        }

        function filterPlaylists(element) {
            document.querySelectorAll('.filter-chips .chip').forEach(chip => chip.classList.remove('active'));
            element.classList.add('active');
            currentFilter = element.dataset.filter;
            renderPlaylists(currentFilter);
        }

        function toggleFavorite(event, playlistId) {
            event.stopPropagation();
            const index = favorites.indexOf(playlistId);
            if (index > -1) { favorites.splice(index, 1); } else { favorites.push(playlistId); }
            localStorage.setItem('playlistFavorites', JSON.stringify(favorites));
            renderPlaylists(currentFilter);
            renderFavorites();
            M.toast({ html: index > -1 ? 'Removed from favorites' : 'Added to favorites', displayLength: 2000 });
        }

        async function playPlaylist(event, playlistId) {
            event.stopPropagation();
            const allPlaylists = await getAllPlaylists();
            const playlist = allPlaylists.find(p => p.id === playlistId);
            if (playlist && playlist.videos && playlist.videos.length > 0) {
                const firstVideo = playlist.videos[0];
                if (firstVideo.url) {
                    window.open(firstVideo.url, '_blank');
                    M.toast({ html: `Playing: ${escapeHtml(playlist.title)}`, displayLength: 3000 });
                }
            }
        }

        async function viewPlaylist(playlistId) {
            const allPlaylists = await getAllPlaylists();
            const playlist = allPlaylists.find(p => p.id === playlistId);
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'playlistModal';
            modal.style.maxHeight = '90vh';
            modal.innerHTML = `
                <div class="modal-content">
                    <h4>${escapeHtml(playlist.title)}</h4>
                    <p>${escapeHtml(playlist.description)}</p>
                    <div class="video-list" style="max-height: 60vh; overflow-y: auto;">
                        ${playlist.videos.map((video, index) => `
                            <div class="video-item" style="cursor: pointer; padding: 15px; display: flex; align-items: flex-start; gap: 15px;" onclick="window.open('${video.url}', '_blank')">
                                <div style="flex-shrink: 0; width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, var(--neon-pink), var(--neon-amber)); display: flex; align-items: center; justify-content: center;">
                                    <i class="material-icons" style="color: white; font-size: 20px;">play_arrow</i>
                                </div>
                                <div style="flex: 1;">
                                    <h6 style="margin: 0 0 6px 0; font-weight: 700; font-size: 14px;">${escapeHtml(video.title)}</h6>
                                    ${video.description ? `<p style="margin: 0; font-size: 12px; line-height: 1.4;">${escapeHtml(video.description)}</p>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-flat" onclick="closePlaylistModal()">Close</button>
                    <button class="btn btn-play" onclick="playPlaylist(event, ${playlist.id})">
                        <i class="material-icons left">play_arrow</i>Play First
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            const instance = M.Modal.init(modal, { dismissible: true });
            instance.open();
        }

        function closePlaylistModal() {
            const modal = document.getElementById('playlistModal');
            const instance = M.Modal.getInstance(modal);
            instance.close();
            modal.remove();
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (!query) { renderPlaylists(currentFilter); return; }
            const container = document.getElementById('playlistsContainer');
            const emptyState = document.getElementById('emptyState');
            const filtered = playlists.filter(p =>
                p.title.toLowerCase().includes(query) || p.description.toLowerCase().includes(query)
            );
            if (filtered.length === 0) { container.style.display = 'none'; emptyState.style.display = 'block'; return; }
            container.style.display = 'grid'; emptyState.style.display = 'none';
            container.innerHTML = filtered.map(playlist => `
                <div class="playlist-card" onclick="viewPlaylist(${playlist.id})">
                    <div class="playlist-thumbnail">
                        <img src="${escapeHtml(playlist.thumbnail)}" alt="${escapeHtml(playlist.title)}">
                        <div class="overlay"><div class="overlay-icon"><i class="material-icons">play_arrow</i></div></div>
                    </div>
                    <div class="playlist-content">
                        <h3>${escapeHtml(playlist.title)}</h3>
                        <p>${escapeHtml(playlist.description)}</p>
                    </div>
                    <div class="playlist-info">
                        <div class="video-count">
                            <i class="material-icons" style="font-size: 14px;">play_circle</i>
                            ${playlist.videoCount} videos
                        </div>
                    </div>
                    <button class="btn btn-play" onclick="playPlaylist(event, ${playlist.id})">
                        <i class="material-icons left">play_arrow</i>Play All
                    </button>
                </div>
            `).join('');
        }

        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }

        function openCreatePlaylistModal() { M.Modal.getInstance(document.getElementById('createPlaylistModal')).open(); }
        function closeCreatePlaylistModal() { M.Modal.getInstance(document.getElementById('createPlaylistModal')).close(); }

        function savePlaylist() {
            const title = document.getElementById('playlistTitle').value.trim();
            const description = document.getElementById('playlistDescription').value.trim();
            const category = document.getElementById('playlistCategory').value;
            const creator = document.getElementById('creatorName').value.trim();
            const emoji = document.getElementById('creatorEmoji').value || '';
            const videoLinks = document.getElementById('videoLinks').value;

            if (!title || !description || !category || !creator) {
                M.toast({ html: 'Please fill in all required fields', displayLength: 3000 }); return;
            }
            if (!videoLinks) {
                M.toast({ html: 'Please add at least one video link', displayLength: 3000 }); return;
            }

            const links = videoLinks.split(',').map(link => link.trim()).filter(link => link);
            const videos = links.map((link, index) => {
                const videoId = extractYouTubeVideoId(link);
                return { title: `Video ${index + 1}`, duration: '--:--', videoId: videoId || null };
            });

            const newPlaylist = {
                id: Date.now(), title, description, category,
                icon: emoji, videoCount: videos.length, creator,
                creatorBadge: emoji, featured: false,
                thumbnail: `https://via.placeholder.com/280x160?text=${encodeURIComponent(title)}`,
                videos, links
            };

            userPlaylists.push(newPlaylist);
            localStorage.setItem('userPlaylists', JSON.stringify(userPlaylists));

            document.getElementById('playlistTitle').value = '';
            document.getElementById('playlistDescription').value = '';
            document.getElementById('playlistCategory').value = '';
            document.getElementById('creatorName').value = '';
            document.getElementById('creatorEmoji').value = '';
            document.getElementById('videoLinks').value = '';
            M.updateTextFields();
            closeCreatePlaylistModal();
            M.toast({ html: `Playlist "${escapeHtml(title)}" created!`, displayLength: 3000 });
            renderPlaylists(currentFilter);
            renderFavorites();
        }

        function extractYouTubeVideoId(url) {
            if (!url) return null;
            if (/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,
                /^([a-zA-Z0-9_-]{11})$/
            ];
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) return match[1];
            }
            return null;
        }

        let currentPlaylist = null;
        let currentVideoIndex = 0;
        let videoPlayerModalInstance = null;
        let currentInvidiousInstance = null;

        const INVIDIOUS_INSTANCES = [
            'https://invidious.io', 'https://inv.nadeko.net',
            'https://invidious.snopyta.org', 'https://iv.ggtyler.dev',
            'https://invidious.nerdvpn.org'
        ];

        function initializeVideoPlayer() {
            videoPlayerModalInstance = M.Modal.init(document.getElementById('videoPlayerModal'), {
                dismissible: true,
                onCloseStart: function() { document.getElementById('videoPlayerFrame').src = ''; }
            });
        }

        async function testInvidiousInstance(instance) {
            try {
                const response = await fetch(`${instance}/api/v1/stats`, { timeout: 3000 });
                return response.ok;
            } catch (error) { return false; }
        }

        async function getWorkingInstance() {
            if (currentInvidiousInstance) return currentInvidiousInstance;
            for (const instance of INVIDIOUS_INSTANCES) {
                if (await testInvidiousInstance(instance)) {
                    currentInvidiousInstance = instance;
                    return instance;
                }
            }
            currentInvidiousInstance = INVIDIOUS_INSTANCES[0];
            return currentInvidiousInstance;
        }

        async function openVideoPlayer(videoId, playlist, videoIndex) {
            currentPlaylist = playlist;
            currentVideoIndex = videoIndex;
            const video = playlist.videos[videoIndex];
            document.getElementById('videoPlayerTitle').textContent = video.title;
            document.getElementById('videoPlayerSubtitle').textContent = `${playlist.title} - ${playlist.creator}`;
            document.getElementById('videoPosition').textContent = `${videoIndex + 1} / ${playlist.videos.length}`;
            const invidiousInstance = await getWorkingInstance();
            document.getElementById('videoPlayerFrame').src = `${invidiousInstance}/embed/${videoId}?autoplay=1`;
            document.getElementById('prevBtn').disabled = videoIndex === 0;
            document.getElementById('nextBtn').disabled = videoIndex === playlist.videos.length - 1;
            videoPlayerModalInstance.open();
        }

        function playNextVideo() {
            if (!currentPlaylist || currentVideoIndex >= currentPlaylist.videos.length - 1) {
                M.toast({ html: 'No more videos', displayLength: 2000 }); return;
            }
            currentVideoIndex++;
            openVideoPlayer(currentPlaylist.videos[currentVideoIndex].videoId, currentPlaylist, currentVideoIndex);
        }

        function playPreviousVideo() {
            if (!currentPlaylist || currentVideoIndex <= 0) {
                M.toast({ html: 'Already at first video', displayLength: 2000 }); return;
            }
            currentVideoIndex--;
            openVideoPlayer(currentPlaylist.videos[currentVideoIndex].videoId, currentPlaylist, currentVideoIndex);
        }

        function closeVideoPlayer() {
            videoPlayerModalInstance.close();
            currentPlaylist = null;
            currentVideoIndex = 0;
        }

        async function playIndividualVideo(videoId, playlistId, videoIndex) {
            const allPlaylists = await getAllPlaylists();
            const playlist = allPlaylists.find(p => p.id === playlistId);
            if (playlist) {
                closePlaylistModal();
                setTimeout(() => openVideoPlayer(videoId, playlist, videoIndex), 300);
            }
        }
    </script>
</body>
</html>
