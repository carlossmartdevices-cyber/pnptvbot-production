<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNPtv Videorama!</title>

    <!-- Materialize CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Unified Design System -->
    <link rel="stylesheet" href="/unified-design.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-top: 64px;
        }

        /* Navbar Styling */
        nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        nav .brand-logo {
            font-weight: 700;
            letter-spacing: 1px;
            margin-left: 20px;
        }

        nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Main Container */
        .main-container {
            background: white;
            border-radius: 8px;
            margin: 30px auto;
            max-width: 1200px;
            min-height: calc(100vh - 200px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        /* Header Section */
        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header-section p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Search & Filter Section */
        .search-section {
            padding: 30px;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
        }

        .search-wrapper {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input-field input {
            border-bottom: 2px solid #667eea;
        }

        .input-field input:focus {
            border-bottom-color: #764ba2;
            box-shadow: 0 1px 0 0 #764ba2;
        }

        .btn-search {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin-top: 5px;
        }

        .btn-search:hover {
            background: linear-gradient(135deg, #5568d3 0%, #663a91 100%);
        }

        .filter-chips {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .chip {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chip:hover,
        .chip.active {
            background: #667eea;
            color: white;
        }

        /* Content Area */
        .content-area {
            padding: 40px 30px;
            min-height: 600px;
        }

        /* Playlist Grid */
        .playlist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Playlist Card */
        .playlist-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .playlist-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .playlist-thumbnail {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            position: relative;
            overflow: hidden;
        }

        .playlist-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .playlist-thumbnail .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .playlist-card:hover .overlay {
            opacity: 1;
        }

        .overlay-icon {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: #667eea;
        }

        .playlist-content {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .playlist-content h3 {
            color: #333;
            font-size: 1.1rem;
            margin: 0 0 10px 0;
            font-weight: 600;
            line-height: 1.3;
        }

        .playlist-content p {
            color: #999;
            font-size: 0.9rem;
            margin: 0 0 15px 0;
            line-height: 1.4;
            flex-grow: 1;
        }

        .playlist-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
            color: #666;
            font-size: 0.85rem;
        }

        .video-count {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-play {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            margin-top: 10px;
            width: 100%;
        }

        .btn-play:hover {
            background: linear-gradient(135deg, #5568d3 0%, #663a91 100%);
        }

        /* Tabs */
        .tabs {
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
        }

        .tabs .tab a {
            color: #667eea;
            font-weight: 500;
        }

        .tabs .tab a.active {
            color: #764ba2;
            border-bottom: 3px solid #764ba2;
        }

        .tab-content {
            padding: 30px;
        }

        /* Video List */
        .video-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .video-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
            border: 1px solid #f0f0f0;
            transition: all 0.3s ease;
            cursor: pointer;
            align-items: flex-start;
        }

        .video-item:hover {
            background: #f9f9f9;
            border-color: #667eea;
        }

        .video-thumbnail {
            width: 100px;
            height: 70px;
            border-radius: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-info {
            flex-grow: 1;
        }

        .video-info h4 {
            color: #333;
            margin: 0 0 5px 0;
            font-weight: 600;
            line-height: 1.3;
        }

        .video-info p {
            color: #999;
            font-size: 0.85rem;
            margin: 0;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 30px;
            color: #999;
        }

        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            color: #666;
            margin-bottom: 10px;
        }

        /* Footer */
        .footer-section {
            background: #f5f5f5;
            border-top: 1px solid #e0e0e0;
            padding: 20px 30px;
            text-align: center;
            color: #999;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding-top: 56px;
            }

            .header-section h1 {
                font-size: 1.8rem;
            }

            .playlist-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }

            .search-wrapper {
                flex-direction: column;
            }

            .filter-chips {
                margin-top: 10px;
            }

            .playlist-card {
                margin: 0;
            }

            .main-container {
                margin: 15px auto;
                border-radius: 0;
            }
        }

        /* Loading Spinner */
        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
        }

        .preloader-wrapper.small {
            height: 36px;
            width: 36px;
            margin: auto;
        }

        /* Scrollbar Styling */
        .video-list::-webkit-scrollbar {
            width: 6px;
        }

        .video-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .video-list::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .video-list::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        /* Badge */
        .badge {
            background: #667eea;
            border-radius: 12px;
            padding: 4px 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            display: inline-block;
            margin-top: 10px;
        }

        .badge.featured {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Creator Badge */
        .creator-badge {
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid #667eea;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #667eea;
            font-weight: 600;
            white-space: nowrap;
            display: inline-block;
        }

        /* PNPtv Creator Badge (highlighted) */
        .creator-badge[title*="PNPtv"] {
            border-left-color: #FFD700;
            color: #FFD700;
            background: rgba(255, 215, 0, 0.15);
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
        }

        /* Floating Action Button */
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 999;
        }

        .btn-fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 600px) {
            .fab-container {
                bottom: 20px;
                right: 20px;
            }

            .btn-fab {
                width: 48px;
                height: 48px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-wrapper">
            <a href="/" class="brand-logo">
                <i class="material-icons" style="vertical-align: middle; margin-right: 10px;">play_circle_filled</i>
                PNPtv Videorama!
            </a>
            <ul class="right hide-on-med-and-down">
                <li><a href="/" title="Home"><i class="material-icons">home</i></a></li>
                <li><a href="/radio.html" title="Radio"><i class="material-icons">radio</i></a></li>
                <li><a href="/video-rooms.html" title="Video Rooms"><i class="material-icons">videocam</i></a></li>
                <li><a href="#language" title="Language"><i class="material-icons">language</i></a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <div class="header-section">
            <h1>ðŸŽ¬ PNPtv Videorama!</h1>
            <p>Discover and enjoy curated playlists from PNPtv</p>
        </div>

        <!-- Search & Filter -->
        <div class="search-section">
            <div class="search-wrapper">
                <div class="input-field" style="flex: 1; min-width: 250px;">
                    <i class="material-icons prefix">search</i>
                    <input id="searchInput" type="text" placeholder="Search playlists...">
                </div>
                <button class="btn btn-search" onclick="handleSearch()">
                    <i class="material-icons left">search</i>Search
                </button>
            </div>

            <div class="filter-chips">
                <div class="chip" data-filter="all" onclick="filterPlaylists(this)">
                    <i class="material-icons left">apps</i>All
                </div>
                <div class="chip" data-filter="featured" onclick="filterPlaylists(this)">
                    <i class="material-icons left">star</i>Featured
                </div>
                <div class="chip" data-filter="music" onclick="filterPlaylists(this)">
                    <i class="material-icons left">music_note</i>Music
                </div>
                <div class="chip" data-filter="podcast" onclick="filterPlaylists(this)">
                    <i class="material-icons left">podcasts</i>Podcasts
                </div>
                <div class="chip" data-filter="education" onclick="filterPlaylists(this)">
                    <i class="material-icons left">school</i>Education
                </div>
                <div class="chip" data-filter="entertainment" onclick="filterPlaylists(this)">
                    <i class="material-icons left">theaters</i>Entertainment
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="row" style="margin: 0; display: flex; align-items: center; padding: 10px 30px; background: #f5f5f5; border-bottom: 2px solid #e0e0e0;">
            <div class="col s12" style="flex: 1;">
                <ul class="tabs" style="margin: 0;">
                    <li class="tab col s6 m3">
                        <a class="active" href="#tab-playlists">
                            <i class="material-icons">playlist_play</i>Playlists
                        </a>
                    </li>
                    <li class="tab col s6 m3">
                        <a href="#tab-favorites">
                            <i class="material-icons">favorite</i>Favorites
                        </a>
                    </li>
                </ul>
            </div>
            <button class="btn" id="createPlaylistBtn" onclick="openCreatePlaylistModal()" style="margin-left: auto; margin-right: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <i class="material-icons left">add_circle</i>Create Playlist
            </button>
        </div>

        <!-- Create Playlist Modal -->
        <div id="createPlaylistModal" class="modal">
            <div class="modal-content">
                <h4>Create a New Playlist</h4>
                <p>Share your music taste with the PNPtv community!</p>

                <div class="input-field">
                    <input id="playlistTitle" type="text" placeholder="Playlist Title">
                    <label for="playlistTitle">Title</label>
                </div>

                <div class="input-field">
                    <textarea id="playlistDescription" class="materialize-textarea" placeholder="Describe your playlist..."></textarea>
                    <label for="playlistDescription">Description</label>
                </div>

                <div class="input-field">
                    <select id="playlistCategory">
                        <option value="">Select Category</option>
                        <option value="music">Music</option>
                        <option value="podcast">Podcast</option>
                        <option value="education">Education</option>
                        <option value="entertainment">Entertainment</option>
                    </select>
                    <label>Category</label>
                </div>

                <div class="input-field">
                    <input id="creatorName" type="text" placeholder="Your Name">
                    <label for="creatorName">Creator Name</label>
                </div>

                <div class="input-field">
                    <input id="creatorEmoji" type="text" value="ðŸ‘¤" placeholder="Pick an emoji" maxlength="2">
                    <label for="creatorEmoji">Creator Emoji (optional)</label>
                </div>

                <div class="input-field">
                    <input id="videoLinks" type="text" placeholder="YouTube links (comma-separated)">
                    <label for="videoLinks">Video Links (comma-separated)</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-flat" onclick="closeCreatePlaylistModal()">Cancel</button>
                <button class="btn" onclick="savePlaylist()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="material-icons left">check</i>Create Playlist
                </button>
            </div>
        </div>

        <div class="row" style="margin: 0;">

            <!-- Playlists Tab -->
            <div id="tab-playlists" class="col s12 tab-content">
                <div id="playlistsContainer" class="playlist-grid">
                    <!-- Playlists will be loaded here -->
                </div>
                <div id="emptyState" class="empty-state" style="display: none;">
                    <i class="material-icons">not_interested</i>
                    <h3>No playlists found</h3>
                    <p>Try adjusting your search filters</p>
                </div>
            </div>

            <!-- Favorites Tab -->
            <div id="tab-favorites" class="col s12 tab-content">
                <div id="favoritesContainer" class="playlist-grid">
                    <!-- Favorite playlists will be loaded here -->
                </div>
                <div id="emptyFavorites" class="empty-state">
                    <i class="material-icons">favorite_border</i>
                    <h3>No favorites yet</h3>
                    <p>Start adding playlists to your favorites by clicking the heart icon</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer-section">
            <p>&copy; 2025 PNPtv. Powered by Invidious. All rights reserved.</p>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="btn-fab" onclick="scrollToTop()" title="Back to top">
            <i class="material-icons">arrow_upward</i>
        </button>
    </div>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
        // PNPtv Featured Playlist (Official)
        let playlists = [
            {
                id: 1,
                title: 'Emotional Rollercoaster',
                description: 'A narrative journey through impulse, euphoria, anxiety, numbness, and vulnerability',
                category: 'music',
                icon: 'ðŸŽ¢',
                videoCount: 9,
                featured: true,
                creator: 'PNPtv',
                creatorBadge: 'ðŸ‘‘',
                thumbnail: 'https://via.placeholder.com/280x160?text=Emotional+Rollercoaster',
                videos: [
                    { title: 'Hash Pipe - Arranque acelerado, impulsivo', duration: '3:18' },
                    { title: 'Come Undone - La euforia empieza a resquebrajarse', duration: '3:47' },
                    { title: 'Don\'t Let Me Get Me - Auto-odio, frustraciÃ³n', duration: '3:36' },
                    { title: 'Numb / Encore - SaturaciÃ³n total', duration: '7:20' },
                    { title: 'Habits (Stay High) - Intento de anestesiar', duration: '3:54' },
                    { title: 'Novacane - DesconexiÃ³n emocional', duration: '3:52' },
                    { title: 'When It Hurts So Bad - Vulnerabilidad cruda', duration: '4:08' },
                    { title: 'Don\'t Leave Home - Aislamiento y miedo', duration: '4:33' },
                    { title: 'La Plata - Aterrizaje latino y terrenal', duration: '3:55' }
                ]
            }
        ];

        let currentFilter = 'all';
        let favorites = JSON.parse(localStorage.getItem('playlistFavorites')) || [];
        let userPlaylists = JSON.parse(localStorage.getItem('userPlaylists')) || [];

        // Merge all playlists (PNPtv + user)
        function getAllPlaylists() {
            let allPlaylists = [...playlists];

            // Add user playlists with random featured status
            userPlaylists.forEach(userPlaylist => {
                allPlaylists.push({
                    ...userPlaylist,
                    featured: Math.random() < 0.3 // 30% chance of being featured
                });
            });

            return allPlaylists;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            M.Tabs.init(document.querySelectorAll('.tabs'));
            renderPlaylists();
            renderFavorites();
        });

        // Render Playlists
        function renderPlaylists(filter = 'all') {
            const container = document.getElementById('playlistsContainer');
            const emptyState = document.getElementById('emptyState');

            let allPlaylists = getAllPlaylists();
            let filtered = allPlaylists;

            if (filter !== 'all') {
                filtered = allPlaylists.filter(p => p.category === filter);
            }

            if (filtered.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            emptyState.style.display = 'none';

            container.innerHTML = filtered.map(playlist => `
                <div class="playlist-card" onclick="viewPlaylist(${playlist.id})">
                    <div class="playlist-thumbnail">
                        <img src="${playlist.thumbnail}" alt="${playlist.title}">
                        <div class="overlay">
                            <div class="overlay-icon">
                                <i class="material-icons">play_arrow</i>
                            </div>
                        </div>
                    </div>
                    <div class="playlist-content">
                        <h3>${playlist.title}</h3>
                        <p>${playlist.description}</p>
                        <div style="margin-top: auto; display: flex; gap: 8px; align-items: center;">
                            ${playlist.featured ? '<span class="badge featured">Featured</span>' : ''}
                            <span class="creator-badge" title="Created by ${playlist.creator}">
                                ${playlist.creatorBadge || 'ðŸ‘¤'} ${playlist.creator}
                            </span>
                        </div>
                    </div>
                    <div class="playlist-info">
                        <div class="video-count">
                            <i class="material-icons" style="font-size: 1rem;">play_circle</i>
                            ${playlist.videoCount} videos
                        </div>
                        <button class="btn-icon-small" onclick="toggleFavorite(event, ${playlist.id})" title="Add to favorites">
                            <i class="material-icons" style="font-size: 1.2rem; color: ${favorites.includes(playlist.id) ? '#667eea' : '#ccc'};">
                                ${favorites.includes(playlist.id) ? 'favorite' : 'favorite_border'}
                            </i>
                        </button>
                    </div>
                    <button class="btn btn-play" onclick="playPlaylist(event, ${playlist.id})">
                        <i class="material-icons left">play_arrow</i>Play All
                    </button>
                </div>
            `).join('');
        }

        // Render Favorites
        function renderFavorites() {
            const container = document.getElementById('favoritesContainer');
            const emptyFavorites = document.getElementById('emptyFavorites');

            let allPlaylists = getAllPlaylists();
            const favoritePlaylists = allPlaylists.filter(p => favorites.includes(p.id));

            if (favoritePlaylists.length === 0) {
                container.style.display = 'none';
                emptyFavorites.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            emptyFavorites.style.display = 'none';

            container.innerHTML = favoritePlaylists.map(playlist => `
                <div class="playlist-card" onclick="viewPlaylist(${playlist.id})">
                    <div class="playlist-thumbnail">
                        <img src="${playlist.thumbnail}" alt="${playlist.title}">
                        <div class="overlay">
                            <div class="overlay-icon">
                                <i class="material-icons">play_arrow</i>
                            </div>
                        </div>
                    </div>
                    <div class="playlist-content">
                        <h3>${playlist.title}</h3>
                        <p>${playlist.description}</p>
                        <div style="margin-top: auto; display: flex; gap: 8px; align-items: center;">
                            ${playlist.featured ? '<span class="badge featured">Featured</span>' : ''}
                            <span class="creator-badge" title="Created by ${playlist.creator}">
                                ${playlist.creatorBadge || 'ðŸ‘¤'} ${playlist.creator}
                            </span>
                        </div>
                    </div>
                    <div class="playlist-info">
                        <div class="video-count">
                            <i class="material-icons" style="font-size: 1rem;">play_circle</i>
                            ${playlist.videoCount} videos
                        </div>
                        <button class="btn-icon-small" onclick="toggleFavorite(event, ${playlist.id})" title="Remove from favorites">
                            <i class="material-icons" style="font-size: 1.2rem; color: #667eea;">favorite</i>
                        </button>
                    </div>
                    <button class="btn btn-play" onclick="playPlaylist(event, ${playlist.id})">
                        <i class="material-icons left">play_arrow</i>Play All
                    </button>
                </div>
            `).join('');
        }

        // Filter Playlists
        function filterPlaylists(element) {
            document.querySelectorAll('.filter-chips .chip').forEach(chip => {
                chip.classList.remove('active');
            });
            element.classList.add('active');

            currentFilter = element.dataset.filter;
            renderPlaylists(currentFilter);
        }

        // Toggle Favorite
        function toggleFavorite(event, playlistId) {
            event.stopPropagation();

            const index = favorites.indexOf(playlistId);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(playlistId);
            }

            localStorage.setItem('playlistFavorites', JSON.stringify(favorites));
            renderPlaylists(currentFilter);
            renderFavorites();

            M.toast({
                html: index > -1 ? 'Removed from favorites' : 'Added to favorites',
                displayLength: 2000
            });
        }

        // Play Playlist
        function playPlaylist(event, playlistId) {
            event.stopPropagation();
            const playlist = playlists.find(p => p.id === playlistId);

            M.toast({
                html: `<i class="material-icons left">play_arrow</i>Playing: ${playlist.title}`,
                displayLength: 3000
            });

            // In a real application, this would redirect to the video player
            // window.location.href = `/player.html?playlist=${playlistId}`;
        }

        // View Playlist Details
        function viewPlaylist(playlistId) {
            const playlist = playlists.find(p => p.id === playlistId);

            // Show modal with playlist details
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'playlistModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h4>${playlist.title}</h4>
                    <p>${playlist.description}</p>
                    <div class="video-list">
                        ${playlist.videos.map(video => `
                            <div class="video-item">
                                <div class="video-thumbnail">
                                    <i class="material-icons">play_circle</i>
                                </div>
                                <div class="video-info">
                                    <h4>${video.title}</h4>
                                    <p>${video.duration}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-flat" onclick="closePlaylistModal()">Close</button>
                    <button class="btn btn-play" onclick="playPlaylist(event, ${playlist.id})">
                        <i class="material-icons left">play_arrow</i>Play All
                    </button>
                </div>
            `;

            document.body.appendChild(modal);
            const instance = M.Modal.init(modal);
            instance.open();
        }

        // Close Playlist Modal
        function closePlaylistModal() {
            const modal = document.getElementById('playlistModal');
            const instance = M.Modal.getInstance(modal);
            instance.close();
            modal.remove();
        }

        // Search
        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();

            if (!query) {
                renderPlaylists(currentFilter);
                return;
            }

            const container = document.getElementById('playlistsContainer');
            const emptyState = document.getElementById('emptyState');

            const filtered = playlists.filter(p =>
                p.title.toLowerCase().includes(query) ||
                p.description.toLowerCase().includes(query)
            );

            if (filtered.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            emptyState.style.display = 'none';

            container.innerHTML = filtered.map(playlist => `
                <div class="playlist-card" onclick="viewPlaylist(${playlist.id})">
                    <div class="playlist-thumbnail">
                        <img src="${playlist.thumbnail}" alt="${playlist.title}">
                        <div class="overlay">
                            <div class="overlay-icon">
                                <i class="material-icons">play_arrow</i>
                            </div>
                        </div>
                    </div>
                    <div class="playlist-content">
                        <h3>${playlist.title}</h3>
                        <p>${playlist.description}</p>
                    </div>
                    <div class="playlist-info">
                        <div class="video-count">
                            <i class="material-icons" style="font-size: 1rem;">play_circle</i>
                            ${playlist.videoCount} videos
                        </div>
                    </div>
                    <button class="btn btn-play" onclick="playPlaylist(event, ${playlist.id})">
                        <i class="material-icons left">play_arrow</i>Play All
                    </button>
                </div>
            `).join('');
        }

        // Scroll to Top
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Search on Enter
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
        });

        // Set first chip as active
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('.filter-chips .chip').classList.add('active');
            M.Modal.init(document.getElementById('createPlaylistModal'));
            M.updateTextFields();
            M.FormSelect.init(document.querySelectorAll('select'));
        });

        // Create Playlist Modal Functions
        function openCreatePlaylistModal() {
            const modal = M.Modal.getInstance(document.getElementById('createPlaylistModal'));
            modal.open();
        }

        function closeCreatePlaylistModal() {
            const modal = M.Modal.getInstance(document.getElementById('createPlaylistModal'));
            modal.close();
        }

        function savePlaylist() {
            const title = document.getElementById('playlistTitle').value.trim();
            const description = document.getElementById('playlistDescription').value.trim();
            const category = document.getElementById('playlistCategory').value;
            const creator = document.getElementById('creatorName').value.trim();
            const emoji = document.getElementById('creatorEmoji').value || 'ðŸ‘¤';
            const videoLinks = document.getElementById('videoLinks').value;

            // Validation
            if (!title || !description || !category || !creator) {
                M.toast({
                    html: '<i class="material-icons left">warning</i>Please fill in all required fields',
                    displayLength: 3000
                });
                return;
            }

            if (!videoLinks) {
                M.toast({
                    html: '<i class="material-icons left">warning</i>Please add at least one video link',
                    displayLength: 3000
                });
                return;
            }

            // Parse video links and create videos array
            const links = videoLinks.split(',').map(link => link.trim()).filter(link => link);
            const videos = links.map((link, index) => ({
                title: `Video ${index + 1}`,
                duration: '--:--'
            }));

            // Create new playlist
            const newPlaylist = {
                id: Date.now(), // Use timestamp as unique ID
                title: title,
                description: description,
                category: category,
                icon: emoji,
                videoCount: videos.length,
                creator: creator,
                creatorBadge: emoji,
                featured: false, // User playlists start as not featured, but have 30% chance when rendered
                thumbnail: `https://via.placeholder.com/280x160?text=${encodeURIComponent(title)}`,
                videos: videos,
                links: links
            };

            // Save to localStorage
            userPlaylists.push(newPlaylist);
            localStorage.setItem('userPlaylists', JSON.stringify(userPlaylists));

            // Reset form and close modal
            document.getElementById('playlistTitle').value = '';
            document.getElementById('playlistDescription').value = '';
            document.getElementById('playlistCategory').value = '';
            document.getElementById('creatorName').value = '';
            document.getElementById('creatorEmoji').value = 'ðŸ‘¤';
            document.getElementById('videoLinks').value = '';

            M.updateTextFields();

            closeCreatePlaylistModal();

            // Show success message
            M.toast({
                html: `<i class="material-icons left">check_circle</i>Playlist "${title}" created successfully!`,
                displayLength: 3000
            });

            // Refresh the playlists view
            renderPlaylists(currentFilter);
            renderFavorites();
        }
    </script>
</body>
</html>
