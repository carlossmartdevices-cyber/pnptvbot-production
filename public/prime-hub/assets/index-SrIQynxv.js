import{r as o,a as M,u as L,b as O,c as k,L as j,R as I,d as p,N as E,e as $,B as F}from"./vendor-0FvsYARo.js";import{T as A,F as U,H as D,R as W,U as S,M as T,a as R,b as C,c as _,d as B,e as V,f as X,C as Y,g as G,I as J,G as Z,L as K}from"./icons-Bwqvc8-k.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const t of l.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}})();var H={exports:{}},y={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q=o,ee=Symbol.for("react.element"),se=Symbol.for("react.fragment"),ae=Object.prototype.hasOwnProperty,te=Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ie={key:!0,ref:!0,__self:!0,__source:!0};function z(a,i,r){var s,n={},l=null,t=null;r!==void 0&&(l=""+r),i.key!==void 0&&(l=""+i.key),i.ref!==void 0&&(t=i.ref);for(s in i)ae.call(i,s)&&!ie.hasOwnProperty(s)&&(n[s]=i[s]);if(a&&a.defaultProps)for(s in i=a.defaultProps,i)n[s]===void 0&&(n[s]=i[s]);return{$$typeof:ee,type:a,key:l,ref:t,props:n,_owner:te.current}}y.Fragment=se;y.jsx=z;y.jsxs=z;H.exports=y;var e=H.exports,w={},P=M;w.createRoot=P.createRoot,w.hydrateRoot=P.hydrateRoot;const ne="/api/webapp";async function f(a,i={}){const r=`${ne}${a}`,s=await fetch(r,{credentials:"include",headers:{"Content-Type":"application/json",...i.headers},...i}),n=await s.json();if(!s.ok)throw new Error(n.error||`Request failed (${s.status})`);return n}const v={authStatus:()=>f("/auth/status"),telegramLogin:a=>f("/auth/telegram",{method:"POST",body:JSON.stringify({telegramUser:a})}),xLoginStart:()=>f("/auth/x/start"),logout:()=>f("/auth/logout",{method:"POST"}),getProfile:()=>f("/profile"),getMastodonFeed:(a=10)=>f(`/mastodon/feed?limit=${a}`),getMediaLibrary:(a="all",i=50)=>fetch(`/api/media/library?type=${a}&limit=${i}`,{credentials:"include"}).then(r=>r.json()),getRadioNowPlaying:()=>fetch("/api/radio/now-playing",{credentials:"include"}).then(a=>a.json()),getPublicHangouts:()=>fetch("/api/hangouts/public",{credentials:"include"}).then(a=>a.json())},q=o.createContext(null);function re({children:a}){const[i,r]=o.useState(null),[s,n]=o.useState(!0),l=o.useCallback(async()=>{try{const c=await v.authStatus();c.authenticated?r(c.user):r(null)}catch{r(null)}finally{n(!1)}},[]);o.useEffect(()=>{l()},[l]);const t=o.useCallback(async c=>{const x=await v.telegramLogin(c);return x.authenticated&&x.registered?(r(x.user),{success:!0}):{success:!1,...x}},[]),m=o.useCallback(async()=>{const c=await v.xLoginStart();c.success&&c.url&&(window.location.href=c.url)},[]),u=o.useCallback(async()=>{await v.logout(),r(null)},[]);return e.jsx(q.Provider,{value:{user:i,loading:s,loginWithTelegram:t,loginWithX:m,logout:u,checkAuth:l},children:a})}function b(){const a=o.useContext(q);if(!a)throw new Error("useAuth must be used within AuthProvider");return a}function le(){const a=L(),[i]=O(),{user:r,loginWithTelegram:s,loginWithX:n}=b(),[l,t]=o.useState(""),[m,u]=o.useState(!1);o.useEffect(()=>{r&&a("/",{replace:!0})},[r,a]),o.useEffect(()=>{const h=i.get("error");if(h==="not_registered"){const d=i.get("x_handle");t(d?`X account @${d} is not linked to any PNPtv account. Please register via the Telegram bot first.`:"Account not registered. Please use the Telegram bot first.")}else h==="auth_failed"?t("Authentication failed. Please try again."):h==="missing_params"&&t("Authentication was incomplete. Please try again.")},[i]),o.useEffect(()=>{i.get("auth")==="success"&&r&&a("/",{replace:!0})},[i,r,a]);const c=o.useCallback(async h=>{t(""),u(!0);try{const d=await s(h);d.success?a("/",{replace:!0}):d.registered?t(d.message||"Login failed"):t("Your Telegram account is not registered. Please start the bot first: @PNPLatinoTV_bot")}catch(d){t(d.message||"Authentication failed")}finally{u(!1)}},[s,a]);o.useEffect(()=>(window.onTelegramWidgetAuth=c,()=>{delete window.onTelegramWidgetAuth}),[c]),o.useEffect(()=>{const h=document.getElementById("telegram-widget-container");if(!h)return;h.innerHTML="";const d=document.createElement("script");d.src="https://telegram.org/js/telegram-widget.js?22",d.async=!0,d.setAttribute("data-telegram-login","pnptvbot"),d.setAttribute("data-size","large"),d.setAttribute("data-radius","10"),d.setAttribute("data-onauth","onTelegramWidgetAuth(user)"),d.setAttribute("data-request-access","write"),h.appendChild(d)},[]);const x=async()=>{t(""),u(!0);try{await n()}catch(h){t(h.message||"Failed to start X authentication"),u(!1)}};return e.jsxs("div",{className:"login-page",children:[e.jsx("div",{className:"ambient-glow"}),e.jsxs("div",{className:"login-card",children:[e.jsx("div",{className:"login-logo",children:"PNPtv"}),e.jsx("h1",{children:"PRIME Hub"}),e.jsx("p",{className:"subtitle",children:"Sign in to access the PNPtv community"}),l&&e.jsx("div",{className:"login-error",children:l}),e.jsx("div",{id:"telegram-widget-container",style:{display:"flex",justifyContent:"center",minHeight:48}}),e.jsx("div",{className:"login-divider",children:"or"}),e.jsxs("button",{className:"btn-login btn-x",onClick:x,disabled:m,children:[e.jsx(A,{size:18}),"Sign in with X"]}),e.jsxs("p",{className:"login-footer",children:["By signing in, you agree to our"," ",e.jsx("a",{href:"/terms",target:"_blank",rel:"noopener",children:"Terms & Conditions"})," ","and"," ",e.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener",children:"Privacy Policy"}),".",e.jsx("br",{}),"You must be 18+ to use this platform."]})]})]})}function ce(){const{user:a}=b(),i=k();return e.jsxs("header",{className:"app-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(j,{to:"/",className:"header-logo",children:"PNP"}),e.jsx(j,{to:"/",className:"header-title",children:"PRIME Zone"})]}),e.jsxs("nav",{className:"header-nav",children:[e.jsx("a",{href:"/terms",target:"_blank",rel:"noopener",className:"header-nav-btn",title:"Terms and Conditions",children:e.jsx(U,{size:18})}),e.jsx("a",{href:"https://t.me/PNPtvbot",target:"_blank",rel:"noopener",className:"header-nav-btn",title:"Support",children:e.jsx(D,{size:18})})]}),e.jsxs("div",{className:"header-right",children:[e.jsx(j,{to:"/",className:`header-nav-btn ${i.pathname==="/"?"active":""}`,title:"Mastodon Feed",children:e.jsx(W,{size:18})}),e.jsx(j,{to:"/profile",title:"My Profile",children:e.jsx("div",{className:"header-avatar",children:a!=null&&a.photoUrl?e.jsx("img",{src:a.photoUrl,alt:a.username||"Profile"}):e.jsx(S,{size:18,color:"#8E8E93"})})})]})]})}const oe=[{path:"/nearby",label:"Nearby",icon:T},{path:"/hangouts",label:"Hangouts",icon:R},{path:"/live",label:"Live",icon:C},{path:"/videorama",label:"Videorama",icon:_}];function de(){const a=k();return e.jsx("nav",{className:"app-footer",children:oe.map(({path:i,label:r,icon:s})=>e.jsxs(j,{to:i,className:`footer-tab ${a.pathname===i?"active":""}`,children:[e.jsx(s,{size:22}),r]},i))})}function N({children:a}){return e.jsxs("div",{className:"app-layout",children:[e.jsx(ce,{}),e.jsx("main",{className:"app-main",children:a}),e.jsx(de,{})]})}function ue(){const[a,i]=o.useState([]),[r,s]=o.useState(!0);if(o.useEffect(()=>{let t=!1;return v.getMastodonFeed(5).then(m=>{t||i(m.posts||[])}).catch(()=>{}).finally(()=>{t||s(!1)}),()=>{t=!0}},[]),r)return e.jsxs("div",{className:"card",style:{textAlign:"center",padding:32},children:[e.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}}),e.jsx("p",{style:{marginTop:12,color:"var(--text-muted)",fontSize:13},children:"Loading feed..."})]});if(a.length===0)return e.jsx("div",{className:"card",style:{textAlign:"center",padding:24},children:e.jsx("p",{style:{color:"var(--text-muted)",fontSize:14},children:"No posts available right now. Check back later."})});function n(t){const m=document.createElement("div");return m.innerHTML=t||"",m.textContent||m.innerText||""}function l(t){const m=Date.now()-new Date(t).getTime(),u=Math.floor(m/6e4);if(u<1)return"now";if(u<60)return`${u}m`;const c=Math.floor(u/60);return c<24?`${c}h`:`${Math.floor(c/24)}d`}return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("span",{className:"card-title",children:"Community Feed"}),e.jsx("span",{className:"card-subtitle",children:"via Mastodon"})]}),a.map(t=>{var m,u,c,x;return e.jsxs("div",{className:"feed-post",children:[e.jsxs("div",{className:"feed-post-header",children:[e.jsx("div",{className:"feed-avatar",children:((m=t.account)==null?void 0:m.avatar)&&e.jsx("img",{src:t.account.avatar,alt:""})}),e.jsxs("div",{children:[e.jsx("div",{className:"feed-author",children:((u=t.account)==null?void 0:u.displayName)||((c=t.account)==null?void 0:c.username)||"PNPtv"}),e.jsx("div",{className:"feed-time",children:l(t.createdAt)})]})]}),e.jsxs("div",{className:"feed-content",children:[n(t.content).slice(0,280),n(t.content).length>280&&"..."]}),((x=t.mediaAttachments)==null?void 0:x.length)>0&&e.jsx("div",{style:{marginTop:8,borderRadius:8,overflow:"hidden"},children:t.mediaAttachments.slice(0,1).map((h,d)=>h.type==="image"&&e.jsx("img",{src:h.previewUrl||h.url,alt:"",style:{width:"100%",borderRadius:8}},d))}),e.jsxs("div",{className:"feed-stats",children:[e.jsxs("span",{className:"feed-stat",children:[e.jsx(B,{size:14})," ",t.favouritesCount||0]}),e.jsxs("span",{className:"feed-stat",children:[e.jsx(V,{size:14})," ",t.reblogsCount||0]}),e.jsxs("span",{className:"feed-stat",children:[e.jsx(X,{size:14})," ",t.repliesCount||0]})]})]},t.id)})]})}function me(){const{user:a}=b();return e.jsxs(N,{children:[e.jsxs("div",{className:"welcome-banner",children:[e.jsxs("h2",{children:["Welcome",a!=null&&a.firstName?`, ${a.firstName}`:"","!"]}),e.jsx("p",{children:"Your PRIME Zone hub - explore, connect, and enjoy."})]}),e.jsx("div",{className:"section-label",children:"Explore"}),e.jsxs("div",{className:"quick-actions",children:[e.jsxs(j,{to:"/nearby",className:"card quick-action",children:[e.jsx("div",{className:"quick-action-icon nearby",children:e.jsx(T,{size:24})}),e.jsx("span",{className:"quick-action-label",children:"Nearby"}),e.jsx("span",{className:"quick-action-desc",children:"Discover members near you"})]}),e.jsxs(j,{to:"/hangouts",className:"card quick-action",children:[e.jsx("div",{className:"quick-action-icon hangouts",children:e.jsx(R,{size:24})}),e.jsx("span",{className:"quick-action-label",children:"Hangouts"}),e.jsx("span",{className:"quick-action-desc",children:"Video call rooms"})]}),e.jsxs(j,{to:"/live",className:"card quick-action",children:[e.jsx("div",{className:"quick-action-icon live",children:e.jsx(C,{size:24})}),e.jsx("span",{className:"quick-action-label",children:"Live"}),e.jsx("span",{className:"quick-action-desc",children:"Live performances"})]}),e.jsxs(j,{to:"/videorama",className:"card quick-action",children:[e.jsx("div",{className:"quick-action-icon videorama",children:e.jsx(_,{size:24})}),e.jsx("span",{className:"quick-action-label",children:"Videorama"}),e.jsx("span",{className:"quick-action-desc",children:"Media center"})]})]}),e.jsx("div",{className:"section-label",children:"Latest Posts"}),e.jsx(ue,{})]})}function he({status:a}){const r={active:{label:"Active",className:"active"},lifetime:{label:"Lifetime",className:"active"},trial:{label:"Trial",className:"active"},expired:{label:"Expired",className:"expired"},cancelled:{label:"Cancelled",className:"expired"}}[a]||{label:a||"Inactive",className:"inactive"};return e.jsx("span",{className:`sub-badge ${r.className}`,children:r.label})}function xe(){const{user:a,logout:i}=b(),r=L(),[s,n]=o.useState(null),[l,t]=o.useState(!0);o.useEffect(()=>{let c=!1;return v.getProfile().then(x=>{!c&&x.success&&n(x.profile)}).catch(()=>{}).finally(()=>{c||t(!1)}),()=>{c=!0}},[]);const m=async()=>{await i(),r("/login",{replace:!0})},u=c=>c?new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A";return e.jsx(N,{children:l?e.jsx("div",{style:{textAlign:"center",padding:48},children:e.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card profile-header-card",children:[e.jsx("div",{className:"profile-avatar",children:s!=null&&s.photoUrl||a!=null&&a.photoUrl?e.jsx("img",{src:(s==null?void 0:s.photoUrl)||(a==null?void 0:a.photoUrl),alt:"Profile"}):e.jsx(S,{size:40,color:"#8E8E93"})}),e.jsxs("div",{className:"profile-name",children:[(s==null?void 0:s.firstName)||(a==null?void 0:a.firstName)||""," ",(s==null?void 0:s.lastName)||(a==null?void 0:a.lastName)||""]}),e.jsxs("div",{className:"profile-username",children:["@",(s==null?void 0:s.username)||(a==null?void 0:a.username)||"user"]}),(s==null?void 0:s.bio)&&e.jsx("p",{className:"profile-bio",children:s.bio}),e.jsxs("div",{className:"profile-stats",children:[e.jsxs("div",{className:"profile-stat",children:[e.jsx("div",{className:"profile-stat-value",children:e.jsx(Y,{size:16,style:{display:"inline",verticalAlign:"middle"}})}),e.jsx("div",{className:"profile-stat-label",children:e.jsx(he,{status:(s==null?void 0:s.subscriptionStatus)||(a==null?void 0:a.subscriptionStatus)})})]}),e.jsxs("div",{className:"profile-stat",children:[e.jsx("div",{className:"profile-stat-value",children:e.jsx(G,{size:16,style:{display:"inline",verticalAlign:"middle"}})}),e.jsxs("div",{className:"profile-stat-label",children:["Member since ",u(s==null?void 0:s.memberSince)]})]})]})]}),e.jsx("div",{className:"section-label",children:"Account"}),e.jsxs("div",{className:"card profile-section",children:[e.jsxs("div",{className:"profile-row",children:[e.jsx("span",{className:"profile-row-label",children:"Subscription Plan"}),e.jsx("span",{className:"profile-row-value",children:(s==null?void 0:s.subscriptionPlan)||"None"})]}),(s==null?void 0:s.subscriptionExpires)&&e.jsxs("div",{className:"profile-row",children:[e.jsx("span",{className:"profile-row-label",children:"Expires"}),e.jsx("span",{className:"profile-row-value",children:u(s.subscriptionExpires)})]}),e.jsxs("div",{className:"profile-row",children:[e.jsx("span",{className:"profile-row-label",children:"Language"}),e.jsx("span",{className:"profile-row-value",children:(s==null?void 0:s.language)==="es"?"Espanol":"English"})]}),(s==null?void 0:s.locationText)&&e.jsxs("div",{className:"profile-row",children:[e.jsx("span",{className:"profile-row-label",children:"Location"}),e.jsx("span",{className:"profile-row-value",children:s.locationText})]})]}),((s==null?void 0:s.xHandle)||(s==null?void 0:s.instagramHandle)||(s==null?void 0:s.tiktokHandle))&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"section-label",children:"Social"}),e.jsxs("div",{className:"card profile-section",children:[(s==null?void 0:s.xHandle)&&e.jsxs("div",{className:"profile-row",children:[e.jsxs("span",{className:"profile-row-label",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(A,{size:14})," X (Twitter)"]}),e.jsxs("span",{className:"profile-row-value",children:["@",s.xHandle]})]}),(s==null?void 0:s.instagramHandle)&&e.jsxs("div",{className:"profile-row",children:[e.jsxs("span",{className:"profile-row-label",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(J,{size:14})," Instagram"]}),e.jsxs("span",{className:"profile-row-value",children:["@",s.instagramHandle]})]}),(s==null?void 0:s.tiktokHandle)&&e.jsxs("div",{className:"profile-row",children:[e.jsxs("span",{className:"profile-row-label",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(Z,{size:14})," TikTok"]}),e.jsxs("span",{className:"profile-row-value",children:["@",s.tiktokHandle]})]})]})]}),(s==null?void 0:s.interests)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"section-label",children:"Interests"}),e.jsx("div",{className:"card profile-section",children:e.jsx("p",{style:{fontSize:14,color:"var(--text-secondary)"},children:Array.isArray(s.interests)?s.interests.join(", "):String(s.interests)})})]}),e.jsxs("button",{className:"btn-logout",onClick:m,children:[e.jsx(K,{size:16,style:{display:"inline",verticalAlign:"middle",marginRight:8}}),"Sign Out"]})]})})}function je(){return e.jsxs(N,{children:[e.jsx("div",{className:"section-label",children:"Nearby"}),e.jsx("div",{className:"feature-page",children:e.jsx("iframe",{className:"feature-iframe",src:"/nearby",title:"Nearby",allow:"geolocation",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups"})})]})}function pe(){return e.jsxs(N,{children:[e.jsx("div",{className:"section-label",children:"Hangouts"}),e.jsx("div",{className:"feature-page",children:e.jsx("iframe",{className:"feature-iframe",src:"/hangouts",title:"Hangouts",allow:"camera; microphone; display-capture",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups"})})]})}function fe(){return e.jsxs(N,{children:[e.jsx("div",{className:"section-label",children:"PNP Live"}),e.jsx("div",{className:"feature-page",children:e.jsx("iframe",{className:"feature-iframe",src:"/live",title:"Live",allow:"camera; microphone",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups"})})]})}function ge(){return e.jsxs(N,{children:[e.jsx("div",{className:"section-label",children:"Videorama"}),e.jsx("div",{className:"feature-page",children:e.jsx("iframe",{className:"feature-iframe",src:"/videorama",title:"Videorama",allow:"autoplay; fullscreen",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups"})})]})}function g({children:a}){const{user:i,loading:r}=b();return r?e.jsxs("div",{className:"loading-screen",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading..."})]}):i?a:e.jsx(E,{to:"/login",replace:!0})}function ve(){return e.jsx(re,{children:e.jsxs(I,{children:[e.jsx(p,{path:"/login",element:e.jsx(le,{})}),e.jsx(p,{path:"/",element:e.jsx(g,{children:e.jsx(me,{})})}),e.jsx(p,{path:"/profile",element:e.jsx(g,{children:e.jsx(xe,{})})}),e.jsx(p,{path:"/nearby",element:e.jsx(g,{children:e.jsx(je,{})})}),e.jsx(p,{path:"/hangouts",element:e.jsx(g,{children:e.jsx(pe,{})})}),e.jsx(p,{path:"/live",element:e.jsx(g,{children:e.jsx(fe,{})})}),e.jsx(p,{path:"/videorama",element:e.jsx(g,{children:e.jsx(ge,{})})}),e.jsx(p,{path:"*",element:e.jsx(E,{to:"/",replace:!0})})]})})}w.createRoot(document.getElementById("root")).render(e.jsx($.StrictMode,{children:e.jsx(F,{basename:"/prime-hub",children:e.jsx(ve,{})})}));
