import{a as mt,b as gt,g as xt,r as l,u as $e,L as k,c as yt,d as qe,R as vt,e as A,N as Ue,f as jt,B as bt}from"./vendor-CwgKfZj-.js";import{S as wt,R as we,M as Y,F as Nt,H as _t,U as M,a as St,b as $,c as We,d as He,X as Ve,C as kt,e as Ne,T as Je,f as Ct,g as Et,h as Re,i as At,j as Rt,k as Tt,P as Ke,l as Pt,m as Bt,L as Ye,n as Xe,o as Qe,p as Te,V as te,q as Ot,A as Lt,r as q,s as zt,D as Dt,B as It,t as Mt}from"./icons-BikDUCAf.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();var ue={exports:{}},H={};var Pe;function Ft(){if(Pe)return H;Pe=1;var n=mt(),e=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function o(f,c,m){var h,u={},d=null,p=null;m!==void 0&&(d=""+m),c.key!==void 0&&(d=""+c.key),c.ref!==void 0&&(p=c.ref);for(h in c)i.call(c,h)&&!a.hasOwnProperty(h)&&(u[h]=c[h]);if(f&&f.defaultProps)for(h in c=f.defaultProps,c)u[h]===void 0&&(u[h]=c[h]);return{$$typeof:e,type:f,key:d,ref:p,props:u,_owner:r.current}}return H.Fragment=s,H.jsx=o,H.jsxs=o,H}var Be;function $t(){return Be||(Be=1,ue.exports=Ft()),ue.exports}var t=$t(),X={},Oe;function qt(){if(Oe)return X;Oe=1;var n=gt();return X.createRoot=n.createRoot,X.hydrateRoot=n.hydrateRoot,X}var Ut=qt();const Wt=xt(Ut),Ht="/api/webapp";async function b(n,e={}){const s=`${Ht}${n}`,i=await fetch(s,{credentials:"include",headers:{"Content-Type":"application/json",...e.headers},...e}),r=await i.json();if(!i.ok)throw new Error(r.error||`Request failed (${i.status})`);return r}const v={authStatus:()=>b("/auth/status"),telegramLogin:n=>b("/auth/telegram",{method:"POST",body:JSON.stringify({telegramUser:n})}),emailLogin:(n,e,s=!1)=>b("/auth/login",{method:"POST",body:JSON.stringify({email:n,password:e,rememberMe:s})}),emailRegister:(n,e,s,i="")=>b("/auth/register",{method:"POST",body:JSON.stringify({firstName:n,email:e,password:s,lastName:i})}),forgotPassword:n=>b("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:n})}),xLoginStart:()=>b("/auth/x/start"),logout:()=>b("/auth/logout",{method:"POST"}),getProfile:()=>b("/profile"),updateProfile:n=>b("/profile",{method:"PUT",body:JSON.stringify(n)}),nearbyUpdateLocation:(n,e,s)=>b("/nearby/update-location",{method:"POST",body:JSON.stringify({latitude:n,longitude:e,accuracy:s})}),nearbySearch:(n,e,s=5)=>b(`/nearby/search?latitude=${n}&longitude=${e}&radius=${s}&limit=30`),getMastodonFeed:(n=10)=>b(`/mastodon/feed?limit=${n}`),getMediaLibrary:(n="all",e=50)=>fetch(`/api/media/library?type=${n}&limit=${e}`,{credentials:"include"}).then(s=>s.json()),getRadioNowPlaying:()=>fetch("/api/radio/now-playing",{credentials:"include"}).then(n=>n.json()).catch(()=>({})),getPublicHangouts:()=>b("/hangouts/public"),createHangout:n=>b("/hangouts/create",{method:"POST",body:JSON.stringify(n)}),joinHangout:n=>b(`/hangouts/join/${n}`,{method:"POST"}),leaveHangout:n=>b(`/hangouts/leave/${n}`,{method:"POST"}),endHangout:n=>b(`/hangouts/${n}`,{method:"DELETE"}),getFeed:n=>b(`/social/feed${n?`?cursor=${encodeURIComponent(n)}`:""}`),getWall:(n,e)=>b(`/social/wall/${n}${e?`?cursor=${encodeURIComponent(e)}`:""}`),createPost:n=>b("/social/posts",{method:"POST",body:JSON.stringify(n)}),toggleLike:n=>b(`/social/posts/${n}/like`,{method:"POST"}),deletePost:n=>b(`/social/posts/${n}`,{method:"DELETE"}),getReplies:(n,e)=>b(`/social/posts/${n}/replies${e?`?cursor=${encodeURIComponent(e)}`:""}`),getDMThreads:()=>b("/dm/threads"),getConversation:(n,e)=>b(`/dm/conversation/${n}${e?`?cursor=${encodeURIComponent(e)}`:""}`),getDMPartnerInfo:n=>b(`/dm/user/${n}`),sendDMRest:(n,e)=>b(`/dm/send/${n}`,{method:"POST",body:JSON.stringify({content:e})}),getChatHistory:(n="general")=>b(`/chat/${n}/history`),sendChatRest:(n="general",e)=>b(`/chat/${n}/send`,{method:"POST",body:JSON.stringify({content:e})}),searchUsers:n=>b(`/users/search?q=${encodeURIComponent(n)}`),getAdminStats:()=>b("/admin/stats"),listAdminUsers:(n,e)=>b(`/admin/users?page=${n}&search=${encodeURIComponent(e||"")}`),getAdminUser:n=>b(`/admin/users/${n}`),updateAdminUser:(n,e)=>b(`/admin/users/${n}`,{method:"PUT",body:JSON.stringify(e)}),banAdminUser:(n,e,s)=>b(`/admin/users/${n}/ban`,{method:"POST",body:JSON.stringify({ban:e,reason:s})}),listAdminPosts:n=>b(`/admin/posts?page=${n}`),deleteAdminPost:n=>b(`/admin/posts/${n}`,{method:"DELETE"}),listAdminHangouts:()=>b("/admin/hangouts"),endAdminHangout:n=>b(`/admin/hangouts/${n}`,{method:"DELETE"})},Ge=l.createContext(null);function Vt({children:n}){const[e,s]=l.useState(null),[i,r]=l.useState(!0),a=l.useCallback(async()=>{try{const u=await v.authStatus();u.authenticated?s(u.user):s(null)}catch{s(null)}finally{r(!1)}},[]);l.useEffect(()=>{a()},[a]);const o=l.useCallback(async u=>{const d=await v.telegramLogin(u);return d.authenticated&&d.registered?(s(d.user),{success:!0}):{success:!1,...d}},[]),f=l.useCallback(async(u,d,p=!1)=>{const N=await v.emailLogin(u,d,p);return N.authenticated?(s(N.user),{success:!0}):{success:!1,...N}},[]),c=l.useCallback(async(u,d,p,N="")=>{const g=await v.emailRegister(u,d,p,N);return g.authenticated?(s(g.user),{success:!0}):{success:!1,...g}},[]),m=l.useCallback(async()=>{const u=await v.xLoginStart();u.success&&u.url&&(window.location.href=u.url)},[]),h=l.useCallback(async()=>{await v.logout(),s(null),window.location.replace("/")},[]);return t.jsx(Ge.Provider,{value:{user:e,loading:i,loginWithTelegram:o,loginWithEmail:f,registerWithEmail:c,loginWithX:m,logout:h,checkAuth:a},children:n})}function L(){const n=l.useContext(Ge);if(!n)throw new Error("useAuth must be used within AuthProvider");return n}function Jt(){const{user:n}=L(),e=$e();return t.jsxs("header",{className:"app-header",children:[t.jsxs("div",{className:"header-left",children:[t.jsx(k,{to:"/",className:"header-logo",children:"PNP"}),t.jsx(k,{to:"/",className:"header-title",children:"tv"})]}),t.jsxs("nav",{className:"header-nav",children:[n&&["admin","superadmin"].includes(n.role)&&t.jsx(k,{to:"/admin",className:`header-nav-btn ${e.pathname.startsWith("/admin")?"active":""}`,title:"Admin Panel",children:t.jsx(wt,{size:18})}),t.jsx(k,{to:"/feed",className:`header-nav-btn ${e.pathname==="/feed"?"active":""}`,title:"Social Feed",children:t.jsx(we,{size:18})}),t.jsx(k,{to:"/messages",className:`header-nav-btn ${e.pathname.startsWith("/messages")?"active":""}`,title:"Messages",children:t.jsx(Y,{size:18})}),t.jsx("a",{href:"/terms",target:"_blank",rel:"noopener",className:"header-nav-btn",title:"Terms",children:t.jsx(Nt,{size:18})}),t.jsx("a",{href:"https://t.me/PNPLatinoTV_Bot",target:"_blank",rel:"noopener",className:"header-nav-btn",title:"Support",children:t.jsx(_t,{size:18})})]}),t.jsxs("div",{className:"header-right",children:[n&&t.jsx(k,{to:`/wall/${n.id}`,className:`header-nav-btn ${e.pathname.startsWith("/wall")?"active":""}`,title:"My Wall",children:t.jsx(M,{size:18})}),t.jsx(k,{to:"/profile",title:"My Profile",children:t.jsx("div",{className:"header-avatar",children:n?.photoUrl?t.jsx("img",{src:n.photoUrl,alt:n.username||"Profile"}):t.jsx(St,{size:18,color:"#8E8E93"})})})]})]})}const Kt=[{path:"/nearby",label:"Nearby",icon:$},{path:"/hangouts",label:"Hangouts",icon:M},{path:"/live",label:"Live",icon:We},{path:"/videorama",label:"Videorama",icon:He}];function Yt(){const n=$e();return t.jsx("nav",{className:"app-footer",children:Kt.map(({path:e,label:s,icon:i})=>t.jsxs(k,{to:e,className:`footer-tab ${n.pathname===e?"active":""}`,children:[t.jsx(i,{size:22}),s]},e))})}const I=Object.create(null);I.open="0";I.close="1";I.ping="2";I.pong="3";I.message="4";I.upgrade="5";I.noop="6";const se=Object.create(null);Object.keys(I).forEach(n=>{se[I[n]]=n});const ge={type:"error",data:"parser error"},Ze=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",et=typeof ArrayBuffer=="function",tt=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,_e=({type:n,data:e},s,i)=>Ze&&e instanceof Blob?s?i(e):Le(e,i):et&&(e instanceof ArrayBuffer||tt(e))?s?i(e):Le(new Blob([e]),i):i(I[n]+(e||"")),Le=(n,e)=>{const s=new FileReader;return s.onload=function(){const i=s.result.split(",")[1];e("b"+(i||""))},s.readAsDataURL(n)};function ze(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let fe;function Xt(n,e){if(Ze&&n.data instanceof Blob)return n.data.arrayBuffer().then(ze).then(e);if(et&&(n.data instanceof ArrayBuffer||tt(n.data)))return e(ze(n.data));_e(n,!1,s=>{fe||(fe=new TextEncoder),e(fe.encode(s))})}const De="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",K=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<De.length;n++)K[De.charCodeAt(n)]=n;const Qt=n=>{let e=n.length*.75,s=n.length,i,r=0,a,o,f,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const m=new ArrayBuffer(e),h=new Uint8Array(m);for(i=0;i<s;i+=4)a=K[n.charCodeAt(i)],o=K[n.charCodeAt(i+1)],f=K[n.charCodeAt(i+2)],c=K[n.charCodeAt(i+3)],h[r++]=a<<2|o>>4,h[r++]=(o&15)<<4|f>>2,h[r++]=(f&3)<<6|c&63;return m},Gt=typeof ArrayBuffer=="function",Se=(n,e)=>{if(typeof n!="string")return{type:"message",data:st(n,e)};const s=n.charAt(0);return s==="b"?{type:"message",data:Zt(n.substring(1),e)}:se[s]?n.length>1?{type:se[s],data:n.substring(1)}:{type:se[s]}:ge},Zt=(n,e)=>{if(Gt){const s=Qt(n);return st(s,e)}else return{base64:!0,data:n}},st=(n,e)=>e==="blob"?n instanceof Blob?n:new Blob([n]):n instanceof ArrayBuffer?n:n.buffer,nt="",es=(n,e)=>{const s=n.length,i=new Array(s);let r=0;n.forEach((a,o)=>{_e(a,!1,f=>{i[o]=f,++r===s&&e(i.join(nt))})})},ts=(n,e)=>{const s=n.split(nt),i=[];for(let r=0;r<s.length;r++){const a=Se(s[r],e);if(i.push(a),a.type==="error")break}return i};function ss(){return new TransformStream({transform(n,e){Xt(n,s=>{const i=s.length;let r;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);const a=new DataView(r.buffer);a.setUint8(0,126),a.setUint16(1,i)}else{r=new Uint8Array(9);const a=new DataView(r.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(i))}n.data&&typeof n.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(s)})}})}let pe;function Q(n){return n.reduce((e,s)=>e+s.length,0)}function G(n,e){if(n[0].length===e)return n.shift();const s=new Uint8Array(e);let i=0;for(let r=0;r<e;r++)s[r]=n[0][i++],i===n[0].length&&(n.shift(),i=0);return n.length&&i<n[0].length&&(n[0]=n[0].slice(i)),s}function ns(n,e){pe||(pe=new TextDecoder);const s=[];let i=0,r=-1,a=!1;return new TransformStream({transform(o,f){for(s.push(o);;){if(i===0){if(Q(s)<1)break;const c=G(s,1);a=(c[0]&128)===128,r=c[0]&127,r<126?i=3:r===126?i=1:i=2}else if(i===1){if(Q(s)<2)break;const c=G(s,2);r=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),i=3}else if(i===2){if(Q(s)<8)break;const c=G(s,8),m=new DataView(c.buffer,c.byteOffset,c.length),h=m.getUint32(0);if(h>Math.pow(2,21)-1){f.enqueue(ge);break}r=h*Math.pow(2,32)+m.getUint32(4),i=3}else{if(Q(s)<r)break;const c=G(s,r);f.enqueue(Se(a?c:pe.decode(c),e)),i=0}if(r===0||r>n){f.enqueue(ge);break}}}})}const it=4;function C(n){if(n)return is(n)}function is(n){for(var e in C.prototype)n[e]=C.prototype[e];return n}C.prototype.on=C.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};C.prototype.once=function(n,e){function s(){this.off(n,s),e.apply(this,arguments)}return s.fn=e,this.on(n,s),this};C.prototype.off=C.prototype.removeListener=C.prototype.removeAllListeners=C.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+n];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var i,r=0;r<s.length;r++)if(i=s[r],i===e||i.fn===e){s.splice(r,1);break}return s.length===0&&delete this._callbacks["$"+n],this};C.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+n],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(s){s=s.slice(0);for(var i=0,r=s.length;i<r;++i)s[i].apply(this,e)}return this};C.prototype.emitReserved=C.prototype.emit;C.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};C.prototype.hasListeners=function(n){return!!this.listeners(n).length};const oe=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,s)=>s(e,0),P=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),rs="arraybuffer";function rt(n,...e){return e.reduce((s,i)=>(n.hasOwnProperty(i)&&(s[i]=n[i]),s),{})}const as=P.setTimeout,os=P.clearTimeout;function le(n,e){e.useNativeTimers?(n.setTimeoutFn=as.bind(P),n.clearTimeoutFn=os.bind(P)):(n.setTimeoutFn=P.setTimeout.bind(P),n.clearTimeoutFn=P.clearTimeout.bind(P))}const ls=1.33;function cs(n){return typeof n=="string"?ds(n):Math.ceil((n.byteLength||n.size)*ls)}function ds(n){let e=0,s=0;for(let i=0,r=n.length;i<r;i++)e=n.charCodeAt(i),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(i++,s+=4);return s}function at(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function hs(n){let e="";for(let s in n)n.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(n[s]));return e}function us(n){let e={},s=n.split("&");for(let i=0,r=s.length;i<r;i++){let a=s[i].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class fs extends Error{constructor(e,s,i){super(e),this.description=s,this.context=i,this.type="TransportError"}}class ke extends C{constructor(e){super(),this.writable=!1,le(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,s,i){return super.emitReserved("error",new fs(e,s,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const s=Se(e,this.socket.binaryType);this.onPacket(s)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,s={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(s)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const s=hs(e);return s.length?"?"+s:""}}class ps extends ke{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const s=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||s()})),this.writable||(i++,this.once("drain",function(){--i||s()}))}else s()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const s=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};ts(e,this.socket.binaryType).forEach(s),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,es(e,s=>{this.doWrite(s,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",s=this.query||{};return this.opts.timestampRequests!==!1&&(s[this.opts.timestampParam]=at()),!this.supportsBinary&&!s.sid&&(s.b64=1),this.createUri(e,s)}}let ot=!1;try{ot=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const ms=ot;function gs(){}class xs extends ps{constructor(e){if(super(e),typeof location<"u"){const s=location.protocol==="https:";let i=location.port;i||(i=s?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}}doWrite(e,s){const i=this.request({method:"POST",data:e});i.on("success",s),i.on("error",(r,a)=>{this.onError("xhr post error",r,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(s,i)=>{this.onError("xhr poll error",s,i)}),this.pollXhr=e}}class D extends C{constructor(e,s,i){super(),this.createRequest=e,le(this,i),this._opts=i,this._method=i.method||"GET",this._uri=s,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;const s=rt(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(s);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&i.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var r;i.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=D.requestsCount++,D.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=gs,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete D.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}D.requestsCount=0;D.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Ie);else if(typeof addEventListener=="function"){const n="onpagehide"in P?"pagehide":"unload";addEventListener(n,Ie,!1)}}function Ie(){for(let n in D.requests)D.requests.hasOwnProperty(n)&&D.requests[n].abort()}const ys=(function(){const n=lt({xdomain:!1});return n&&n.responseType!==null})();class vs extends xs{constructor(e){super(e);const s=e&&e.forceBase64;this.supportsBinary=ys&&!s}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new D(lt,this.uri(),e)}}function lt(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||ms))return new XMLHttpRequest}catch{}if(!e)try{return new P[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const ct=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class js extends ke{get name(){return"websocket"}doOpen(){const e=this.uri(),s=this.opts.protocols,i=ct?{}:rt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,s,i)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const i=e[s],r=s===e.length-1;_e(i,this.supportsBinary,a=>{try{this.doWrite(i,a)}catch{}r&&oe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",s=this.query||{};return this.opts.timestampRequests&&(s[this.opts.timestampParam]=at()),this.supportsBinary||(s.b64=1),this.createUri(e,s)}}const me=P.WebSocket||P.MozWebSocket;class bs extends js{createSocket(e,s,i){return ct?new me(e,s,i):s?new me(e,s):new me(e)}doWrite(e,s){this.ws.send(s)}}class ws extends ke{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const s=ns(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=e.readable.pipeThrough(s).getReader(),r=ss();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const a=()=>{i.read().then(({done:f,value:c})=>{f||(this.onPacket(c),a())}).catch(f=>{})};a();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const i=e[s],r=s===e.length-1;this._writer.write(i).then(()=>{r&&oe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Ns={websocket:bs,webtransport:ws,polling:vs},_s=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ss=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function xe(n){if(n.length>8e3)throw"URI too long";const e=n,s=n.indexOf("["),i=n.indexOf("]");s!=-1&&i!=-1&&(n=n.substring(0,s)+n.substring(s,i).replace(/:/g,";")+n.substring(i,n.length));let r=_s.exec(n||""),a={},o=14;for(;o--;)a[Ss[o]]=r[o]||"";return s!=-1&&i!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=ks(a,a.path),a.queryKey=Cs(a,a.query),a}function ks(n,e){const s=/\/{2,9}/g,i=e.replace(s,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&i.splice(0,1),e.slice(-1)=="/"&&i.splice(i.length-1,1),i}function Cs(n,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,r,a){r&&(s[r]=a)}),s}const ye=typeof addEventListener=="function"&&typeof removeEventListener=="function",ne=[];ye&&addEventListener("offline",()=>{ne.forEach(n=>n())},!1);class F extends C{constructor(e,s){if(super(),this.binaryType=rs,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(s=e,e=null),e){const i=xe(e);s.hostname=i.host,s.secure=i.protocol==="https"||i.protocol==="wss",s.port=i.port,i.query&&(s.query=i.query)}else s.host&&(s.hostname=xe(s.host).host);le(this,s),this.secure=s.secure!=null?s.secure:typeof location<"u"&&location.protocol==="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},s.transports.forEach(i=>{const r=i.prototype.name;this.transports.push(r),this._transportsByName[r]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},s),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=us(this.opts.query)),ye&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ne.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const s=Object.assign({},this.opts.query);s.EIO=it,s.transport=e,this.id&&(s.sid=this.id);const i=Object.assign({},this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&F.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const s=this.createTransport(e);s.open(),this.setTransport(s)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",s=>this._onClose("transport close",s))}onOpen(){this.readyState="open",F.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const s=new Error("server error");s.code=e.data,this._onError(s);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let i=0;i<this.writeBuffer.length;i++){const r=this.writeBuffer[i].data;if(r&&(s+=cs(r)),i>0&&s>this._maxPayload)return this.writeBuffer.slice(0,i);s+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,oe(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,s,i){return this._sendPacket("message",e,s,i),this}send(e,s,i){return this._sendPacket("message",e,s,i),this}_sendPacket(e,s,i,r){if(typeof s=="function"&&(r=s,s=void 0),typeof i=="function"&&(r=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const a={type:e,data:s,options:i};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),e()},i=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(F.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ye&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=ne.indexOf(this._offlineEventListener);i!==-1&&ne.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,s),this.writeBuffer=[],this._prevBufferLen=0}}}F.protocol=it;class Es extends F{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let s=this.createTransport(e),i=!1;F.priorWebsocketSuccess=!1;const r=()=>{i||(s.send([{type:"ping",data:"probe"}]),s.once("packet",u=>{if(!i)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;F.priorWebsocketSuccess=s.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(h(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=s.name,this.emitReserved("upgradeError",d)}}))};function a(){i||(i=!0,h(),s.close(),s=null)}const o=u=>{const d=new Error("probe error: "+u);d.transport=s.name,a(),this.emitReserved("upgradeError",d)};function f(){o("transport closed")}function c(){o("socket closed")}function m(u){s&&u.name!==s.name&&a()}const h=()=>{s.removeListener("open",r),s.removeListener("error",o),s.removeListener("close",f),this.off("close",c),this.off("upgrading",m)};s.once("open",r),s.once("error",o),s.once("close",f),this.once("close",c),this.once("upgrading",m),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{i||s.open()},200):s.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const s=[];for(let i=0;i<e.length;i++)~this.transports.indexOf(e[i])&&s.push(e[i]);return s}}let As=class extends Es{constructor(e,s={}){const i=typeof e=="object"?e:s;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(r=>Ns[r]).filter(r=>!!r)),super(e,i)}};function Rs(n,e="",s){let i=n;s=s||typeof location<"u"&&location,n==null&&(n=s.protocol+"//"+s.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=s.protocol+n:n=s.host+n),/^(https?|wss?):\/\//.test(n)||(typeof s<"u"?n=s.protocol+"//"+n:n="https://"+n),i=xe(n)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const a=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+a+":"+i.port+e,i.href=i.protocol+"://"+a+(s&&s.port===i.port?"":":"+i.port),i}const Ts=typeof ArrayBuffer=="function",Ps=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,dt=Object.prototype.toString,Bs=typeof Blob=="function"||typeof Blob<"u"&&dt.call(Blob)==="[object BlobConstructor]",Os=typeof File=="function"||typeof File<"u"&&dt.call(File)==="[object FileConstructor]";function Ce(n){return Ts&&(n instanceof ArrayBuffer||Ps(n))||Bs&&n instanceof Blob||Os&&n instanceof File}function ie(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let s=0,i=n.length;s<i;s++)if(ie(n[s]))return!0;return!1}if(Ce(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return ie(n.toJSON(),!0);for(const s in n)if(Object.prototype.hasOwnProperty.call(n,s)&&ie(n[s]))return!0;return!1}function Ls(n){const e=[],s=n.data,i=n;return i.data=ve(s,e),i.attachments=e.length,{packet:i,buffers:e}}function ve(n,e){if(!n)return n;if(Ce(n)){const s={_placeholder:!0,num:e.length};return e.push(n),s}else if(Array.isArray(n)){const s=new Array(n.length);for(let i=0;i<n.length;i++)s[i]=ve(n[i],e);return s}else if(typeof n=="object"&&!(n instanceof Date)){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=ve(n[i],e));return s}return n}function zs(n,e){return n.data=je(n.data,e),delete n.attachments,n}function je(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let s=0;s<n.length;s++)n[s]=je(n[s],e);else if(typeof n=="object")for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(n[s]=je(n[s],e));return n}const Ds=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var _;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(_||(_={}));class Is{constructor(e){this.replacer=e}encode(e){return(e.type===_.EVENT||e.type===_.ACK)&&ie(e)?this.encodeAsBinary({type:e.type===_.EVENT?_.BINARY_EVENT:_.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let s=""+e.type;return(e.type===_.BINARY_EVENT||e.type===_.BINARY_ACK)&&(s+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(s+=e.nsp+","),e.id!=null&&(s+=e.id),e.data!=null&&(s+=JSON.stringify(e.data,this.replacer)),s}encodeAsBinary(e){const s=Ls(e),i=this.encodeAsString(s.packet),r=s.buffers;return r.unshift(i),r}}class Ee extends C{constructor(e){super(),this.reviver=e}add(e){let s;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");s=this.decodeString(e);const i=s.type===_.BINARY_EVENT;i||s.type===_.BINARY_ACK?(s.type=i?_.EVENT:_.ACK,this.reconstructor=new Ms(s),s.attachments===0&&super.emitReserved("decoded",s)):super.emitReserved("decoded",s)}else if(Ce(e)||e.base64)if(this.reconstructor)s=this.reconstructor.takeBinaryData(e),s&&(this.reconstructor=null,super.emitReserved("decoded",s));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let s=0;const i={type:Number(e.charAt(0))};if(_[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===_.BINARY_EVENT||i.type===_.BINARY_ACK){const a=s+1;for(;e.charAt(++s)!=="-"&&s!=e.length;);const o=e.substring(a,s);if(o!=Number(o)||e.charAt(s)!=="-")throw new Error("Illegal attachments");i.attachments=Number(o)}if(e.charAt(s+1)==="/"){const a=s+1;for(;++s&&!(e.charAt(s)===","||s===e.length););i.nsp=e.substring(a,s)}else i.nsp="/";const r=e.charAt(s+1);if(r!==""&&Number(r)==r){const a=s+1;for(;++s;){const o=e.charAt(s);if(o==null||Number(o)!=o){--s;break}if(s===e.length)break}i.id=Number(e.substring(a,s+1))}if(e.charAt(++s)){const a=this.tryParse(e.substr(s));if(Ee.isPayloadValid(i.type,a))i.data=a;else throw new Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,s){switch(e){case _.CONNECT:return Me(s);case _.DISCONNECT:return s===void 0;case _.CONNECT_ERROR:return typeof s=="string"||Me(s);case _.EVENT:case _.BINARY_EVENT:return Array.isArray(s)&&(typeof s[0]=="number"||typeof s[0]=="string"&&Ds.indexOf(s[0])===-1);case _.ACK:case _.BINARY_ACK:return Array.isArray(s)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ms{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const s=zs(this.reconPack,this.buffers);return this.finishedReconstruction(),s}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Me(n){return Object.prototype.toString.call(n)==="[object Object]"}const Fs=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Ee,Encoder:Is,get PacketType(){return _}},Symbol.toStringTag,{value:"Module"}));function O(n,e,s){return n.on(e,s),function(){n.off(e,s)}}const $s=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ht extends C{constructor(e,s,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=s,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[O(e,"open",this.onopen.bind(this)),O(e,"packet",this.onpacket.bind(this)),O(e,"error",this.onerror.bind(this)),O(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...s){var i,r,a;if($s.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(s.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const o={type:_.EVENT,data:s};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof s[s.length-1]=="function"){const h=this.ids++,u=s.pop();this._registerAckCallback(h,u),o.id=h}const f=(r=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||r===void 0?void 0:r.writable,c=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!f||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,s){var i;const r=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(r===void 0){this.acks[e]=s;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let f=0;f<this.sendBuffer.length;f++)this.sendBuffer[f].id===e&&this.sendBuffer.splice(f,1);s.call(this,new Error("operation has timed out"))},r),o=(...f)=>{this.io.clearTimeoutFn(a),s.apply(this,f)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...s){return new Promise((i,r)=>{const a=(o,f)=>o?r(o):i(f);a.withError=!0,s.push(a),this.emit(e,...s)})}_addToQueue(e){let s;typeof e[e.length-1]=="function"&&(s=e.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...a)=>(this._queue[0],r!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),s&&s(r)):(this._queue.shift(),s&&s(null,...a)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const s=this._queue[0];s.pending&&!e||(s.pending=!0,s.tryCount++,this.flags=s.flags,this.emit.apply(this,s.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:_.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,s){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,s),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(i=>String(i.id)===e)){const i=this.acks[e];delete this.acks[e],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case _.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case _.EVENT:case _.BINARY_EVENT:this.onevent(e);break;case _.ACK:case _.BINARY_ACK:this.onack(e);break;case _.DISCONNECT:this.ondisconnect();break;case _.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i);break}}onevent(e){const s=e.data||[];e.id!=null&&s.push(this.ack(e.id)),this.connected?this.emitEvent(s):this.receiveBuffer.push(Object.freeze(s))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const s=this._anyListeners.slice();for(const i of s)i.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const s=this;let i=!1;return function(...r){i||(i=!0,s.packet({type:_.ACK,id:e,data:r}))}}onack(e){const s=this.acks[e.id];typeof s=="function"&&(delete this.acks[e.id],s.withError&&e.data.unshift(null),s.apply(this,e.data))}onconnect(e,s){this.id=e,this.recovered=s&&this._pid===s,this._pid=s,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:_.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const s=this._anyListeners;for(let i=0;i<s.length;i++)if(e===s[i])return s.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const s=this._anyOutgoingListeners;for(let i=0;i<s.length;i++)if(e===s[i])return s.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const s=this._anyOutgoingListeners.slice();for(const i of s)i.apply(this,e.data)}}}function W(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}W.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-s:n+s}return Math.min(n,this.max)|0};W.prototype.reset=function(){this.attempts=0};W.prototype.setMin=function(n){this.ms=n};W.prototype.setMax=function(n){this.max=n};W.prototype.setJitter=function(n){this.jitter=n};class be extends C{constructor(e,s){var i;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(s=e,e=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,le(this,s),this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor((i=s.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new W({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=e;const r=s.parser||Fs;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var s;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(s=this.backoff)===null||s===void 0||s.setMin(e),this)}randomizationFactor(e){var s;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(s=this.backoff)===null||s===void 0||s.setJitter(e),this)}reconnectionDelayMax(e){var s;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(s=this.backoff)===null||s===void 0||s.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new As(this.uri,this.opts);const s=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const r=O(s,"open",function(){i.onopen(),e&&e()}),a=f=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",f),e?e(f):this.maybeReconnectOnOpen()},o=O(s,"error",a);if(this._timeout!==!1){const f=this._timeout,c=this.setTimeoutFn(()=>{r(),a(new Error("timeout")),s.close()},f);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(O(e,"ping",this.onping.bind(this)),O(e,"data",this.ondata.bind(this)),O(e,"error",this.onerror.bind(this)),O(e,"close",this.onclose.bind(this)),O(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(s){this.onclose("parse error",s)}}ondecoded(e){oe(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,s){let i=this.nsps[e];return i?this._autoConnect&&!i.active&&i.connect():(i=new ht(this,e,s),this.nsps[e]=i),i}_destroy(e){const s=Object.keys(this.nsps);for(const i of s)if(this.nsps[i].active)return;this._close()}_packet(e){const s=this.encoder.encode(e);for(let i=0;i<s.length;i++)this.engine.write(s[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,s){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,s),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},s);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const V={};function re(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const s=Rs(n,e.path||"/socket.io"),i=s.source,r=s.id,a=s.path,o=V[r]&&a in V[r].nsps,f=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return f?c=new be(i,e):(V[r]||(V[r]=new be(i,e)),c=V[r]),s.query&&!e.query&&(e.query=s.queryKey),c.socket(s.path,e)}Object.assign(re,{Manager:be,Socket:ht,io:re,connect:re});let U=null,ae=0;function ut(){return U||(U=re(window.location.origin,{path:"/socket.io",transports:["websocket","polling"],withCredentials:!0})),ae++,U}function ft(){ae--,ae<=0&&U&&(U.disconnect(),U=null,ae=0)}function qs(n="general"){const[e,s]=l.useState([]),[i,r]=l.useState(!1),[a,o]=l.useState(null),f=l.useRef(null);l.useEffect(()=>{const h=ut();f.current=h;const u=()=>{r(!0),h.emit("chat:join",{room:n})},d=()=>r(!1),p=x=>s(x),N=x=>s(S=>[...S,x]),g=x=>o(x.message);return h.on("connect",u),h.on("disconnect",d),h.on("chat:history",p),h.on("chat:message",N),h.on("chat:error",g),h.connected&&(r(!0),h.emit("chat:join",{room:n})),()=>{h.off("connect",u),h.off("disconnect",d),h.off("chat:history",p),h.off("chat:message",N),h.off("chat:error",g),ft()}},[n]);const c=l.useCallback(h=>{f.current&&h.trim()&&f.current.emit("chat:message",{room:n,content:h})},[n]),m=l.useCallback(h=>{s(u=>[...u,h])},[]);return{messages:e,connected:i,error:a,sendMessage:c,pushMessage:m}}function Us(n){const e=l.useRef(null),[s,i]=l.useState(!1);l.useEffect(()=>{const o=ut();e.current=o;const f=()=>i(!0),c=()=>i(!1),m=h=>n&&n(h);return o.on("connect",f),o.on("disconnect",c),o.on("dm:received",m),o.connected&&i(!0),()=>{o.off("connect",f),o.off("disconnect",c),o.off("dm:received",m),ft()}},[]);const r=l.useCallback((o,f)=>{e.current&&e.current.emit("dm:send",{recipientId:o,content:f})},[]),a=l.useCallback(o=>{e.current&&e.current.emit("dm:typing",{recipientId:o})},[]);return{sendDM:r,sendTyping:a,connected:s}}function Ws(n){const e=Date.now()-new Date(n).getTime(),s=Math.floor(e/6e4);if(s<1)return"now";if(s<60)return`${s}m`;const i=Math.floor(s/60);return i<24?`${i}h`:`${Math.floor(i/24)}d`}function Hs(){const[n,e]=l.useState(!1),[s,i]=l.useState(""),{user:r}=L(),{messages:a,connected:o,sendMessage:f,pushMessage:c}=qs("general"),m=l.useRef(null),h=l.useRef(null);l.useEffect(()=>{n&&m.current&&m.current.scrollIntoView({behavior:"smooth"})},[a,n]),l.useEffect(()=>{n&&h.current&&h.current.focus()},[n]);const u=async()=>{const p=s.trim();if(!(!p||!r))if(i(""),o)f(p);else try{const N=await v.sendChatRest("general",p);N.message&&c(N.message)}catch{}},d=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),u())};return r?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>e(p=>!p),className:"chat-widget-fab",title:"Community Chat","aria-label":"Open community chat",children:[n?t.jsx(Ve,{size:22}):t.jsx(Y,{size:22}),!n&&a.length>0&&t.jsx("span",{className:"chat-widget-badge"})]}),n&&t.jsxs("div",{className:"chat-widget-panel",children:[t.jsxs("div",{className:"chat-widget-header",children:[t.jsx("span",{children:"Community Chat"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("span",{className:`chat-status-dot ${o?"connected":"disconnected"}`}),t.jsx("button",{onClick:()=>e(!1),className:"chat-close-btn",children:t.jsx(kt,{size:18})})]})]}),t.jsxs("div",{className:"chat-messages-list",children:[a.length===0&&t.jsx("div",{style:{textAlign:"center",color:"var(--text-muted)",fontSize:13,padding:"20px 0"},children:"No messages yet. Say hi!"}),a.map(p=>t.jsxs("div",{className:`chat-message ${p.user_id===r.id?"own":""}`,children:[p.user_id!==r.id&&t.jsx("div",{className:"chat-message-author",children:p.first_name||p.username}),t.jsx("div",{className:"chat-bubble",children:p.content}),t.jsx("div",{className:"chat-message-time",children:Ws(p.created_at)})]},p.id)),t.jsx("div",{ref:m})]}),t.jsxs("div",{className:"chat-input-row",children:[t.jsx("input",{ref:h,type:"text",value:s,onChange:p=>i(p.target.value),onKeyDown:d,placeholder:"Message...",maxLength:2e3,className:"chat-input"}),t.jsx("button",{onClick:u,disabled:!s.trim(),className:"chat-send-btn",children:t.jsx(Ne,{size:16})})]})]})]}):null}function E({children:n}){return t.jsxs("div",{className:"app-layout",children:[t.jsx(Jt,{}),t.jsx("main",{className:"app-main",children:n}),t.jsx(Yt,{}),t.jsx(Hs,{})]})}function Vs(n){const e=Date.now()-new Date(n).getTime(),s=Math.floor(e/6e4);if(s<1)return"now";if(s<60)return`${s}m`;const i=Math.floor(s/60);return i<24?`${i}h`:`${Math.floor(i/24)}d`}function Ae({post:n,onDeleted:e}){const{user:s}=L(),[i,r]=l.useState(n.liked_by_me),[a,o]=l.useState(n.likes_count||0),[f,c]=l.useState(!1),[m,h]=l.useState([]),[u,d]=l.useState(!1),[p,N]=l.useState(""),g=async()=>{try{const w=await v.toggleLike(n.id);r(w.liked),o(T=>w.liked?T+1:Math.max(0,T-1))}catch{}},x=async()=>{if(confirm("Delete this post?"))try{await v.deletePost(n.id),e&&e(n.id)}catch{}},S=async()=>{if(f){c(!1);return}try{const w=await v.getReplies(n.id);h(w.replies||[]),c(!0)}catch{}},R=async()=>{if(p.trim())try{await v.createPost({content:p,replyToId:n.id}),N(""),d(!1);const w=await v.getReplies(n.id);h(w.replies||[]),c(!0)}catch{}};return t.jsxs("div",{className:"post-card",children:[t.jsxs("div",{className:"post-header",children:[t.jsx("div",{className:"post-avatar",children:t.jsx("div",{className:"post-avatar-placeholder",children:(n.author_first_name||n.author_username||"?")[0].toUpperCase()})}),t.jsxs("div",{style:{flex:1},children:[t.jsx(k,{to:`/wall/${n.author_id}`,className:"post-author-name",children:n.author_first_name||n.author_username}),n.author_username&&t.jsxs("span",{className:"post-author-handle",children:["@",n.author_username]}),t.jsx("div",{className:"post-time",children:Vs(n.created_at)})]}),n.author_id===s?.id&&t.jsx("button",{onClick:x,className:"post-delete-btn",title:"Delete",children:t.jsx(Je,{size:14})})]}),n.repost_content&&t.jsxs("div",{className:"post-repost-preview",children:[t.jsx(Ct,{size:12,style:{opacity:.6}}),t.jsxs("span",{children:[n.repost_author_first_name||n.repost_author_username,": ",n.repost_content.slice(0,100)]})]}),t.jsx("div",{className:"post-content",children:n.content}),n.media_url&&n.media_type==="image"&&t.jsx("img",{src:n.media_url,alt:"",className:"post-media"}),t.jsxs("div",{className:"post-actions",children:[t.jsxs("button",{onClick:g,className:`post-action-btn ${i?"liked":""}`,children:[t.jsx(Et,{size:16,fill:i?"currentColor":"none"}),t.jsx("span",{children:a})]}),t.jsxs("button",{onClick:S,className:"post-action-btn",children:[t.jsx(Re,{size:16}),t.jsx("span",{children:n.replies_count||0})]}),t.jsx(k,{to:`/messages/${n.author_id}`,className:"post-action-btn",style:{textDecoration:"none"},children:t.jsx(Re,{size:16,style:{opacity:0}})})]}),f&&t.jsxs("div",{className:"post-replies",children:[m.map(w=>t.jsxs("div",{className:"reply-item",children:[t.jsxs("span",{className:"reply-author",children:[w.author_first_name||w.author_username,":"]}),t.jsxs("span",{className:"reply-content",children:[" ",w.content]})]},w.id)),t.jsx("button",{onClick:()=>d(w=>!w),className:"post-action-btn",style:{marginTop:8},children:u?"Cancel":"Reply"}),u&&t.jsxs("div",{className:"reply-compose",children:[t.jsx("input",{type:"text",value:p,onChange:w=>N(w.target.value),placeholder:"Write a reply...",className:"reply-input",onKeyDown:w=>w.key==="Enter"&&R()}),t.jsx("button",{onClick:R,className:"chat-send-btn",disabled:!p.trim(),children:"Reply"})]})]})]})}function Js(){const[n,e]=l.useState(null);return l.useEffect(()=>{let s=!1;return v.getRadioNowPlaying().then(i=>{!s&&i.track&&e(i.track)}).catch(()=>{}),()=>{s=!0}},[]),n?t.jsxs("div",{className:"card",style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",marginBottom:4},children:[t.jsx("div",{style:{width:36,height:36,borderRadius:8,background:"linear-gradient(135deg, #ff453a, #ff6b35)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.jsx(At,{size:18,color:"#fff"})}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginBottom:2},children:"Now Playing"}),t.jsx("div",{style:{fontWeight:600,fontSize:14,color:"var(--text)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.title||"PNPtv Radio"}),n.artist&&n.artist!=="Starting Soon"&&t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.artist})]}),t.jsx(Rt,{size:16,style:{color:"var(--accent)",flexShrink:0,animation:"pulse 2s infinite"}})]}):null}function Ks(){const[n,e]=l.useState([]),[s,i]=l.useState(!0);return l.useEffect(()=>{let r=!1;return v.getFeed().then(a=>{r||e((a.posts||[]).slice(0,5))}).catch(()=>{}).finally(()=>{r||i(!1)}),()=>{r=!0}},[]),s?t.jsx("div",{className:"card",style:{textAlign:"center",padding:32},children:t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})}):n.length===0?t.jsxs("div",{className:"card",style:{textAlign:"center",padding:24},children:[t.jsx("p",{style:{color:"var(--text-muted)",fontSize:14,marginBottom:12},children:"No posts yet. Be the first!"}),t.jsxs(k,{to:"/feed",className:"btn-primary",style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:13,textDecoration:"none"},children:[t.jsx(we,{size:14})," Go to Feed"]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"card",style:{padding:"10px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{style:{fontWeight:600,fontSize:14,color:"var(--text)"},children:"Latest Posts"}),t.jsx(k,{to:"/feed",style:{fontSize:12,color:"var(--text-muted)",textDecoration:"none"},children:"See all "})]}),n.map(r=>t.jsx(Ae,{post:r},r.id))]})}function Ys(){const{user:n}=L();return t.jsxs(E,{children:[t.jsxs("div",{className:"welcome-banner",children:[t.jsxs("h2",{children:["Welcome",n?.firstName?`, ${n.firstName}`:"","!"]}),t.jsx("p",{children:"Your PNPtv hub - explore, connect, and enjoy."})]}),t.jsx(Js,{}),t.jsx("div",{className:"section-label",children:"Explore"}),t.jsxs("div",{className:"quick-actions",children:[t.jsxs(k,{to:"/nearby",className:"card quick-action",children:[t.jsx("div",{className:"quick-action-icon nearby",children:t.jsx($,{size:24})}),t.jsx("span",{className:"quick-action-label",children:"Nearby"}),t.jsx("span",{className:"quick-action-desc",children:"Discover members"})]}),t.jsxs(k,{to:"/hangouts",className:"card quick-action",children:[t.jsx("div",{className:"quick-action-icon hangouts",children:t.jsx(M,{size:24})}),t.jsx("span",{className:"quick-action-label",children:"Hangouts"}),t.jsx("span",{className:"quick-action-desc",children:"Video call rooms"})]}),t.jsxs(k,{to:"/live",className:"card quick-action",children:[t.jsx("div",{className:"quick-action-icon live",children:t.jsx(We,{size:24})}),t.jsx("span",{className:"quick-action-label",children:"Live"}),t.jsx("span",{className:"quick-action-desc",children:"Live performances"})]}),t.jsxs(k,{to:"/videorama",className:"card quick-action",children:[t.jsx("div",{className:"quick-action-icon videorama",children:t.jsx(He,{size:24})}),t.jsx("span",{className:"quick-action-label",children:"Videorama"}),t.jsx("span",{className:"quick-action-desc",children:"Media center"})]}),t.jsxs(k,{to:"/feed",className:"card quick-action",children:[t.jsx("div",{className:"quick-action-icon",style:{background:"linear-gradient(135deg, #ff6b35, #f7c59f)"},children:t.jsx(we,{size:24})}),t.jsx("span",{className:"quick-action-label",children:"Feed"}),t.jsx("span",{className:"quick-action-desc",children:"Community posts"})]}),t.jsxs(k,{to:"/messages",className:"card quick-action",children:[t.jsx("div",{className:"quick-action-icon",style:{background:"linear-gradient(135deg, #6c63ff, #a29bfe)"},children:t.jsx(Y,{size:24})}),t.jsx("span",{className:"quick-action-label",children:"Messages"}),t.jsx("span",{className:"quick-action-desc",children:"Direct messages"})]})]}),t.jsx("div",{className:"section-label",children:"Latest Posts"}),t.jsx(Ks,{})]})}function Xs({status:n}){const s={active:{label:"Active",className:"active"},lifetime:{label:"Lifetime",className:"active"},trial:{label:"Trial",className:"active"},expired:{label:"Expired",className:"expired"},cancelled:{label:"Cancelled",className:"expired"}}[n]||{label:n||"Inactive",className:"inactive"};return t.jsx("span",{className:`sub-badge ${s.className}`,children:s.label})}function J({label:n,value:e,editing:s,name:i,form:r,onChange:a,placeholder:o,textarea:f}){if(!s)return e?t.jsxs("div",{className:"profile-row",children:[t.jsx("span",{className:"profile-row-label",children:n}),t.jsx("span",{className:"profile-row-value",children:e})]}):null;const c={name:i,value:r[i]??"",onChange:a,placeholder:o||n,className:"profile-edit-input"};return t.jsxs("div",{className:"profile-row profile-row-edit",children:[t.jsx("span",{className:"profile-row-label",children:n}),f?t.jsx("textarea",{...c,rows:3,className:"profile-edit-textarea"}):t.jsx("input",{...c})]})}function Qs(){const{user:n,logout:e}=L();yt();const[s,i]=l.useState(null),[r,a]=l.useState(!0),[o,f]=l.useState(!1),[c,m]=l.useState(!1),[h,u]=l.useState(""),[d,p]=l.useState({});l.useEffect(()=>{let w=!1;return v.getProfile().then(T=>{!w&&T.success&&i(T.profile)}).catch(()=>{}).finally(()=>{w||a(!1)}),()=>{w=!0}},[]);const N=()=>{p({firstName:s?.firstName||"",lastName:s?.lastName||"",bio:s?.bio||"",locationText:s?.locationText||"",interests:Array.isArray(s?.interests)?s.interests.join(", "):s?.interests||"",xHandle:s?.xHandle||"",instagramHandle:s?.instagramHandle||"",tiktokHandle:s?.tiktokHandle||""}),u(""),f(!0)},g=()=>{f(!1),u("")},x=w=>p(T=>({...T,[w.target.name]:w.target.value})),S=async()=>{m(!0),u("");try{await v.updateProfile(d);const w=await v.getProfile();w.success&&i(w.profile),f(!1)}catch(w){u(w.message||"Failed to save profile")}finally{m(!1)}},R=w=>w?new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A";return t.jsx(E,{children:r?t.jsx("div",{style:{textAlign:"center",padding:48},children:t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"card profile-header-card",children:[t.jsx("div",{className:"profile-avatar",children:t.jsx("div",{style:{width:72,height:72,borderRadius:"50%",background:"var(--surface-2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:28,fontWeight:700,color:"var(--accent)"},children:(s?.firstName||n?.firstName||"?")[0].toUpperCase()})}),o?t.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[t.jsx("input",{name:"firstName",value:d.firstName,onChange:x,placeholder:"First name",className:"profile-edit-input",style:{maxWidth:130}}),t.jsx("input",{name:"lastName",value:d.lastName,onChange:x,placeholder:"Last name",className:"profile-edit-input",style:{maxWidth:130}})]}):t.jsxs("div",{className:"profile-name",children:[s?.firstName||n?.firstName||""," ",s?.lastName||n?.lastName||""]}),t.jsxs("div",{className:"profile-username",children:["@",s?.username||n?.username||"user"]}),o?t.jsx("textarea",{name:"bio",value:d.bio,onChange:x,placeholder:"Bio (optional)",rows:3,className:"profile-edit-textarea",style:{marginTop:8}}):s?.bio&&t.jsx("p",{className:"profile-bio",children:s.bio}),h&&t.jsx("div",{style:{color:"#ff453a",fontSize:13,marginTop:6},children:h}),t.jsx("div",{style:{display:"flex",gap:10,marginTop:12,justifyContent:"center"},children:o?t.jsxs(t.Fragment,{children:[t.jsxs("button",{className:"btn-secondary",onClick:g,disabled:c,style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[t.jsx(Ve,{size:14})," Cancel"]}),t.jsxs("button",{className:"btn-primary",onClick:S,disabled:c,style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[t.jsx(Tt,{size:14})," ",c?"Saving":"Save"]})]}):t.jsxs("button",{className:"btn-secondary",onClick:N,style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[t.jsx(Ke,{size:14})," Edit Profile"]})}),t.jsxs("div",{className:"profile-stats",style:{marginTop:16},children:[t.jsxs("div",{className:"profile-stat",children:[t.jsx("div",{className:"profile-stat-value",children:t.jsx(Pt,{size:16,style:{display:"inline",verticalAlign:"middle"}})}),t.jsx("div",{className:"profile-stat-label",children:t.jsx(Xs,{status:s?.subscriptionStatus||n?.subscriptionStatus})})]}),t.jsxs("div",{className:"profile-stat",children:[t.jsx("div",{className:"profile-stat-value",children:t.jsx(Bt,{size:16,style:{display:"inline",verticalAlign:"middle"}})}),t.jsxs("div",{className:"profile-stat-label",children:["Since ",R(s?.memberSince)]})]})]})]}),t.jsx("div",{className:"section-label",children:"Account"}),t.jsxs("div",{className:"card profile-section",children:[t.jsxs("div",{className:"profile-row",children:[t.jsx("span",{className:"profile-row-label",children:"Subscription"}),t.jsx("span",{className:"profile-row-value",children:s?.subscriptionPlan||"None"})]}),s?.subscriptionExpires&&t.jsxs("div",{className:"profile-row",children:[t.jsx("span",{className:"profile-row-label",children:"Expires"}),t.jsx("span",{className:"profile-row-value",children:R(s.subscriptionExpires)})]}),t.jsxs("div",{className:"profile-row",children:[t.jsx("span",{className:"profile-row-label",children:"Language"}),t.jsx("span",{className:"profile-row-value",children:s?.language==="es"?"Espaol":"English"})]}),t.jsx(J,{label:"Location",value:s?.locationText,editing:o,name:"locationText",form:d,onChange:x,placeholder:"Your city or area"}),t.jsx(J,{label:"Interests",value:Array.isArray(s?.interests)?s.interests.join(", "):s?.interests,editing:o,name:"interests",form:d,onChange:x,placeholder:"e.g. music, travel, art"})]}),t.jsx("div",{className:"section-label",children:"Social"}),t.jsxs("div",{className:"card profile-section",children:[t.jsx(J,{label:"X (Twitter)",value:s?.xHandle?`@${s.xHandle}`:null,editing:o,name:"xHandle",form:d,onChange:x,placeholder:"username (without @)"}),t.jsx(J,{label:"Instagram",value:s?.instagramHandle?`@${s.instagramHandle}`:null,editing:o,name:"instagramHandle",form:d,onChange:x,placeholder:"username (without @)"}),t.jsx(J,{label:"TikTok",value:s?.tiktokHandle?`@${s.tiktokHandle}`:null,editing:o,name:"tiktokHandle",form:d,onChange:x,placeholder:"username (without @)"}),!o&&!s?.xHandle&&!s?.instagramHandle&&!s?.tiktokHandle&&t.jsx("div",{style:{color:"var(--text-muted)",fontSize:13,padding:"8px 0"},children:"No social handles yet. Click Edit Profile to add them."})]}),t.jsxs("button",{className:"btn-logout",onClick:e,children:[t.jsx(Ye,{size:16,style:{display:"inline",verticalAlign:"middle",marginRight:8}}),"Sign Out"]})]})})}const Gs=[1,5,10,25,50];function Zs(n){return n<1?`${Math.round(n*1e3)} m`:`${n.toFixed(1)} km`}function en(){const[n,e]=l.useState("idle"),[s,i]=l.useState([]),[r,a]=l.useState(5),[o,f]=l.useState(null),[c,m]=l.useState(""),h=l.useCallback(()=>{if(!navigator.geolocation){e("error"),m("Geolocation is not supported by your browser.");return}e("locating"),m(""),navigator.geolocation.getCurrentPosition(d=>{const{latitude:p,longitude:N,accuracy:g}=d.coords;f({latitude:p,longitude:N}),e("searching"),v.nearbyUpdateLocation(p,N,g).catch(()=>{}).then(()=>v.nearbySearch(p,N,r)).then(x=>{i(x.users||x.nearby||[]),e("done")}).catch(x=>{e("error"),m(x.message||"Failed to search nearby users.")})},d=>{e("error"),m(d.code===1?"Location access denied. Please allow location in your browser settings.":d.code===2?"Location unavailable. Try again.":"Location request timed out. Try again.")},{enableHighAccuracy:!0,timeout:12e3,maximumAge:6e4})},[r]),u=l.useCallback(()=>{if(!o){h();return}e("searching"),v.nearbySearch(o.latitude,o.longitude,r).then(d=>{i(d.users||d.nearby||[]),e("done")}).catch(d=>{e("error"),m(d.message||"Search failed.")})},[o,r,h]);return t.jsxs(E,{children:[t.jsx("div",{className:"section-label",children:"Nearby"}),t.jsxs("div",{className:"card",style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,flex:1},children:[t.jsx($,{size:16,color:"var(--accent)"}),t.jsx("span",{style:{fontSize:13,color:"var(--text-muted)"},children:"Radius:"}),t.jsx("select",{value:r,onChange:d=>a(Number(d.target.value)),style:{background:"var(--surface-2)",border:"1px solid var(--border)",borderRadius:8,color:"var(--text)",padding:"4px 8px",fontSize:13},children:Gs.map(d=>t.jsxs("option",{value:d,children:[d," km"]},d))})]}),t.jsx("button",{className:"btn-primary",onClick:n==="done"?u:h,disabled:n==="locating"||n==="searching",style:{display:"flex",alignItems:"center",gap:6,fontSize:13,padding:"8px 16px"},children:n==="locating"||n==="searching"?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading-spinner",style:{width:14,height:14,borderWidth:2}})," ",n==="locating"?"Locating":"Searching"]}):n==="done"?t.jsxs(t.Fragment,{children:[t.jsx(Xe,{size:14})," Refresh"]}):t.jsxs(t.Fragment,{children:[t.jsx(Qe,{size:14})," Find Nearby"]})})]}),n==="error"&&t.jsx("div",{className:"card",style:{color:"#ff453a",fontSize:14,padding:"14px 16px"},children:c}),n==="done"&&s.length===0&&t.jsxs("div",{className:"card",style:{textAlign:"center",padding:32,color:"var(--text-muted)"},children:[t.jsx($,{size:32,style:{opacity:.3,margin:"0 auto 12px",display:"block"}}),t.jsxs("p",{children:["No users found within ",r," km."]}),t.jsx("p",{style:{fontSize:13,marginTop:6},children:"Try increasing the radius."})]}),n==="idle"&&t.jsxs("div",{className:"card",style:{textAlign:"center",padding:32,color:"var(--text-muted)"},children:[t.jsx($,{size:32,style:{opacity:.3,margin:"0 auto 12px",display:"block"}}),t.jsxs("p",{children:["Tap ",t.jsx("strong",{children:"Find Nearby"})," to discover members around you."]}),t.jsx("p",{style:{fontSize:12,marginTop:8},children:"Your location is only shared while searching."})]}),n==="done"&&s.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{fontSize:13,color:"var(--text-muted)",padding:"4px 0 8px"},children:[s.length," member",s.length!==1?"s":""," within ",r," km"]}),s.map(d=>t.jsxs("div",{className:"card",style:{display:"flex",alignItems:"center",gap:12},children:[t.jsx("div",{style:{width:44,height:44,borderRadius:"50%",background:"var(--surface-2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,color:"var(--accent)",flexShrink:0},children:(d.name||d.username||"?")[0].toUpperCase()}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx(k,{to:`/wall/${d.id||d.userId}`,style:{fontWeight:600,fontSize:15,color:"var(--text)",textDecoration:"none"},children:d.name||d.username||"User"}),d.username&&t.jsxs("div",{style:{fontSize:12,color:"var(--text-muted)"},children:["@",d.username]}),(d.distance_km!==void 0||d.distance!==void 0)&&t.jsxs("div",{style:{fontSize:12,color:"var(--accent)",marginTop:2},children:[t.jsx($,{size:11,style:{display:"inline",verticalAlign:"middle"}})," ",Zs(d.distance_km??d.distance)]})]}),t.jsxs(k,{to:`/messages/${d.id||d.userId}`,className:"btn-secondary",style:{display:"flex",alignItems:"center",gap:4,fontSize:12,padding:"6px 10px",flexShrink:0,textDecoration:"none"},children:[t.jsx(Y,{size:13})," DM"]})]},d.id||d.userId))]})]})}function tn(n){if(!n)return"";const e=Date.now()-new Date(n).getTime(),s=Math.floor(e/6e4);return s<1?"just now":s<60?`${s}m ago`:`${Math.floor(s/60)}h ago`}let Fe=!1,Z=null;function sn(){return Fe?Promise.resolve():Z||(Z=new Promise((n,e)=>{const s=document.createElement("script");s.src="https://8x8.vc/libs/external_api.min.js",s.onload=()=>{Fe=!0,n()},s.onerror=()=>e(new Error("Failed to load Jitsi API")),document.head.appendChild(s)}),Z)}function nn({activeCall:n,userName:e,onLeave:s,onEnd:i}){const r=l.useRef(null),a=l.useRef(null),[o,f]=l.useState("");return l.useEffect(()=>{let c=!1;return(async()=>{try{if(await sn(),c||!r.current)return;if(!window.JitsiMeetExternalAPI)throw new Error("JitsiMeetExternalAPI not available");const h=new URL(n.jitsiUrl),u=h.pathname.split("/").filter(Boolean),d=u[0],p=u[1],N=h.searchParams.get("jwt"),g=new window.JitsiMeetExternalAPI("8x8.vc",{roomName:`${d}/${p}`,jwt:N,parentNode:r.current,width:"100%",height:"100%",configOverwrite:{startWithAudioMuted:!1,startWithVideoMuted:!1,disableDeepLinking:!0,prejoinPageEnabled:!1},interfaceConfigOverwrite:{SHOW_JITSI_WATERMARK:!1,SHOW_WATERMARK_FOR_GUESTS:!1,TOOLBAR_BUTTONS:["microphone","camera","closedcaptions","desktop","fullscreen","fodeviceselection","hangup","chat","raisehand","videoquality","tileview","select-background","stats"]},userInfo:{displayName:e||"Guest"}});a.current=g,g.addEventListener("readyToClose",()=>{c||s()}),g.addEventListener("videoConferenceLeft",()=>{c||s()})}catch(h){c||f(h.message||"Failed to load video call")}})(),()=>{if(c=!0,a.current){try{a.current.dispose()}catch{}a.current=null}}},[n.jitsiUrl]),t.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"#000",display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 16px",background:"rgba(0,0,0,0.8)",borderBottom:"1px solid rgba(255,255,255,0.1)",flexShrink:0},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,color:"#fff",fontSize:14},children:[t.jsx(te,{size:16,style:{color:"#30d158"}}),t.jsx("span",{style:{fontWeight:600},children:n.title||`${n.creatorName||"Host"}'s Room`})]}),t.jsxs("div",{style:{display:"flex",gap:8},children:[n.isModerator&&t.jsxs("button",{onClick:i,style:{display:"flex",alignItems:"center",gap:6,padding:"6px 14px",borderRadius:8,border:"none",cursor:"pointer",background:"rgba(255,69,58,0.2)",color:"#ff453a",fontSize:13,fontWeight:600},children:[t.jsx(Ot,{size:14})," End Room"]}),t.jsxs("button",{onClick:s,style:{display:"flex",alignItems:"center",gap:6,padding:"6px 14px",borderRadius:8,border:"none",cursor:"pointer",background:"rgba(255,255,255,0.1)",color:"#fff",fontSize:13,fontWeight:600},children:[t.jsx(Ye,{size:14})," Leave"]})]})]}),t.jsx("div",{ref:r,style:{flex:1,width:"100%",overflow:"hidden"},children:o&&t.jsx("div",{style:{color:"#ff453a",textAlign:"center",padding:40},children:o})})]})}function rn(){const{user:n}=L(),[e,s]=l.useState([]),[i,r]=l.useState(!0),[a,o]=l.useState(!1),[f,c]=l.useState(!1),[m,h]=l.useState(""),[u,d]=l.useState(""),[p,N]=l.useState(null),[g,x]=l.useState(null),S=l.useCallback(async()=>{try{const j=await v.getPublicHangouts();s(j.rooms||[])}catch{s([])}finally{r(!1)}},[]);l.useEffect(()=>{S();const j=setInterval(S,3e4);return()=>clearInterval(j)},[S]);const R=(j,{title:y,creatorName:B,isModerator:he})=>{j.jitsiUrl?x({jitsiUrl:j.jitsiUrl,room:j.room,id:j.id,isModerator:he??!1,title:y,creatorName:B}):window.open(`https://meet.jit.si/${j.room}`,"_blank","noopener")},w=async()=>{d(""),o(!0);try{const j=await v.createHangout({title:m.trim()||null,isPublic:!0});c(!1),h("");const y=n?.firstName||n?.username||"You";R(j,{title:m.trim()||null,creatorName:y,isModerator:!0}),await S()}catch(j){d(j.message||"Failed to create room")}finally{o(!1)}},T=async j=>{N(j.id),d("");try{const y=await v.joinHangout(j.id);R(y,{title:j.title,creatorName:j.creatorName,isModerator:y.isModerator})}catch(y){d(y.message||"Failed to join room")}finally{N(null)}},ce=l.useCallback(async()=>{if(g){try{await v.leaveHangout(g.id)}catch{}x(null),S()}},[g,S]),de=l.useCallback(async()=>{if(g){try{await v.endHangout(g.id)}catch{}x(null),S()}},[g,S]);if(g){const j=n?.firstName||n?.username||"Guest";return t.jsx(nn,{activeCall:g,userName:j,onLeave:ce,onEnd:de})}return t.jsxs(E,{children:[t.jsxs("div",{className:"page-header",children:[t.jsx("h2",{className:"page-title",children:"Hangouts"}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("button",{onClick:S,className:"btn-secondary",style:{padding:"6px 10px"},title:"Refresh",children:t.jsx(Xe,{size:15})}),t.jsxs("button",{onClick:()=>{c(j=>!j),d("")},className:"btn-primary",style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx(Te,{size:16})," New Room"]})]})]}),f&&t.jsxs("div",{className:"card",style:{marginBottom:12,padding:16},children:[t.jsx("div",{style:{marginBottom:10,fontWeight:600,color:"var(--text-primary)"},children:"Create a Room"}),t.jsx("input",{type:"text",value:m,onChange:j=>h(j.target.value),placeholder:"Room title (optional)",maxLength:80,className:"chat-input",style:{width:"100%",marginBottom:10},onKeyDown:j=>j.key==="Enter"&&w(),autoFocus:!0}),u&&t.jsx("div",{className:"login-error",style:{marginBottom:8},children:u}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsxs("button",{onClick:w,disabled:a,className:"btn-primary",style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx(te,{size:15}),a?"Starting...":"Start Room"]}),t.jsx("button",{onClick:()=>c(!1),className:"btn-secondary",children:"Cancel"})]})]}),u&&!f&&t.jsx("div",{className:"login-error",style:{marginBottom:12},children:u}),i?t.jsx("div",{style:{textAlign:"center",padding:40},children:t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})}):e.length===0?t.jsxs("div",{className:"card",style:{textAlign:"center",padding:40},children:[t.jsx(te,{size:36,style:{margin:"0 auto 12px",display:"block",opacity:.3}}),t.jsx("div",{style:{color:"var(--text-muted)",marginBottom:16},children:"No active rooms. Start one!"}),t.jsxs("button",{onClick:()=>c(!0),className:"btn-primary",style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx(Te,{size:16})," New Room"]})]}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:e.map(j=>t.jsx("div",{className:"card",style:{padding:16},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",marginBottom:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:j.title||`${j.creatorName}'s Room`}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,fontSize:13,color:"var(--text-muted)"},children:[t.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[t.jsx(M,{size:13}),j.currentParticipants??0,"/",j.maxParticipants]}),t.jsxs("span",{children:["by ",j.creatorName]}),t.jsx("span",{children:tn(j.createdAt)})]})]}),t.jsxs("button",{onClick:()=>T(j),disabled:p===j.id,className:"btn-primary",style:{display:"flex",alignItems:"center",gap:6,flexShrink:0},children:[t.jsx(te,{size:14}),p===j.id?"Joining...":"Join"]})]})},j.id))})]})}function an(){return t.jsxs(E,{children:[t.jsx("div",{className:"section-label",children:"PNP Live"}),t.jsx("div",{className:"feature-page",children:t.jsx("iframe",{className:"feature-iframe",src:"/live",title:"Live",allow:"camera; microphone",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups"})})]})}function on(){return t.jsxs(E,{children:[t.jsx("div",{className:"section-label",children:"Videorama"}),t.jsx("div",{className:"feature-page",children:t.jsx("iframe",{className:"feature-iframe",src:"/videorama",title:"Videorama",allow:"autoplay; fullscreen",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups"})})]})}function pt({onPosted:n}){const{user:e}=L(),[s,i]=l.useState(""),[r,a]=l.useState(!1),[o,f]=l.useState(""),c=5e3,m=async()=>{if(!(!s.trim()||r)){a(!0),f("");try{const h=await v.createPost({content:s.trim()});i(""),n&&n(h.post)}catch(h){f(h.message||"Failed to post. Please try again.")}finally{a(!1)}}};return t.jsx("div",{className:"post-composer card",children:t.jsxs("div",{style:{display:"flex",gap:12},children:[t.jsx("div",{className:"post-avatar-placeholder",style:{width:40,height:40,fontSize:16,flexShrink:0},children:(e?.firstName||e?.username||"?")[0].toUpperCase()}),t.jsxs("div",{style:{flex:1},children:[t.jsx("textarea",{value:s,onChange:h=>i(h.target.value),placeholder:"What's happening?",maxLength:c,rows:3,className:"composer-textarea"}),o&&t.jsx("div",{style:{color:"#ff453a",fontSize:13,marginBottom:6},children:o}),t.jsxs("div",{className:"composer-footer",children:[t.jsxs("span",{className:"composer-char-count",style:{color:s.length>c*.9?"#ff453a":"var(--text-muted)"},children:[s.length,"/",c]}),t.jsxs("button",{onClick:m,disabled:!s.trim()||r,className:"btn-primary composer-post-btn",children:[t.jsx(Ne,{size:14}),r?"Posting...":"Post"]})]})]})]})})}function ln(){const[n,e]=l.useState([]),[s,i]=l.useState(!0),[r,a]=l.useState(null),[o,f]=l.useState(!1),c=l.useCallback(async(d=null)=>{try{const p=await v.getFeed(d);e(d?N=>[...N,...p.posts||[]]:p.posts||[]),a(p.nextCursor||null)}catch(p){console.error("Feed error",p)}},[]);l.useEffect(()=>{i(!0),c().finally(()=>i(!1))},[c]);const m=d=>{e(p=>[{...d,liked_by_me:!1,likes_count:0,replies_count:0,reposts_count:0},...p])},h=d=>{e(p=>p.filter(N=>N.id!==d))},u=async()=>{!r||o||(f(!0),await c(r),f(!1))};return t.jsxs(E,{children:[t.jsx("div",{className:"page-header",children:t.jsx("h2",{className:"page-title",children:"Feed"})}),t.jsx(pt,{onPosted:m}),s?t.jsx("div",{style:{textAlign:"center",padding:32},children:t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})}):n.length===0?t.jsx("div",{className:"card",style:{textAlign:"center",padding:32,color:"var(--text-muted)"},children:"No posts yet. Be the first to post!"}):t.jsxs(t.Fragment,{children:[n.map(d=>t.jsx(Ae,{post:d,onDeleted:h},d.id)),r&&t.jsx("button",{onClick:u,disabled:o,className:"btn-secondary",style:{width:"100%",marginTop:12},children:o?"Loading...":"Load more"})]})]})}function cn(){const{userId:n}=qe(),{user:e}=L(),[s,i]=l.useState(null),[r,a]=l.useState([]),[o,f]=l.useState(!0),[c,m]=l.useState(null),[h,u]=l.useState(!1);l.useEffect(()=>{const x=async()=>{try{const S=await v.getWall(n);i(S.profile),a(S.posts||[]),m(S.nextCursor||null)}catch{}};f(!0),x().finally(()=>f(!1))},[n]);const d=x=>a(S=>[x,...S]),p=x=>a(S=>S.filter(R=>R.id!==x)),N=async()=>{if(!(!c||h)){u(!0);try{const x=await v.getWall(n,c);a(S=>[...S,...x.posts||[]]),m(x.nextCursor||null)}catch{}u(!1)}};if(o)return t.jsx(E,{children:t.jsx("div",{style:{textAlign:"center",padding:32},children:t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})})});if(!s)return t.jsx(E,{children:t.jsx("div",{className:"card",style:{textAlign:"center",padding:32,color:"var(--text-muted)"},children:"User not found."})});const g=e?.id===n;return t.jsxs(E,{children:[t.jsxs("div",{className:"card wall-profile-card",children:[t.jsx("div",{className:"wall-profile-avatar",children:t.jsx("div",{className:"post-avatar-placeholder wall-avatar-big",children:(s.first_name||s.username||"?")[0].toUpperCase()})}),t.jsxs("div",{className:"wall-profile-info",children:[t.jsxs("div",{className:"wall-profile-name",children:[s.first_name," ",s.last_name||""]}),s.username&&t.jsxs("div",{className:"wall-profile-handle",children:["@",s.username]}),s.pnptv_id&&t.jsxs("div",{className:"wall-profile-id",children:["ID: ",s.pnptv_id]}),s.bio&&t.jsx("div",{className:"wall-profile-bio",children:s.bio})]}),!g&&t.jsxs(k,{to:`/messages/${n}`,className:"btn-secondary wall-dm-btn",children:[t.jsx(Y,{size:16})," DM"]})]}),g&&t.jsx(pt,{onPosted:d}),r.length===0?t.jsx("div",{className:"card",style:{textAlign:"center",padding:24,color:"var(--text-muted)"},children:"No posts yet."}):r.map(x=>t.jsx(Ae,{post:x,onDeleted:p},x.id)),c&&t.jsx("div",{style:{textAlign:"center",padding:"12px 0"},children:t.jsx("button",{className:"btn-secondary",onClick:N,disabled:h,children:h?"Loading":"Load more"})})]})}function dn(n){if(!n)return"";const e=Date.now()-new Date(n).getTime(),s=Math.floor(e/6e4);if(s<1)return"now";if(s<60)return`${s}m`;const i=Math.floor(s/60);return i<24?`${i}h`:`${Math.floor(i/24)}d`}function hn(){const[n,e]=l.useState([]),[s,i]=l.useState(!0),[r,a]=l.useState(""),[o,f]=l.useState([]),[c,m]=l.useState(!1);l.useEffect(()=>{v.getDMThreads().then(u=>e(u.threads||[])).catch(()=>{}).finally(()=>i(!1))},[]);const h=async u=>{if(a(u),!u.trim()){f([]);return}m(!0);try{const d=await v.searchUsers(u);f(d.users||[])}catch{}finally{m(!1)}};return t.jsxs(E,{children:[t.jsx("div",{className:"page-header",children:t.jsx("h2",{className:"page-title",children:"Messages"})}),t.jsx("div",{className:"card",style:{padding:"12px 16px",marginBottom:12},children:t.jsx("input",{type:"text",value:r,onChange:u=>h(u.target.value),placeholder:"Search users to message...",className:"chat-input",style:{width:"100%"}})}),r.trim()?t.jsx("div",{className:"card",children:c?t.jsx("div",{style:{padding:16,textAlign:"center",color:"var(--text-muted)"},children:"Searching..."}):o.length===0?t.jsx("div",{style:{padding:16,textAlign:"center",color:"var(--text-muted)"},children:"No users found"}):o.map(u=>t.jsxs(k,{to:`/messages/${u.id}`,className:"thread-item",style:{textDecoration:"none"},children:[t.jsx("div",{className:"thread-avatar",children:t.jsx("div",{className:"post-avatar-placeholder",children:(u.first_name||u.username||"?")[0].toUpperCase()})}),t.jsxs("div",{className:"thread-info",children:[t.jsxs("div",{className:"thread-name",children:[u.first_name," ",u.last_name||""]}),t.jsxs("div",{className:"thread-preview",children:["@",u.username||u.pnptv_id]})]})]},u.id))}):s?t.jsx("div",{style:{textAlign:"center",padding:32},children:t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})}):n.length===0?t.jsx("div",{className:"card",style:{textAlign:"center",padding:32,color:"var(--text-muted)"},children:"No conversations yet. Search for users to start chatting."}):t.jsx("div",{className:"card",children:n.map(u=>t.jsxs(k,{to:`/messages/${u.partner_id}`,className:"thread-item",style:{textDecoration:"none"},children:[t.jsx("div",{className:"thread-avatar",children:t.jsx("div",{className:"post-avatar-placeholder",children:(u.partner_first_name||u.partner_username||"?")[0].toUpperCase()})}),t.jsxs("div",{className:"thread-info",children:[t.jsxs("div",{className:"thread-name",children:[u.partner_first_name," ",t.jsxs("span",{className:"post-author-handle",children:["@",u.partner_username]})]}),t.jsx("div",{className:"thread-preview",children:u.last_message||""})]}),t.jsxs("div",{className:"thread-meta",children:[t.jsx("div",{className:"thread-time",children:dn(u.last_message_at)}),u.unread>0&&t.jsx("div",{className:"thread-unread",children:u.unread})]})]},u.partner_id))})]})}function un(n){const e=Date.now()-new Date(n).getTime(),s=Math.floor(e/6e4);if(s<1)return"now";if(s<60)return`${s}m`;const i=Math.floor(s/60);return i<24?`${i}h`:`${Math.floor(i/24)}d`}function fn(){const{partnerId:n}=qe(),{user:e}=L(),[s,i]=l.useState(null),[r,a]=l.useState([]),[o,f]=l.useState(""),c=l.useRef(null),m=l.useCallback(g=>{(g.sender_id===n||g.sender?.id===n)&&a(x=>[...x,g])},[n]),{sendDM:h,sendTyping:u,connected:d}=Us(m);l.useEffect(()=>{Promise.all([v.getDMPartnerInfo(n),v.getConversation(n)]).then(([g,x])=>{i(g.user),a(x.messages||[])}).catch(()=>{})},[n]),l.useEffect(()=>{c.current?.scrollIntoView({behavior:"smooth"})},[r]);const p=async()=>{const g=o.trim();if(g)if(a(x=>[...x,{id:`tmp-${Date.now()}`,sender_id:e.id,recipient_id:n,content:g,created_at:new Date().toISOString()}]),f(""),d)h(n,g);else try{await v.sendDMRest(n,g)}catch{}},N=g=>{g.key==="Enter"&&!g.shiftKey?(g.preventDefault(),p()):u(n)};return t.jsxs(E,{children:[t.jsxs("div",{className:"conv-header",children:[t.jsx(k,{to:"/messages",className:"conv-back-btn",children:t.jsx(Lt,{size:20})}),t.jsxs("div",{className:"conv-partner-name",children:[s?s.first_name||s.username:"Loading...",s?.username&&t.jsxs("span",{className:"post-author-handle",children:[" @",s.username]})]})]}),t.jsxs("div",{className:"conv-messages",children:[r.map((g,x)=>t.jsxs("div",{className:`dm-message ${g.sender_id===e?.id?"own":"other"}`,children:[t.jsx("div",{className:"dm-bubble",children:g.content}),t.jsx("div",{className:"dm-time",children:un(g.created_at)})]},g.id||x)),t.jsx("div",{ref:c})]}),t.jsxs("div",{className:"conv-input-row",children:[t.jsx("input",{type:"text",value:o,onChange:g=>f(g.target.value),onKeyDown:N,placeholder:"Message...",maxLength:2e3,className:"chat-input",style:{flex:1}}),t.jsx("button",{onClick:p,disabled:!o.trim(),className:"chat-send-btn",children:t.jsx(Ne,{size:16})})]})]})}function pn(){const[n,e]=l.useState(null),[s,i]=l.useState(!0),[r,a]=l.useState("");if(l.useEffect(()=>{let m=!1;return v.getAdminStats().then(h=>{m||e(h.stats)}).catch(h=>{m||a(h.message||"Failed to load stats")}).finally(()=>{m||i(!1)}),()=>{m=!0}},[]),s)return t.jsx(E,{children:t.jsxs("div",{style:{textAlign:"center",padding:48},children:[t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}}),t.jsx("p",{style:{marginTop:12,color:"var(--text-muted)"},children:"Loading admin dashboard..."})]})});if(r)return t.jsx(E,{children:t.jsxs("div",{className:"card",style:{padding:24,color:"#ff453a"},children:[t.jsx(q,{size:24,style:{display:"inline",marginRight:8}}),r]})});const o=n?.payments||{},f=n?.revenue?.monthly||{},c=n?.membership?.totals||{};return t.jsx(E,{children:t.jsxs("div",{style:{marginBottom:32},children:[t.jsx("h1",{style:{fontSize:24,marginBottom:24},children:"Admin Dashboard"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:16,marginBottom:32},children:[t.jsx("div",{className:"card",style:{padding:16},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginBottom:4},children:"Total Users"}),t.jsx("div",{style:{fontSize:20,fontWeight:"700"},children:c.total_active_users||0})]}),t.jsx(M,{size:32,style:{color:"var(--accent)",opacity:.5}})]})}),t.jsx("div",{className:"card",style:{padding:16},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginBottom:4},children:"Active Subscribers"}),t.jsx("div",{style:{fontSize:20,fontWeight:"700"},children:c.active_subscribers||0})]}),t.jsx(zt,{size:32,style:{color:"#34C759",opacity:.5}})]})}),t.jsx("div",{className:"card",style:{padding:16},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginBottom:4},children:"Monthly Revenue"}),t.jsxs("div",{style:{fontSize:20,fontWeight:"700"},children:["$",(f.monthly_revenue||0).toFixed(0)]})]}),t.jsx(Dt,{size:32,style:{color:"#FF9500",opacity:.5}})]})}),t.jsx("div",{className:"card",style:{padding:16},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginBottom:4},children:"Churned"}),t.jsx("div",{style:{fontSize:20,fontWeight:"700"},children:c.churned_users||0})]}),t.jsx(q,{size:32,style:{color:"#FF453A",opacity:.5}})]})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12,marginBottom:32},children:[t.jsxs(k,{to:"/admin/users",className:"card",style:{padding:16,textDecoration:"none",color:"inherit"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("span",{style:{fontWeight:"600"},children:"Manage Users"}),t.jsx(M,{size:20,style:{color:"var(--accent)"}})]}),t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginTop:8},children:"Search, ban, edit users"})]}),t.jsxs(k,{to:"/admin/posts",className:"card",style:{padding:16,textDecoration:"none",color:"inherit"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("span",{style:{fontWeight:"600"},children:"Moderate Posts"}),t.jsx(q,{size:20,style:{color:"#FF9500"}})]}),t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginTop:8},children:"Delete inappropriate content"})]}),t.jsxs(k,{to:"/admin/hangouts",className:"card",style:{padding:16,textDecoration:"none",color:"inherit"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("span",{style:{fontWeight:"600"},children:"Manage Hangouts"}),t.jsx(M,{size:20,style:{color:"#34C759"}})]}),t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginTop:8},children:"View and end rooms"})]})]}),n?.payments&&t.jsxs("div",{className:"card",style:{padding:16},children:[t.jsx("h3",{style:{fontSize:14,fontWeight:"600",marginBottom:12},children:"Payment Stats"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:12},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)"},children:"Total Payments"}),t.jsx("div",{style:{fontSize:18,fontWeight:"700"},children:o.total_payments||0})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)"},children:"Completed"}),t.jsx("div",{style:{fontSize:18,fontWeight:"700",color:"#34C759"},children:o.completed||0})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)"},children:"Failed"}),t.jsx("div",{style:{fontSize:18,fontWeight:"700",color:"#FF453A"},children:o.failed||0})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-muted)"},children:"Avg Transaction"}),t.jsxs("div",{style:{fontSize:18,fontWeight:"700"},children:["$",(o.avg_transaction||0).toFixed(2)]})]})]})]})]})})}function mn(){const[n,e]=l.useState([]),[s,i]=l.useState(!0),[r,a]=l.useState(""),[o,f]=l.useState(""),[c,m]=l.useState(1),[h,u]=l.useState({total:0,totalPages:0}),[d,p]=l.useState(null),[N,g]=l.useState(!1),[x,S]=l.useState({}),[R,w]=l.useState(!1),T=(y=1)=>{i(!0),a(""),v.listAdminUsers(y,o).then(B=>{e(B.users||[]),u(B.pagination||{}),m(y)}).catch(B=>a(B.message||"Failed to load users")).finally(()=>i(!1))};l.useEffect(()=>{T(1)},[o]);const ce=y=>{p(y),S({username:y.username,email:y.email,subscriptionStatus:y.subscription_status}),g(!0)},de=async()=>{w(!0);try{await v.updateAdminUser(d.id,x),g(!1),T(c)}catch(y){a(y.message||"Failed to save user")}finally{w(!1)}},j=async(y,B)=>{if(confirm(`Are you sure you want to ${B?"ban":"unban"} this user?`))try{await v.banAdminUser(y,B,"Admin action"),T(c)}catch(he){a(he.message||"Failed to ban user")}};return t.jsxs(E,{children:[t.jsxs("div",{style:{marginBottom:32},children:[t.jsx("h1",{style:{fontSize:24,marginBottom:24},children:"User Management"}),t.jsx("div",{style:{marginBottom:24},children:t.jsxs("div",{style:{position:"relative",marginBottom:16},children:[t.jsx(Qe,{size:18,style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"var(--text-muted)"}}),t.jsx("input",{type:"text",placeholder:"Search users by username, email...",value:o,onChange:y=>f(y.target.value),style:{width:"100%",paddingLeft:40,paddingRight:16,paddingTop:12,paddingBottom:12,border:"1px solid var(--border-subtle)",borderRadius:"var(--radius-md)",backgroundColor:"var(--surface-2)",color:"var(--text-primary)",fontSize:14}})]})}),r&&t.jsxs("div",{className:"card",style:{padding:16,marginBottom:24,color:"#ff453a"},children:[t.jsx(q,{size:18,style:{display:"inline",marginRight:8}}),r]}),s?t.jsx("div",{style:{textAlign:"center",padding:48},children:t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})}):n.length===0?t.jsx("div",{className:"card",style:{padding:24,textAlign:"center",color:"var(--text-muted)"},children:"No users found"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"card",style:{overflow:"x-auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:"1px solid var(--border-subtle)"},children:[t.jsx("th",{style:{padding:12,textAlign:"left",color:"var(--text-muted)",fontWeight:"600"},children:"Username"}),t.jsx("th",{style:{padding:12,textAlign:"left",color:"var(--text-muted)",fontWeight:"600"},children:"Email"}),t.jsx("th",{style:{padding:12,textAlign:"left",color:"var(--text-muted)",fontWeight:"600"},children:"Role"}),t.jsx("th",{style:{padding:12,textAlign:"left",color:"var(--text-muted)",fontWeight:"600"},children:"Status"}),t.jsx("th",{style:{padding:12,textAlign:"left",color:"var(--text-muted)",fontWeight:"600"},children:"Sub Status"}),t.jsx("th",{style:{padding:12,textAlign:"center",color:"var(--text-muted)",fontWeight:"600"},children:"Actions"})]})}),t.jsx("tbody",{children:n.map(y=>t.jsxs("tr",{style:{borderBottom:"1px solid var(--border-subtle)"},children:[t.jsx("td",{style:{padding:12},children:y.username}),t.jsx("td",{style:{padding:12,fontSize:12,color:"var(--text-muted)"},children:y.email}),t.jsx("td",{style:{padding:12},children:t.jsx("span",{style:{fontSize:11,backgroundColor:"var(--surface-2)",padding:"4px 8px",borderRadius:4},children:y.role||"user"})}),t.jsx("td",{style:{padding:12},children:y.status||"active"}),t.jsx("td",{style:{padding:12},children:y.subscription_status||"free"}),t.jsxs("td",{style:{padding:12,display:"flex",gap:8,justifyContent:"center"},children:[t.jsx("button",{onClick:()=>ce(y),style:{background:"none",border:"none",color:"var(--accent)",cursor:"pointer",padding:4,display:"flex",alignItems:"center",gap:4},title:"Edit user",children:t.jsx(Ke,{size:14})}),t.jsx("button",{onClick:()=>j(y.id,y.status!=="banned"),style:{background:"none",border:"none",color:y.status==="banned"?"#34C759":"#FF453A",cursor:"pointer",padding:4,display:"flex",alignItems:"center",gap:4},title:y.status==="banned"?"Unban user":"Ban user",children:t.jsx(It,{size:14})})]})]},y.id))})]})}),h.totalPages>1&&t.jsx("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:24},children:Array.from({length:h.totalPages},(y,B)=>B+1).map(y=>t.jsx("button",{onClick:()=>T(y),style:{padding:"8px 12px",border:c===y?"1px solid var(--accent)":"1px solid var(--border-subtle)",backgroundColor:c===y?"var(--accent)":"transparent",color:c===y?"#fff":"var(--text-primary)",borderRadius:4,cursor:"pointer",fontSize:12},children:y},y))})]})]}),N&&d&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{className:"card",style:{padding:24,maxWidth:400,width:"90%"},children:[t.jsx("h2",{style:{fontSize:18,marginBottom:16},children:"Edit User"}),t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:4},children:"Username"}),t.jsx("input",{type:"text",value:x.username,onChange:y=>S({...x,username:y.target.value}),className:"profile-edit-input"})]}),t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:4},children:"Email"}),t.jsx("input",{type:"email",value:x.email,onChange:y=>S({...x,email:y.target.value}),className:"profile-edit-input"})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:4},children:"Subscription Status"}),t.jsxs("select",{value:x.subscriptionStatus||"",onChange:y=>S({...x,subscriptionStatus:y.target.value}),className:"profile-edit-input",children:[t.jsx("option",{value:"free",children:"Free"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"expired",children:"Expired"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("button",{onClick:()=>g(!1),className:"btn-secondary",style:{flex:1},disabled:R,children:"Cancel"}),t.jsx("button",{onClick:de,className:"btn-primary",style:{flex:1},disabled:R,children:R?"Saving...":"Save"})]})]})})]})}function gn(){const[n,e]=l.useState([]),[s,i]=l.useState(!0),[r,a]=l.useState(""),[o,f]=l.useState(1),[c,m]=l.useState({total:0,totalPages:0}),h=(d=1)=>{i(!0),v.listAdminPosts(d).then(p=>{e(p.posts||[]),m(p.pagination||{}),f(d)}).catch(p=>a(p.message||"Failed to load posts")).finally(()=>i(!1))};l.useEffect(()=>{h(1)},[]);const u=async d=>{if(confirm("Delete this post?"))try{await v.deleteAdminPost(d),h(o)}catch(p){a(p.message||"Failed to delete post")}};return t.jsx(E,{children:t.jsxs("div",{style:{marginBottom:32},children:[t.jsx("h1",{style:{fontSize:24,marginBottom:24},children:"Moderate Posts"}),r&&t.jsxs("div",{className:"card",style:{padding:16,marginBottom:24,color:"#ff453a"},children:[t.jsx(q,{size:18,style:{display:"inline",marginRight:8}}),r]}),s?t.jsx("div",{style:{textAlign:"center",padding:48},children:t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})}):n.length===0?t.jsx("div",{className:"card",style:{padding:24,textAlign:"center",color:"var(--text-muted)"},children:"No posts to moderate"}):t.jsxs(t.Fragment,{children:[n.map(d=>t.jsxs("div",{className:"card",style:{padding:16,marginBottom:12},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:8},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",marginBottom:4},children:d.username}),t.jsxs("div",{style:{fontSize:12,color:"var(--text-muted)"},children:[new Date(d.created_at).toLocaleDateString()," ",new Date(d.created_at).toLocaleTimeString()]})]}),t.jsx("button",{onClick:()=>u(d.id),style:{background:"none",border:"none",color:"#FF453A",cursor:"pointer",padding:8},title:"Delete post",children:t.jsx(Je,{size:18})})]}),t.jsxs("div",{style:{color:"var(--text-primary)",lineHeight:1.5,wordBreak:"break-word"},children:[d.content.substring(0,300),d.content.length>300?"...":""]}),t.jsxs("div",{style:{fontSize:12,color:"var(--text-muted)",marginTop:8},children:[" ",d.likes||0,"   ",d.replies||0]})]},d.id)),c.totalPages>1&&t.jsx("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:24},children:Array.from({length:c.totalPages},(d,p)=>p+1).map(d=>t.jsx("button",{onClick:()=>h(d),style:{padding:"8px 12px",border:o===d?"1px solid var(--accent)":"1px solid var(--border-subtle)",backgroundColor:o===d?"var(--accent)":"transparent",color:o===d?"#fff":"var(--text-primary)",borderRadius:4,cursor:"pointer",fontSize:12},children:d},d))})]})]})})}function xn(){const[n,e]=l.useState([]),[s,i]=l.useState(!0),[r,a]=l.useState(""),o=()=>{i(!0),v.listAdminHangouts().then(c=>e(c.hangouts||[])).catch(c=>a(c.message||"Failed to load hangouts")).finally(()=>i(!1))};l.useEffect(()=>{o();const c=setInterval(o,1e4);return()=>clearInterval(c)},[]);const f=async c=>{if(confirm("End this hangout room?"))try{await v.endAdminHangout(c),o()}catch(m){a(m.message||"Failed to end hangout")}};return t.jsx(E,{children:t.jsxs("div",{style:{marginBottom:32},children:[t.jsx("h1",{style:{fontSize:24,marginBottom:24},children:"Manage Hangouts"}),r&&t.jsxs("div",{className:"card",style:{padding:16,marginBottom:24,color:"#ff453a"},children:[t.jsx(q,{size:18,style:{display:"inline",marginRight:8}}),r]}),s?t.jsx("div",{style:{textAlign:"center",padding:48},children:t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})}):n.length===0?t.jsx("div",{className:"card",style:{padding:24,textAlign:"center",color:"var(--text-muted)"},children:"No active hangout rooms"}):t.jsx(t.Fragment,{children:n.map(c=>t.jsx("div",{className:"card",style:{padding:16,marginBottom:12},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:8},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontWeight:"600",fontSize:14,marginBottom:4},children:c.title||"Untitled Room"}),t.jsxs("div",{style:{fontSize:12,color:"var(--text-muted)",marginBottom:8},children:["Created by: ",c.creatorName]}),t.jsxs("div",{style:{display:"flex",gap:16,fontSize:12},children:[t.jsxs("div",{children:[t.jsx(M,{size:14,style:{display:"inline",marginRight:4}}),c.currentParticipants," / ",c.maxParticipants," participants"]}),t.jsx("div",{children:c.isPublic?" Public":" Private"}),t.jsxs("div",{style:{color:"var(--text-muted)"},children:["Created: ",new Date(c.createdAt).toLocaleDateString()]})]})]}),t.jsxs("button",{onClick:()=>f(c.id),style:{background:"none",border:"none",color:"#FF453A",cursor:"pointer",padding:8,display:"flex",alignItems:"center",gap:6,fontSize:12},title:"End hangout",children:[t.jsx(Mt,{size:18}),"End Room"]})]})},c.id))})]})})}function z({children:n}){const{user:e,loading:s}=L();return s?t.jsxs("div",{className:"loading-screen",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{children:"Loading..."})]}):e?n:(window.location.replace("/login"),null)}function ee({children:n}){const{user:e,loading:s}=L();return s?t.jsxs("div",{className:"loading-screen",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{children:"Loading..."})]}):e?["admin","superadmin"].includes(e.role)?n:t.jsx(Ue,{to:"/",replace:!0}):(window.location.replace("/login"),null)}function yn(){return t.jsx(Vt,{children:t.jsxs(vt,{children:[t.jsx(A,{path:"/",element:t.jsx(z,{children:t.jsx(Ys,{})})}),t.jsx(A,{path:"/profile",element:t.jsx(z,{children:t.jsx(Qs,{})})}),t.jsx(A,{path:"/nearby",element:t.jsx(z,{children:t.jsx(en,{})})}),t.jsx(A,{path:"/hangouts",element:t.jsx(z,{children:t.jsx(rn,{})})}),t.jsx(A,{path:"/live",element:t.jsx(z,{children:t.jsx(an,{})})}),t.jsx(A,{path:"/videorama",element:t.jsx(z,{children:t.jsx(on,{})})}),t.jsx(A,{path:"/feed",element:t.jsx(z,{children:t.jsx(ln,{})})}),t.jsx(A,{path:"/wall/:userId",element:t.jsx(z,{children:t.jsx(cn,{})})}),t.jsx(A,{path:"/messages",element:t.jsx(z,{children:t.jsx(hn,{})})}),t.jsx(A,{path:"/messages/:partnerId",element:t.jsx(z,{children:t.jsx(fn,{})})}),t.jsx(A,{path:"/admin",element:t.jsx(ee,{children:t.jsx(pn,{})})}),t.jsx(A,{path:"/admin/users",element:t.jsx(ee,{children:t.jsx(mn,{})})}),t.jsx(A,{path:"/admin/posts",element:t.jsx(ee,{children:t.jsx(gn,{})})}),t.jsx(A,{path:"/admin/hangouts",element:t.jsx(ee,{children:t.jsx(xn,{})})}),t.jsx(A,{path:"*",element:t.jsx(Ue,{to:"/",replace:!0})})]})})}Wt.createRoot(document.getElementById("root")).render(t.jsx(jt.StrictMode,{children:t.jsx(bt,{basename:"/prime-hub",children:t.jsx(yn,{})})}));
