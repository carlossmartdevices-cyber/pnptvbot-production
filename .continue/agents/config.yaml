name: PNPtv Bot Development
version: 1.0.0
schema: v1

# Modelos de IA para generación de código y asistencia
models:
  # Modelo principal para generación de código y lógica compleja
  - name: Claude Sonnet
    provider: anthropic
    model: claude-3-5-sonnet-20240620  # Usar la versión más reciente disponible
    apiKey: ${ANTHROPIC_API_KEY}
    systemMessage: |
      Eres un asistente experto en desarrollo de bots de Telegram para PNPtv.
      - Usa Node.js + Telegraf.js.
      - Integra pasarelas de pago como Nequi, Daimon Payments y cripto.
      - Optimiza para monetización y engagement.
      - Sigue las mejores prácticas de seguridad y escalabilidad.
      - Usa un tono técnico pero accesible.

  # Modelo rápido para tareas simples (ej: correcciones, sugerencias)
  - name: Claude Haiku
    provider: anthropic
    model: claude-3-5-haiku-20241022
    apiKey: ${ANTHROPIC_API_KEY}
    systemMessage: |
      Asistente rápido para tareas menores en el desarrollo del bot.
      - Responde de forma concisa.
      - Prioriza soluciones prácticas y código listo para usar.

# Servidores MCP (Machine Code Provider) para herramientas personalizadas
mcpServers:
  # Servidor MCP para desarrollo del bot de PNPtv
  - name: pnptv-bot-dev
    command: node
    args:
      - "--loader=ts-node/esm"  # Soporte para TypeScript/ESM
      - "scripts/pnptv-mcp-server.mjs"
    env:
      NODE_OPTIONS: "--experimental-vm-modules"
      BOT_TOKEN: ${BOT_TOKEN}
      FIREBASE_CREDENTIALS: ${FIREBASE_CREDENTIALS}
      NEQUI_API_KEY: ${NEQUI_API_KEY}
      LOG_LEVEL: "debug"  # Nivel de logging detallado para desarrollo
    # Configuración para reinicio automático en cambios
    watch: ["src/", "scripts/"]

  # Servidor MCP para pruebas de integración con pasarelas de pago
  - name: pnptv-payment-test
    command: node
    args:
      - "scripts/payment-mock-server.mjs"
    env:
      DAIMON_SANDBOX_KEY: ${DAIMON_SANDBOX_KEY}
      CRYPTO_MOCK_API: ${CRYPTO_MOCK_API}
    watch: ["scripts/payment/"]

# Configuración de autocompletado en el editor
tabAutocompleteModel:
  provider: anthropic
  model: claude-3-5-haiku-20241022
  apiKey: ${ANTHROPIC_API_KEY}
  # Contexto específico para autocompletado en el código del bot
  context: |
    - El proyecto usa Node.js v20+, Telegraf.js y Firebase.
    - Las variables de entorno requeridas son: BOT_TOKEN, FIREBASE_CREDENTIALS, NEQUI_API_KEY.
    - Estructura del proyecto:
      /src
        - bot.ts          # Lógica principal del bot
        - payment.ts      # Integración con pasarelas de pago
        - db.ts           # Conexión con Firebase
      /scripts
        - pnptv-mcp-server.mjs  # Servidor MCP para desarrollo
        - payment-mock-server.mjs  # Mock de pasarelas de pago

# Configuración de comandos personalizados para Continue
commands:
  # Generar código para una nueva funcionalidad del bot
  - name: generate:bot-feature
    description: Genera código para una nueva funcionalidad del bot de PNPtv
    systemMessage: |
      Genera código listo para implementar en el bot de PNPtv.
      - Usa TypeScript y Telegraf.js.
      - Incluye comentarios explicativos.
      - Asegúrate de que sea modular y reutilizable.
      - Si es una funcionalidad de pago, integra con el módulo `payment.ts`.
    parameters:
      - name: feature
        type: string
        description: Descripción de la funcionalidad (ej: "sistema de referidos con recompensas")
      - name: file
        type: string
        description: Archivo donde se guardará el código (ej: "src/referral.ts")

  # Generar pruebas para una funcionalidad existente
  - name: test:bot-feature
    description: Genera pruebas unitarias para una funcionalidad del bot
    systemMessage: |
      Genera pruebas unitarias usando Jest para la funcionalidad especificada.
      - Cubre casos de éxito y error.
      - Usa mocks para dependencias externas (ej: APIs de pago).
    parameters:
      - name: feature
        type: string
        description: Funcionalidad a probar (ej: "procesamiento de pagos con Nequi")

  # Documentar una parte del código
  - name: docs:generate
    description: Genera documentación para un módulo o funcionalidad
    systemMessage: |
      Genera documentación en formato Markdown para el código especificado.
      - Explica el propósito, parámetros y ejemplos de uso.
      - Incluye diagramas de flujo si es relevante.
    parameters:
      - name: module
        type: string
        description: Módulo o archivo a documentar (ej: "src/payment.ts")

# Configuración de snippets de código reutilizables
codeSnippets:
  - name: telegraf-command
    description: Plantilla para un nuevo comando en Telegraf.js
    body: |
      import { Composer } from 'telegraf';

      /**
       * ${1:Descripción del comando}
       * @param {string} ${2:param} - ${3:Descripción del parámetro}
       */
      export const ${4:commandName} = new Composer();
      ${4:commandName}.command('${5:cmd}', async (ctx) => {
        try {
          // Lógica del comando aquí
          await ctx.reply('${6:Respuesta del bot}');
        } catch (error) {
          console.error('Error en ${5:cmd}:', error);
          await ctx.reply('⚠️ Ocurrió un error. Intenta nuevamente.');
        }
      });

  - name: firebase-user-query
    description: Consulta a Firestore para obtener datos de un usuario
    body: |
      import { db } from '../db';

      /**
       * Obtiene los datos de un usuario de Firestore
       * @param {number} userId - ID de Telegram del usuario
       * @returns {Promise<FirebaseFirestore.DocumentData>} Datos del usuario
       */
      export async function getUserData(userId: number) {
        const userRef = db.collection('users').doc(userId.toString());
        const doc = await userRef.get();
        if (!doc.exists) {
          throw new Error('Usuario no encontrado');
        }
        return doc.data();
      }

# Configuración de variables de entorno (ejemplo para .env)
envTemplate:
  BOT_TOKEN: "TuTokenDeTelegramBot"
  FIREBASE_CREDENTIALS: "./firebase-key.json"
  NEQUI_API_KEY: "TuApiKeyDeNequi"
  DAIMON_SANDBOX_KEY: "TuApiKeyDeDaimonSandBox"
  ANTHROPIC_API_KEY: "TuApiKeyDeAnthropic"
  LOG_LEVEL: "debug"
