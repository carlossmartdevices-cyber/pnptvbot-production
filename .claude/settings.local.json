{
  "permissions": {
    "allow": [
      "Bash(ls:*)",
      "Bash(cat:*)",
      "Bash(echo:*)",
      "Bash(rm:*)",
      "Bash(cp:*)",
      "Bash(chmod:*)",
      "Bash(ln:*)",
      "Bash(touch:*)",
      "Bash(find:*)",
      "Bash(grep:*)",
      "Bash(wc:*)",
      "Bash(tail:*)",
      "Bash(tree:*)",
      "Bash(readlink:*)",
      "Bash(xargs:*)",
      "Bash(test:*)",
      "Bash(node:*)",
      "Bash(node -e:*)",
      "Bash(node -c:*)",
      "Bash(node --version:*)",
      "Bash(node --check:*)",
      "Bash(npm run:*)",
      "Bash(npm install:*)",
      "Bash(npm uninstall:*)",
      "Bash(npm test:*)",
      "Bash(npm start)",
      "Bash(npm ci)",
      "Bash(npm run build:*)",
      "Bash(npm run lint:*)",
      "Bash(npm run test:unit:*)",
      "Bash(npm cache clean:*)",
      "Bash(npm show:*)",
      "Bash(pm2 list:*)",
      "Bash(pm2 logs:*)",
      "Bash(pm2 restart:*)",
      "Bash(pm2 delete:*)",
      "Bash(pm2 start:*)",
      "Bash(pm2 stop:*)",
      "Bash(pm2 status:*)",
      "Bash(pm2 save:*)",
      "Bash(pm2 show:*)",
      "Bash(pm2 info:*)",
      "Bash(pm2 kill:*)",
      "Bash(pm2 --version:*)",
      "Bash(pm2 startup:*)",
      "Bash(pm2 flush:*)",
      "Bash(pm2 reload:*)",
      "Bash(git status:*)",
      "Bash(git diff:*)",
      "Bash(git log:*)",
      "Bash(git show:*)",
      "Bash(git push:*)",
      "Bash(git pull:*)",
      "Bash(git fetch:*)",
      "Bash(git merge:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git checkout:*)",
      "Bash(git branch:*)",
      "Bash(git config:*)",
      "Bash(git remote:*)",
      "Bash(git tag:*)",
      "Bash(git -C:*)",
      "Bash(curl:*)",
      "Bash(ping:*)",
      "Bash(netstat:*)",
      "Bash(ss:*)",
      "Bash(lsof:*)",
      "Bash(nslookup:*)",
      "Bash(dig:*)",
      "Bash(whois:*)",
      "Bash(ip route:*)",
      "Bash(openssl:*)",
      "Bash(certbot:*)",
      "Bash(nginx -t:*)",
      "Bash(nginx -T:*)",
      "Bash(psql:*)",
      "Bash(PGPASSWORD=*)",
      "Bash(pg_isready:*)",
      "Bash(redis-cli:*)",
      "Bash(docker:*)",
      "Bash(docker-compose:*)",
      "Bash(systemctl status:*)",
      "Bash(systemctl restart:*)",
      "Bash(systemctl reload:*)",
      "Bash(systemctl list-units:*)",
      "Bash(journalctl:*)",
      "Bash(sudo systemctl:*)",
      "Bash(sudo nginx:*)",
      "Bash(sudo certbot:*)",
      "Bash(sudo cp:*)",
      "Bash(sudo rm:*)",
      "Bash(sudo ln:*)",
      "Bash(sudo tail:*)",
      "Bash(sudo lsof:*)",
      "Bash(sudo journalctl:*)",
      "Bash(sudo -u postgres psql:*)",
      "Bash(timeout:*)",
      "Bash(kill:*)",
      "Bash(killall:*)",
      "Bash(pkill:*)",
      "Bash(ps:*)",
      "Bash(top:*)",
      "Bash(env)",
      "Bash(source:*)",
      "Bash(export:*)",
      "Bash(python3:*)",
      "Bash(pip install:*)",
      "Bash(yt-dlp:*)",
      "Bash(scp:*)",
      "Bash(ssh-keyscan:*)",
      "Bash(ssh-add:*)",
      "Bash(sshpass:*)",
      "Bash(apt-get:*)",
      "Bash(apt:*)",
      "Bash(crontab:*)",
      "Bash(lastlog:*)",
      "Bash(zcat:*)",
      "WebSearch",
      "WebFetch(domain:docs.daimo.com)",
      "WebFetch(domain:github.com)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nchore: Clean up Claude Code settings permissions\n\nConsolidate 244 cluttered permission entries down to 122 clean wildcard\npatterns. Removed broken shell fragments, embedded commit messages, and\noverly specific one-off commands. Organized by category: file ops, node/npm,\npm2, git, network, database, docker, system, and utilities.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: Add approved URLs to Grok configuration\n\nOnly allow pnptv.app and t.me/pnplatinotv_bot URLs in generated text.\nPrevents Grok from using random or incorrect URLs in broadcasts/posts.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push)",
      "Bash(git -C /root/pnptvbot-production status)",
      "Bash(git -C /root/pnptvbot-production diff src/bot/services/jaasService.js src/services/emailService.js)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: Disable recording features and remove broadcast email BCC\n\n- Set livestreaming and recording to false in JaaS moderator config\n- Remove BCC to hello@easybots.store from broadcast emails\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(sudo find:*)",
      "Bash(dmesg:*)",
      "Bash(PGPASSWORD='Apelo801050#' psql:*)",
      "Bash(bash:*)",
      "Bash(npx jest:*)",
      "Bash(npm audit:*)",
      "Bash(gh api:*)",
      "Bash(done)",
      "Bash(ssh -o StrictHostKeyChecking=no root@148.230.80.210 \"echo ''Source server connection OK''\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@76.13.26.234 \"echo ''Destination server connection OK''\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@148.230.80.210 \"PGPASSWORD=''Apelo801050#'' pg_dump -U pnptvbot -h localhost -d pnptvbot > /tmp/pnptvbot_backup.sql && echo ''Backup created successfully''\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@148.230.80.210 \"apt-get update && apt-get install -y postgresql-client && echo ''PostgreSQL client installed''\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@148.230.80.210 \"rm /etc/apt/sources.list.d/monarx.sources 2>/dev/null; apt-get update && apt-get install -y postgresql-client && echo ''PostgreSQL client installed''\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@148.230.80.210 \"rm -f /etc/apt/sources.list.d/monarx* && apt-get update && apt-get install -y postgresql-client\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@148.230.80.210 \"PGPASSWORD=''Apelo801050#'' pg_dump -U pnptvbot -h localhost -d pnptvbot > /tmp/pnptvbot_backup.sql && ls -lh /tmp/pnptvbot_backup.sql\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@148.230.80.210 \"systemctl status postgresql || systemctl status postgresql-17 || echo ''PostgreSQL not installed/running''\")",
      "Bash(pm2:*)",
      "Bash(ssh-keygen:*)",
      "Bash(ssh -o StrictHostKeyChecking=no root@76.13.26.234 \"systemctl status postgresql || systemctl status postgresql-17 || echo ''PostgreSQL not found''\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@76.13.26.234 \"apt-get update && apt-get install -y postgresql postgresql-contrib && systemctl start postgresql && systemctl enable postgresql\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@76.13.26.234 \"sudo -u postgres psql -c \"\"CREATE USER pnptvbot WITH PASSWORD ''Apelo801050#'';\"\" && sudo -u postgres psql -c \"\"CREATE DATABASE pnptvbot OWNER pnptvbot;\"\" && echo ''Database and user created''\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@76.13.26.234 \"sed -i \"\"s/#listen_addresses = ''localhost''/listen_addresses = ''*''/\"\" /etc/postgresql/17/main/postgresql.conf && echo ''host    all             all             0.0.0.0/0               scram-sha-256'' >> /etc/postgresql/17/main/pg_hba.conf && systemctl restart postgresql && echo ''PostgreSQL configured for remote connections''\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@148.230.80.210 \"PGPASSWORD=''Apelo801050#'' pg_dump -U pnptvbot -h localhost -d pnptvbot > /tmp/pnptvbot_backup.sql && ls -lh /tmp/pnptvbot_backup.sql && echo ''Backup created successfully''\")",
      "Bash(systemctl start:*)",
      "Bash(systemctl enable:*)",
      "Bash(ssh:*)",
      "Bash(xxd:*)",
      "Bash(npx prisma db pull:*)",
      "Bash(DATABASE_URL=\"postgresql://pnptvbot:Apelo801050%23@76.13.26.234:5432/pnptvbot\" DIRECT_URL=\"postgresql://pnptvbot:Apelo801050%23@76.13.26.234:5432/pnptvbot\" npx prisma db pull --print)",
      "Bash(DATABASE_URL=\"postgresql://pnptvbot:Apelo801050%23@76.13.26.234:5432/pnptvbot\" DIRECT_URL=\"postgresql://pnptvbot:Apelo801050%23@76.13.26.234:5432/pnptvbot\" npx prisma migrate deploy:*)",
      "Bash(DATABASE_URL=\"postgresql://pnptvbot:Apelo801050%23@76.13.26.234:5432/pnptvbot\" DIRECT_URL=\"postgresql://pnptvbot:Apelo801050%23@76.13.26.234:5432/pnptvbot\" npx prisma generate:*)",
      "WebFetch(domain:developer.x.com)",
      "WebFetch(domain:devcommunity.x.com)",
      "WebFetch(domain:docs.x.com)",
      "WebFetch(domain:doc.qatouch.com)",
      "WebFetch(domain:www.qatouch.com)",
      "WebFetch(domain:www.npmjs.com)",
      "WebFetch(domain:help.qatouch.com)",
      "WebFetch(domain:raw.githubusercontent.com)",
      "WebFetch(domain:api.epayco.co)",
      "WebFetch(domain:docs.epayco.com)",
      "WebFetch(domain:docs.epayco.co)",
      "WebFetch(domain:epayco.com)",
      "WebFetch(domain:paydocs.daimo.com)",
      "WebFetch(domain:easybots.qatouch.com)",
      "WebFetch(domain:www.cake.me)",
      "WebFetch(domain:easybots.store)",
      "Bash(ip -6 addr show:*)",
      "Bash(ip:*)",
      "Bash(traceroute:*)",
      "Bash(iptables:*)",
      "Bash(nginx -v:*)",
      "Bash(nginx:*)",
      "Bash(npm --prefix /root/pnptvbot-production list:*)",
      "Bash(QATOUCH_ENABLED=true QATOUCH_DOMAIN=easybots QATOUCH_API_TOKEN=8fb541327b0751dca039f783a1adf40b1abc08bf671fdb58788a3961b9a2fdbd QATOUCH_PROJECT_KEY=Gl5X QATOUCH_TEST_RUN_ID=rGDQP timeout 60 npx jest:*)",
      "Bash(/tmp/sitemap_report.md << 'EOF'\n# PNPtv Bot - Comprehensive Web Application Sitemap\n\n## Executive Summary\nThis document provides a complete inventory of all web apps, pages, API endpoints, and nginx configurations served by the PNPtv Bot production environment.\n\n**Domains Served:**\n- `pnptv.app` - Main PNPtv application\n- `easybots.store` - Payment processing and bot service\n- `easybots.site` - Additional payment webhook handlers\n\n**Core Infrastructure:**\n- Express.js API Server: Port 3001\n- Next.js Application \\(easybots.store\\): Port 3010\n- Nginx Reverse Proxy: Handles routing, SSL termination\n\n---\n\n## 1. NGINX CONFIGURATIONS\n\n### pnptv.app \\(Main Domain\\)\n**File:** `/etc/nginx/sites-available/pnptv.app`\n\n**HTTP/HTTPS Configuration:**\n- HTTP \\(port 80\\): Redirects to HTTPS\n- HTTPS \\(port 443\\): SSL/TLS enabled via Let's Encrypt\n\n**Static File Serving:**\n- Root directory: `/var/www/pnptv.app`\n- Static assets cached for 30 days\n- Supported formats: JS, CSS, PNG, JPG, GIF, ICO, SVG, WOFF, WOFF2\n\n**Nginx Location Blocks:**\n| Path | Type | Backend | Purpose |\n|------|------|---------|---------|\n| `/hangouts` | Static/SPA | `/var/www/pnptv.app/hangouts` | Video call application |\n| `/videorama` | Static/SPA | `/var/www/pnptv.app/videorama-app` | Media center app |\n| `/live` | Static/SPA | `/var/www/pnptv.app/live` | Live streaming portal |\n| `/lifetime100` | Static | `/lifetime-pass.html` | Lifetime pass landing |\n| `/lifetime-pass` | Static | `/lifetime-pass.html` | Lifetime pass landing |\n| `/terms` | Static | `/terms.html` | Terms and conditions |\n| `/privacy` | Static | `/privacy.html` | Privacy policy |\n| `/age-verification` | Static | `/age-verification.html` | Age verification page |\n| `/age-verification-camera` | Static | `/age-verification-camera.html` | Camera-based age verification |\n| `/age-verification-faq` | Static | `/age-verification-security-faq.html` | FAQ |\n| `/checkout` | Static | `/checkout.html` | Checkout page |\n| `/payment-checkout` | Static | `/payment-checkout.html` | Payment checkout |\n| `/payment/` | Proxy | http://127.0.0.1:3001 | Payment handling \\(Express backend\\) |\n| `/checkout/` | Proxy | http://127.0.0.1:3001 | Checkout routing \\(Express backend\\) |\n| `/daimo-checkout/` | Proxy | http://127.0.0.1:3001 | Daimo payment checkout |\n| `/api` | Proxy | http://127.0.0.1:3001 | API endpoints |\n| `/webhook` | Proxy | http://127.0.0.1:3001 | Webhook handlers |\n| `/` | Static/SPA | `/index.html` | Landing page \\(SPA fallback\\) |\n\n---\n\n### easybots.store \\(Payment & Bot Service\\)\n**File:** `/etc/nginx/sites-available/easybots.store`\n\n**HTTP/HTTPS Configuration:**\n- HTTP \\(port 80\\): Redirects to HTTPS\n- HTTPS \\(port 443\\): SSL/TLS enabled\n\n**Primary Routing:**\n- Default: Proxies to http://localhost:3010 \\(Next.js app\\)\n\n**Specific Location Blocks:**\n| Path | Type | Backend | Purpose |\n|------|------|---------|---------|\n| `/webhook/telegram` | Proxy | localhost:3001 | Telegram webhook |\n| `/webapps/` | Static | `/root/pnptvbot-production/webapps/` | Design system assets |\n| `/payment/` | Proxy | localhost:3001 | Payment handling |\n| `/api/webhooks/` | Proxy | localhost:3001 | Payment webhooks |\n| `/api/webhook/` | Proxy | localhost:3001 | Payment webhook \\(singular\\) |\n| `/api/payment` | Proxy | localhost:3001 | Payment API |\n| `/api/payment-response` | Proxy | localhost:3001 | Payment response |\n| `/daimo-checkout/` | Proxy | localhost:3001 | Daimo checkout |\n| `/` | Proxy | localhost:3010 | Next.js app |\n\n---\n\n### easybots.site \\(Additional Payment Handler\\)\n**File:** `/etc/nginx/sites-available/easybots.site`\n\n**HTTPS Configuration:**\n- Port 443: SSL/TLS enabled\n- Port 80: Returns 404\n\n**Specific Location Blocks:**\n| Path | Type | Backend | Purpose |\n|------|------|---------|---------|\n| `/api/webhook/` | Proxy | localhost:3001 | ePayco webhook |\n| `/api/webhooks/` | Proxy | localhost:3001 | Payment webhooks |\n| `/payment/` | Proxy | localhost:3001 | Payment pages |\n| `/api/payment` | Proxy | localhost:3001 | Payment API |\n| `/api/payment-response` | Proxy | localhost:3001 | Payment response |\n| `/daimo-checkout/` | Proxy | localhost:3001 | Daimo checkout |\n| `/webapps/` | Static | `/root/pnptvbot-production/webapps/` | Design assets |\n| `/` | Not Found | - | Returns 404 for all else |\n\n---\n\n## 2. EXPRESS.JS API ROUTES \\(Port 3001\\)\n\n**File:** `/root/pnptvbot-production/src/bot/api/routes.js`\n\n### Authentication Routes\n\n| Method | Path | Handler | Purpose | Auth Required |\n|--------|------|---------|---------|---------------|\n| POST | `/api/telegram-auth` | `handleTelegramAuth` | Authenticate user via Telegram | No |\n| POST | `/api/accept-terms` | `handleAcceptTerms` | Accept terms and conditions | No |\n| GET | `/api/auth-status` | `checkAuthStatus` | Check authentication status | No |\n| POST | `/api/logout` | Express handler | Logout and clear session | Yes |\n\n### Landing & Static Pages\n\n| Method | Path | File/Handler | Purpose |\n|--------|------|--------------|---------|\n| GET | `/` | `index.html` or Landing \\(domain-aware\\) | Home page |\n| GET | `/community-room` | `community-room.html` | PNPtv Haus |\n| GET | `/pnptv-haus` | Redirect to `/community-room.html` | Alias for Haus |\n| GET | `/community-features` | `community-features.html` | Community features |\n| GET | `/how-to-use` | `how-to-use.html` | Usage guide |\n| GET | `/lifetime-pass` | `lifetime-pass.html` | Lifetime pass landing |\n| GET | `/lifetime100` | `lifetime-pass.html` | $100 lifetime promo |\n| GET | `/terms` | `terms.html` or `policies_es.html` | Terms of service |\n| GET | `/privacy` | `privacy.html` or `policies_es.html` | Privacy policy |\n| GET | `/policies` | `terms.html` or `policies_es.html` | Policies page |\n| GET | `/age-verification` | `age-verification.html` | Age verification |\n\n**Query Parameters for Landing Pages:**\n- `/terms?lang=es` - Spanish terms\n- `/privacy?lang=es` - Spanish privacy\n- `/policies?lang=es` - Spanish policies\n\n### Protected Web Apps \\(Require Telegram Login\\)\n\n| Method | Path | Files | Purpose |\n|--------|------|-------|---------|\n| GET | `/videorama` | `public/videorama-app/index.html` | Videorama media center |\n| GET | `/videorama/*` | Videorama app assets | Videorama SPA routing |\n| GET | `/hangouts` | `public/hangouts/index.html` | Video call hangouts |\n| GET | `/hangouts/*` | Hangouts app assets | Hangouts SPA routing |\n| GET | `/live` | `public/live/index.html` | Live streaming |\n| GET | `/live/*` | Live app assets | Live SPA routing |\n| GET | `/pnplive` | `public/live/index.html` | PNP Live portal \\(alias\\) |\n\n### Payment & Checkout Routes\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/checkout/:paymentId` | ePayco checkout page |\n| GET | `/daimo-checkout/:paymentId` | Daimo checkout page |\n| GET | `/payment/:paymentId` | Payment checkout page |\n| GET | `/pnp/meet-greet/checkout/:bookingId` | Meet & greet checkout |\n| GET | `/pnp/meet-greet/daimo-checkout/:bookingId` | Meet & greet daimo checkout |\n| GET | `/pnp/live/checkout/:bookingId` | PNP Live booking checkout |\n| GET | `/pnp/live/daimo-checkout/:bookingId` | PNP Live daimo checkout |\n| GET | `/recurring-checkout/:userId/:planId` | Recurring subscription checkout |\n\n---\n\n## 3. PAYMENT API ENDPOINTS\n\n### Payment Controller \\(`/api/payment*`\\)\n\n| Method | Path | Purpose | Parameters |\n|--------|------|---------|------------|\n| GET | `/api/payment/:paymentId` | Get payment info for checkout | `paymentId` \\(URL param\\) |\n| POST | `/api/payment/tokenized-charge` | Process card charge | Body: card details, customer info |\n| GET | `/api/confirm-payment/:token` | Verify and consume token | `token` \\(URL param\\) |\n\n### Webhook Controllers\n\n| Method | Path | Purpose | Source |\n|--------|------|---------|--------|\n| POST | `/api/webhooks/epayco` | ePayco payment webhook | ePayco servers |\n| POST | `/api/webhook/epayco` | ePayco webhook \\(singular alias\\) | ePayco servers |\n| POST | `/api/webhooks/daimo` | Daimo payment webhook | Daimo servers |\n| POST | `/api/webhooks/visa-cybersource` | Visa CyberSource webhook | Visa servers |\n| GET | `/api/webhooks/visa-cybersource/health` | Visa webhook health check | - |\n| GET | `/api/payment-response` | Payment response page | Browser redirect |\n\n### Subscription API \\(`/api/subscription*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/subscription/plans` | Get available subscription plans |\n| POST | `/api/subscription/create-plan` | Create ePayco plan |\n| POST | `/api/subscription/create-checkout` | Create subscription checkout |\n| POST | `/api/subscription/epayco/confirmation` | ePayco subscription confirmation |\n| GET | `/api/subscription/payment-response` | Subscription payment response |\n| GET | `/api/subscription/subscriber/:identifier` | Get subscriber details |\n| GET | `/api/subscription/stats` | Get subscription statistics |\n\n### Recurring Subscription API \\(`/api/recurring*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| POST | `/api/recurring/tokenize` | Tokenize credit card |\n| POST | `/api/recurring/subscribe` | Create recurring subscription |\n| GET | `/api/recurring/subscription/:userId` | Get subscription details |\n| POST | `/api/recurring/cancel` | Cancel subscription |\n| POST | `/api/recurring/reactivate` | Reactivate subscription |\n\n---\n\n## 4. BOOKING & SERVICE API ENDPOINTS\n\n### Meet & Greet \\(`/api/meet-greet*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/meet-greet/booking/:bookingId` | Get booking details |\n| POST | `/api/meet-greet/booking/:bookingId/confirm` | Confirm booking payment |\n\n### PNP Live \\(`/api/pnp-live*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/pnp-live/booking/:bookingId` | Get live booking details |\n| POST | `/api/pnp-live/booking/:bookingId/confirm` | Confirm live booking |\n\n### Hangouts \\(`/api/hangouts*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/hangouts/public` | List public hangout calls |\n| POST | `/api/hangouts/create` | Create new hangout call |\n| POST | `/api/hangouts/join/:callId` | Join hangout call |\n\n### Group Invitations\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/join-group/:token` | Verify group invitation |\n| GET | `/join-group/:token` | Redirect to group \\(non-API\\) |\n\n---\n\n## 5. MEDIA & LIBRARY API ENDPOINTS\n\n### Media Library \\(`/api/media*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/media/library` | Get media library \\(with filters\\) |\n| GET | `/api/media/categories` | Get available media categories |\n| GET | `/api/media/:mediaId` | Get single media item |\n| GET | `/api/media/playlists` | Get public playlists |\n\n### Videorama Collections \\(`/api/videorama*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/videorama/collections` | Get featured collections |\n| GET | `/api/videorama/collections/:collectionId` | Get collection items |\n\n### Radio \\(`/api/radio*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/radio/now-playing` | Get currently playing track |\n| GET | `/api/radio/history` | Get radio play history |\n| GET | `/api/radio/schedule` | Get radio broadcast schedule |\n| POST | `/api/radio/request` | Submit song request |\n\n### Playlist Management \\(`/api/playlists*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/playlists/user` | Get user's playlists |\n| GET | `/api/playlists/public` | Get public playlists |\n| POST | `/api/playlists` | Create new playlist |\n| POST | `/api/playlists/:playlistId/videos` | Add video to playlist |\n| DELETE | `/api/playlists/:playlistId/videos/:videoId` | Remove video from playlist |\n| DELETE | `/api/playlists/:playlistId` | Delete playlist |\n\n### Podcast Management \\(`/api/podcasts*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| POST | `/api/podcasts/upload` | Upload audio file |\n\n---\n\n## 6. AUDIO MANAGEMENT API\n\n### Audio Streamer \\(`/api/audio*`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/audio/list` | List available audio files |\n| POST | `/api/audio/setup-soundcloud` | Setup SoundCloud background audio |\n| GET | `/api/audio/current` | Get current track info |\n| POST | `/api/audio/stop` | Stop background audio |\n| DELETE | `/api/audio/:filename` | Delete audio file |\n\n---\n\n## 7. BROADCAST QUEUE MANAGEMENT\n\n### Queue Routes \\(`/api/admin/queue*`\\)\n\n**Mounted at:** `/api/admin/queue`\n\n| Method | Path \\(relative\\) | Full Path | Purpose |\n|--------|-----------------|-----------|---------|\n| GET | `/status` | `/api/admin/queue/status` | Get overall queue status |\n| GET | `/:queueName/status` | `/api/admin/queue/:queueName/status` | Get specific queue status |\n| GET | `/:queueName/jobs` | `/api/admin/queue/:queueName/jobs` | List queue jobs |\n| GET | `/:queueName/failed` | `/api/admin/queue/:queueName/failed` | List failed jobs |\n| GET | `/job/:jobId` | `/api/admin/queue/job/:jobId` | Get job details |\n| GET | `/broadcasts/failed` | `/api/admin/queue/broadcasts/failed` | List failed broadcasts |\n| POST | `/job/:jobId/retry` | `/api/admin/queue/job/:jobId/retry` | Retry job |\n| POST | `/broadcast/:jobId/retry` | `/api/admin/queue/broadcast/:jobId/retry` | Retry broadcast |\n| GET | `/statistics` | `/api/admin/queue/statistics` | Get queue statistics |\n| POST | `/:queueName/cleanup` | `/api/admin/queue/:queueName/cleanup` | Clear old jobs |\n| GET | `/health` | `/api/admin/queue/health` | Health check |\n\n---\n\n## 8. X OAUTH INTEGRATION\n\n### X OAuth Routes \\(`/api/admin/x/oauth` and `/api/auth/x`\\)\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/api/admin/x/oauth/start` | Start X OAuth flow |\n| GET | `/api/admin/x/oauth/callback` | X OAuth callback |\n| GET | `/api/auth/x/start` | Alias for OAuth start |\n| GET | `/api/auth/x/callback` | Alias for OAuth callback |\n\n---\n\n## 9. HEALTH & MONITORING\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | `/health` | Basic health check |\n| GET | `/api/health` | API health check |\n| GET | `/api/metrics` | Performance metrics |\n| POST | `/api/metrics/reset` | Reset metrics |\n| GET | `/api/stats` | System statistics |\n\n**Health Check Response Includes:**\n- System status \\(healthy/degraded/unhealthy\\)\n- Database connection status\n- Redis connection status\n- Memory usage\n- Node.js version\n- Response time metrics\n\n---\n\n## 10. AUTH PAGES & REDIRECTS\n\n### Auth Page Routes\n\n| Method | Path | Purpose | File |\n|--------|------|---------|------|\n| GET | `/auth/telegram-login-complete` | Telegram login completion | `telegram-login-complete.html` |\n| GET | `/auth/telegram-login` | Telegram login page | `telegram-login.html` |\n| GET | `/auth/terms` | Terms acceptance | `terms.html` |\n| GET | `/auth/not-registered` | New user onboarding | `not-registered.html` |\n\n### Login Flow\n- Redirect: `/login?return=[URL]` → `/auth/telegram-login`\n- User not authenticated on protected pages automatically redirected to login with return URL\n\n---\n\n## 11. PUBLIC HTML FILES\n\n### Root Level Files\n\n| File | Path | Purpose |\n|------|------|---------|\n| `index.html` | `/public/index.html` | Main landing page \\(SPA\\) |\n| `landing.html` | `/public/landing.html` | Alternative landing |\n| `community-room.html` | `/public/community-room.html` | PNPtv Haus |\n| `community-features.html` | `/public/community-features.html` | Community features |\n| `how-to-use.html` | `/public/how-to-use.html` | Usage guide |\n| `lifetime-pass.html` | `/public/lifetime-pass.html` | Lifetime pass offer |\n| `terms.html` | `/public/terms.html` | Terms of service |\n| `privacy.html` | `/public/privacy.html` | Privacy policy |\n| `policies_en.html` | `/public/policies_en.html` | Policies \\(English\\) |\n| `policies_es.html` | `/public/policies_es.html` | Policies \\(Spanish\\) |\n| `age-verification.html` | `/public/age-verification.html` | Age verification form |\n| `age-verification-camera.html` | `/public/age-verification-camera.html` | Camera verification |\n| `age-verification-security-faq.html` | `/public/age-verification-security-faq.html` | Security FAQ |\n| `payment-checkout.html` | `/public/payment-checkout.html` | Payment checkout |\n| `daimo-checkout.html` | `/public/daimo-checkout.html` | Daimo checkout |\n| `recurring-checkout.html` | `/public/recurring-checkout.html` | Recurring subscription |\n| `meet-greet-checkout.html` | `/public/meet-greet-checkout.html` | Meet & Greet checkout |\n| `meet-greet-daimo-checkout.html` | `/public/meet-greet-daimo-checkout.html` | M&G Daimo checkout |\n| `pnp-live-checkout.html` | `/public/pnp-live-checkout.html` | PNP Live checkout |\n| `pnp-live-daimo-checkout.html` | `/public/pnp-live-daimo-checkout.html` | PNP Live Daimo checkout |\n| `youtube-playlist.html` | `/public/youtube-playlist.html` | YouTube playlist |\n\n### SPA Applications\n\n| App | Root | Index File | Purpose |\n|-----|------|-----------|---------|\n| Videorama | `/videorama` | `public/videorama-app/index.html` | Media center & video streaming |\n| Hangouts | `/hangouts` | `public/hangouts/index.html` | Video calls & community rooms |\n| Live | `/live` | `public/live/index.html` | Live streaming portal |\n| Radio | `/radio` | `public/radio/index.html` | Radio streaming & stations |\n| Materialious | `/materialious` | `public/materialious/index.html` | Material Design UI demo |\n| Monitoring | `/monitoring` | `public/monitoring/dashboard.html` | Admin monitoring dashboard |\n\n### Auth Pages\n\n| File | Path | Purpose |\n|------|------|---------|\n| `telegram-login.html` | `/public/auth/telegram-login.html` | Telegram login |\n| `telegram-login-complete.html` | `/public/auth/telegram-login-complete.html` | Login completion |\n| `terms.html` | `/public/auth/terms.html` | Terms acceptance |\n| `not-registered.html` | `/public/auth/not-registered.html` | User registration |\n\n### Static Assets\n\n| Type | Location | Extensions |\n|------|----------|-----------|\n| CSS | `/public/**/*.css` | .css |\n| JavaScript | `/public/**/*.js` | .js |\n| Audio | `/public/audio/` | .mp3 |\n| Images | `/public/**/*` | .png, .jpg, .gif, .svg, .webp |\n\n---\n\n## 12. REFERENCED WEB APP URLs\n\n### Telegram Web App URLs\n\n| Feature | URL Pattern | Default Value |\n|---------|------------|---------------|\n| Videorama | `VIDEORAMA_WEB_APP_URL` | `https://pnptv.app/videorama-app` |\n| Hangouts | `HANGOUTS_WEB_APP_URL` | `https://pnptv.app/hangouts` |\n| Live | \\(embedded in app\\) | `https://pnptv.app/live` |\n\n### Domain References in Code\n\n**pnptv.app URLs:**\n- `https://pnptv.app/lifetime100` - $100 lifetime pass promo\n- `https://pnptv.app/lifetime-pass` - Lifetime pass offer\n- `https://pnptv.app/terms` - Terms of service\n- `https://pnptv.app/terms-en` - English terms\n- `https://pnptv.app/terms-es` - Spanish terms\n- `https://pnptv.app/privacy` - Privacy policy\n- `https://pnptv.app/community-features` - Community features\n- `https://pnptv.app/videorama` - Videorama app\n- `https://pnptv.app/hangouts` - Hangouts app\n- `https://pnptv.app/live` - Live app\n\n**easybots.store URLs:**\n- Used as webhook domain for payment confirmations\n- Used as ePayco confirmation URL\n- Default: `https://easybots.store` \\(from BOT_WEBHOOK_DOMAIN env var\\)\n\n**Email Addresses:**\n- `support@pnptv.app` - Support email\n\n---\n\n## 13. CONTROLLER ENDPOINTS SUMMARY\n\n### Controllers Files\n\n| Controller | Purpose | Main Methods |\n|------------|---------|--------------|\n| `paymentController.js` | Payment processing | `getPaymentInfo`, `processTokenizedCharge`, `confirmPaymentToken` |\n| `subscriptionController.js` | Recurring subscriptions | `getPlans`, `createEpaycoPlan`, `createCheckout`, `handleEpaycoConfirmation` |\n| `webhookController.js` | Payment webhooks | `handleEpaycoWebhook`, `handleDaimoWebhook`, `handlePaymentResponse` |\n| `ageVerificationController.js` | Age verification | `verifyAge` |\n| `hangoutsController.js` | Hangout calls | `listPublic`, `create`, `join` |\n| `playlistController.js` | Playlist CRUD | `getUserPlaylists`, `createPlaylist`, `addToPlaylist`, `deletePlaylist` |\n| `podcastController.js` | Podcast uploads | `uploadAudio` |\n| `invitationController.js` | Group invites | `verifyGroupInvitation`, `redirectToGroup` |\n| `xOAuthController.js` | X OAuth | `startOAuth`, `handleCallback` |\n| `healthController.js` | System health | `healthCheck`, `performanceMetrics`, `resetMetrics` |\n| `visaCybersourceWebhookController.js` | Visa webhooks | `handleWebhook`, `healthCheck` |\n\n---\n\n## 14. RATE LIMITING\n\n| Endpoint Group | Limit | Window | Notes |\n|---|---|---|---|\n| General API | 100 requests | 15 minutes | Applied to `/api/*` |\n| Webhooks | 50 requests | 5 minutes | Stricter for payment webhooks |\n| Health Checks | 30 requests | 1 minute | For monitoring endpoints |\n\n---\n\n## 15. SECURITY & BLOCKING\n\n### Domain-Based Content Blocking\n\n**For easybots.store domain:**\n- ✅ Allowed: `/api/*`, `/webhook/*`, `/payment/*`, `/daimo-checkout/*`, `/checkout/*`, `/health`\n- ❌ Blocked: Static HTML files, asset files \\(.css, .js, .jpg, .png, etc.\\)\n- ❌ Blocked: Protected routes \\(`/videorama`, `/hangouts`, `/live`, `/pnplive`\\)\n\n**For easybots.site domain:**\n- ✅ Allowed: Payment webhooks and APIs only\n- ❌ Blocked: Everything else \\(returns 404\\)\n\n### Protected Routes \\(Auth Required\\)\n\nRoutes that require Telegram login:\n- `/videorama` - Videorama app\n- `/hangouts` - Hangouts app  \n- `/live` - Live streaming\n- `/pnplive` - PNP Live portal\n\n---\n\n## 16. ENVIRONMENT CONFIGURATION\n\n### Key Environment Variables\n\n| Variable | Purpose | Default |\n|----------|---------|---------|\n| `BOT_WEBHOOK_DOMAIN` | Domain for payment webhooks | `https://pnptv.app` |\n| `EPAYCO_WEBHOOK_DOMAIN` | ePayco confirmation URL | `https://easybots.store` |\n| `EPAYCO_PUBLIC_KEY` | ePayco public key | - |\n| `EPAYCO_TEST_MODE` | ePayco test mode | - |\n| `VIDEORAMA_WEB_APP_URL` | Videorama app URL | `https://pnptv.app/videorama-app` |\n| `HANGOUTS_WEB_APP_URL` | Hangouts app URL | `https://pnptv.app/hangouts` |\n| `SESSION_SECRET` | Session encryption | `pnptv-secret-key` |\n| `NODE_ENV` | Environment | `production` |\n\n---\n\n## 17. STATIC FILES STRUCTURE\n\n```\npublic/\n├── index.html                          \\(Main landing\\)\n├── landing.html\n├── community-room.html                 \\(PNPtv Haus\\)\n├── community-features.html\n├── how-to-use.html\n├── lifetime-pass.html                  \\(Lifetime offer\\)\n├── terms.html\n├── privacy.html\n├── policies_en.html\n├── policies_es.html\n├── age-verification.html               \\(Age verification\\)\n├── age-verification-camera.html\n├── age-verification-security-faq.html\n├── payment-checkout.html               \\(Checkout pages\\)\n├── daimo-checkout.html\n├── recurring-checkout.html\n├── meet-greet-checkout.html\n├── meet-greet-daimo-checkout.html\n├── pnp-live-checkout.html\n├── pnp-live-daimo-checkout.html\n├── youtube-playlist.html\n│\n├── auth/                               \\(Auth pages\\)\n│   ├── telegram-login.html\n│   ├── telegram-login-complete.html\n│   ├── terms.html\n│   └── not-registered.html\n│\n├── videorama-app/                      \\(Videorama SPA\\)\n│   ├── index.html\n│   └── assets/\n│       ├── *.js\n│       └── *.css\n│\n├── hangouts/                           \\(Hangouts SPA\\)\n│   ├── index.html\n│   └── assets/\n│       ├── *.js \\(including Agora SDK\\)\n│       └── *.css\n│\n├── live/                               \\(Live streaming SPA\\)\n│   ├── index.html\n│   └── assets/\n│       ├── *.js \\(including Agora SDK\\)\n│       └── *.css\n│\n├── radio/                              \\(Radio app\\)\n│   ├── index.html\n│   └── assets/\n│       ├── *.js\n│       └── *.css\n│\n├── materialious/                       \\(Material Design demo\\)\n│   ├── index.html\n│   └── js/\n│       └── app.js\n│\n├── monitoring/                         \\(Admin dashboard\\)\n│   └── dashboard.html\n│\n├── audio/                              \\(Audio files\\)\n│   └── pnptv-background.mp3\n│\n└── uploads/\n    └── podcasts/                       \\(User podcast uploads\\)\n```\n\n---\n\n## 18. API REQUEST EXAMPLES\n\n### Get Payment Info\n```\nGET /api/payment/PAY-ABC123\nResponse: { success, payment: { paymentId, amount, provider, ... } }\n```\n\n### Process Tokenized Charge\n```\nPOST /api/payment/tokenized-charge\nBody: { paymentId, cardNumber, expYear, expMonth, cvc, name, email, ... }\n```\n\n### Get Radio Now Playing\n```\nGET /api/radio/now-playing\nResponse: { track: { title, artist, thumbnailUrl }, listenerCount }\n```\n\n### List Media Library\n```\nGET /api/media/library?type=all&category=music&limit=50\nResponse: { success, data: [...], count }\n```\n\n### Create Playlist\n```\nPOST /api/playlists\nBody: { name, description, isPublic }\n```\n\n### Join Hangout Call\n```\nPOST /api/hangouts/join/CALL_ID\nResponse: { success, callInfo, ... }\n```\n\n---\n\n## SUMMARY STATISTICS\n\n- **Total Express Routes:** 80+ endpoints\n- **Total HTML Pages:** 28 files\n- **Protected Routes:** 4 \\(require authentication\\)\n- **Public SPA Apps:** 6 \\(Videorama, Hangouts, Live, Radio, Materialious, Monitoring\\)\n- **API Endpoint Groups:** 12 categories\n- **Webhook Handlers:** 4 \\(ePayco, Daimo, Visa, Telegram\\)\n- **Domain Configurations:** 3 \\(pnptv.app, easybots.store, easybots.site\\)\n- **Rate Limited Endpoints:** 3 groups\n- **Static File Types:** 7 \\(HTML, JS, CSS, PNG, JPG, GIF, SVG, WEBP, WOFF, etc.\\)\n\nEOF)",
      "WebFetch(domain:blog.epayco.com)",
      "Bash(npx jest --passWithNoTests --forceExit --detectOpenHandles)",
      "Bash(set:*)",
      "Bash(npx dotenv:*)",
      "Bash(node -e \"require\\(''''dotenv''''\\).config\\(\\)\")",
      "Bash(xargs ls:*)",
      "Bash(rsync:*)",
      "WebFetch(domain:epayco.co)",
      "Bash(python3 -c \"\nimport sys, re\ncode = sys.stdin.read\\(\\)\n# Find token.create or create method\nmatches = re.findall\\(r''''.{0,100}token.{0,200}'''', code\\)\nfor m in matches[:5]:\n    print\\(m[:200]\\)\n    print\\(''''---''''\\)\n\")",
      "Bash(npm view:*)",
      "Bash(sudo sed:*)",
      "Bash(curl -s https://easybots.site/payment/test-123)",
      "Bash(curl -sI https://easybots.site/payment/test-123)",
      "Bash(git -C /root/pnptvbot-production log --oneline -5)",
      "Bash(git -C /root/pnptvbot-production push origin main)",
      "Bash(git -C /root/pnptvbot-production diff --stat)",
      "Bash(git -C /root/pnptvbot-production add .claude/settings.local.json public/daimo-checkout.html public/index.html public/meet-greet-checkout.html public/meet-greet-daimo-checkout.html public/pnp-live-checkout.html public/pnp-live-daimo-checkout.html public/recurring-checkout.html public/youtube-playlist.html)",
      "Bash(git -C /root/pnptvbot-production commit -m \"$\\(cat <<''EOF''\nUpdate checkout pages and public HTML assets\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(PGPASSWORD=\"2P15LqNF1hucUilg7ramfZJE9z2T4QUV\" psql:*)",
      "Bash(certbot certificates:*)",
      "Bash(for cert in /etc/letsencrypt/live/*/fullchain.pem)",
      "Bash(do echo 'Cert: $\\(dirname $cert\\)')",
      "Bash(openssl x509:*)",
      "Bash(certbot certonly:*)",
      "Bash(API_TOKEN=\"8fb541327b0751dca039f783a1adf40b1abc08bf671fdb58788a3961b9a2fdbd\" curl -s \"https://easybots.qatouch.com/api/v1/projects\" -H \"Authorization: Bearer $API_TOKEN\")",
      "Bash(API_TOKEN=\"8fb541327b0751dca039f783a1adf40b1abc08bf671fdb58788a3961b9a2fdbd\" __NEW_LINE_95296467a60f3a3c__ echo \"Testing various API endpoints...\" echo -e \"\\\\n=== Checking API status ===\" curl -s \"https://easybots.qatouch.com/api/v1/status\" -H \"Authorization: Bearer $API_TOKEN\")",
      "Bash(/tmp/test_qatouch.sh << 'SCRIPT'\n#!/bin/bash\nAPI_TOKEN=\"8fb541327b0751dca039f783a1adf40b1abc08bf671fdb58788a3961b9a2fdbd\"\nBASE_URL=\"https://easybots.qatouch.com\"\n\necho \"=== QATouch API Test Runner ===\"\necho \"Testing pnptvbot and ePayco integration\"\necho \"\"\n\n# Test 1: Run tests for pnptvbot\necho \"1. Running pnptvbot tests...\"\ncurl -s -X POST \"$BASE_URL/api/v1/run-tests\" \\\\\n  -H \"Authorization: Bearer $API_TOKEN\" \\\\\n  -H \"Content-Type: application/json\" \\\\\n  -d '{\"project\":\"pnptvbot\"}' > /tmp/pnptvbot_results.json 2>&1\n  \necho \"Response: $\\(cat /tmp/pnptvbot_results.json\\)\"\n\n# Test 2: Run tests for ePayco\necho \"\"\necho \"2. Running ePayco integration tests...\"\ncurl -s -X POST \"$BASE_URL/api/v1/run-tests\" \\\\\n  -H \"Authorization: Bearer $API_TOKEN\" \\\\\n  -H \"Content-Type: application/json\" \\\\\n  -d '{\"project\":\"epayco\",\"module\":\"payment\"}' > /tmp/epayco_results.json 2>&1\n  \necho \"Response: $\\(cat /tmp/epayco_results.json\\)\"\n\n# Test 3: Get test results\necho \"\"\necho \"3. Fetching test results...\"\ncurl -s -X GET \"$BASE_URL/api/v1/test-results\" \\\\\n  -H \"Authorization: Bearer $API_TOKEN\" > /tmp/test_results.json 2>&1\n  \necho \"Results: $\\(cat /tmp/test_results.json\\)\"\nSCRIPT)",
      "Bash(__NEW_LINE_6b2e704ce54b50c8__ bash /tmp/test_qatouch.sh)",
      "Bash(/tmp/qatouch_alt.sh << 'SCRIPT'\n#!/bin/bash\nTOKEN=\"8fb541327b0751dca039f783a1adf40b1abc08bf671fdb58788a3961b9a2fdbd\"\nBASE=\"https://easybots.qatouch.com\"\n\necho \"=== Attempting QATouch API with alternative methods ===\"\n\n# Try 1: Token as query parameter\necho \"1. Trying token as query parameter...\"\ncurl -s \"$BASE/api/v1/tests?token=$TOKEN\" -w \"\\\\nHTTP Status: %{http_code}\\\\n\" 2>&1 | head -20\n\n# Try 2: Different auth header format\necho -e \"\\\\n2. Trying custom X-API-Token header...\"\ncurl -s -X GET \"$BASE/api/v1/tests\" \\\\\n  -H \"X-API-Token: $TOKEN\" \\\\\n  -w \"\\\\nHTTP Status: %{http_code}\\\\n\" 2>&1 | head -20\n\n# Try 3: Direct integration test\necho -e \"\\\\n3. Testing ePayco webhook endpoint...\"\ncurl -s -X POST \"$BASE/api/payment/test\" \\\\\n  -H \"Content-Type: application/json\" \\\\\n  -H \"X-API-Key: $TOKEN\" \\\\\n  -d '{\"provider\":\"epayco\",\"test\":\"webhook\"}' \\\\\n  -w \"\\\\nHTTP Status: %{http_code}\\\\n\" 2>&1 | head -20\n\n# Try 4: Check if it's a dashboard URL\necho -e \"\\\\n4. Checking dashboard...\"\ncurl -s \"$BASE/dashboard?token=$TOKEN\" \\\\\n  -w \"\\\\nHTTP Status: %{http_code}\\\\n\" 2>&1 | head -10\nSCRIPT)",
      "Bash(__NEW_LINE_cedc171034be12f6__ bash /tmp/qatouch_alt.sh)",
      "Bash(/tmp/qatouch_key_test.sh << 'SCRIPT'\n#!/bin/bash\nKEY=\"8fb541327b0751dca039f783a1adf40b1abc08bf671fdb58788a3961b9a2fdbd\"\nBASE=\"https://easybots.qatouch.com\"\n\necho \"=== QATouch Testing with API Key ===\"\necho \"Key: ${KEY:0:20}...\"\necho \"\"\n\n# Test 1: Try as Bearer token with different header case\necho \"1. Testing with Authorization header \\(Bearer\\)...\"\ncurl -s -X GET \"$BASE/api/v1/projects\" \\\\\n  -H \"authorization: Bearer $KEY\" \\\\\n  -H \"User-Agent: Mozilla/5.0\" \\\\\n  -w \"\\\\nStatus: %{http_code}\\\\n\" 2>&1 | grep -A 5 \"Status:\"\n\n# Test 2: Try as API key header\necho -e \"\\\\n2. Testing with X-API-Key header...\"\ncurl -s -X GET \"$BASE/api/v1/projects\" \\\\\n  -H \"X-API-Key: $KEY\" \\\\\n  -H \"User-Agent: Mozilla/5.0\" \\\\\n  -w \"\\\\nStatus: %{http_code}\\\\n\" 2>&1 | grep -A 5 \"Status:\"\n\n# Test 3: Try as access token\necho -e \"\\\\n3. Testing with access_token parameter...\"\ncurl -s \"$BASE/api/v1/projects?access_token=$KEY\" \\\\\n  -H \"User-Agent: Mozilla/5.0\" \\\\\n  -w \"\\\\nStatus: %{http_code}\\\\n\" 2>&1 | grep -A 5 \"Status:\"\n\n# Test 4: POST request to run tests\necho -e \"\\\\n4. Running pnptvbot tests...\"\ncurl -s -X POST \"$BASE/api/v1/tests/run\" \\\\\n  -H \"X-API-Key: $KEY\" \\\\\n  -H \"Content-Type: application/json\" \\\\\n  -H \"User-Agent: Mozilla/5.0\" \\\\\n  -d '{\"project\":\"pnptvbot\",\"tests\":\"all\"}' \\\\\n  -w \"\\\\nStatus: %{http_code}\\\\n\" 2>&1 | head -30\n\n# Test 5: Try ePayco tests\necho -e \"\\\\n5. Running ePayco integration tests...\"\ncurl -s -X POST \"$BASE/api/v1/tests/run\" \\\\\n  -H \"X-API-Key: $KEY\" \\\\\n  -H \"Content-Type: application/json\" \\\\\n  -H \"User-Agent: Mozilla/5.0\" \\\\\n  -d '{\"project\":\"epayco\",\"module\":\"payment\",\"tests\":\"integration\"}' \\\\\n  -w \"\\\\nStatus: %{http_code}\\\\n\" 2>&1 | head -30\n\n# Test 6: Get test results\necho -e \"\\\\n6. Fetching test results...\"\ncurl -s -X GET \"$BASE/api/v1/tests/results\" \\\\\n  -H \"X-API-Key: $KEY\" \\\\\n  -H \"User-Agent: Mozilla/5.0\" \\\\\n  -w \"\\\\nStatus: %{http_code}\\\\n\" 2>&1 | head -30\nSCRIPT)",
      "Bash(__NEW_LINE_52637d2b5d89a2c6__ bash /tmp/qatouch_key_test.sh)",
      "Bash(/root/pnptvbot-production/tests/integration-tests.js << 'EOF'\n/**\n * Integration Tests for pnptvbot and ePayco\n * Tests: Database, Bot, Payment Processing, Webhooks\n */\n\nconst http = require\\('http'\\);\nconst assert = require\\('assert'\\);\n\nconst BASE_URL = 'http://localhost:3000';\nconst TESTS = [];\nlet passedTests = 0;\nlet failedTests = 0;\n\n// Helper function to make HTTP requests\nfunction makeRequest\\(method, path, body = null, headers = {}\\) {\n  return new Promise\\(\\(resolve, reject\\) => {\n    const url = new URL\\(path, BASE_URL\\);\n    const options = {\n      hostname: url.hostname,\n      port: url.port || 3000,\n      path: url.pathname + url.search,\n      method: method,\n      headers: {\n        'Content-Type': 'application/json',\n        ...headers\n      }\n    };\n\n    const req = http.request\\(options, \\(res\\) => {\n      let data = '';\n      res.on\\('data', chunk => data += chunk\\);\n      res.on\\('end', \\(\\) => {\n        resolve\\({\n          status: res.statusCode,\n          headers: res.headers,\n          body: data ? JSON.parse\\(data\\) : null\n        }\\);\n      }\\);\n    }\\);\n\n    req.on\\('error', reject\\);\n    if \\(body\\) req.write\\(JSON.stringify\\(body\\)\\);\n    req.end\\(\\);\n  }\\);\n}\n\n// Test 1: Health Check\nTESTS.push\\({\n  name: 'Bot Health Check',\n  run: async \\(\\) => {\n    const res = await makeRequest\\('GET', '/health'\\);\n    assert.strictEqual\\(res.status, 200, 'Health check should return 200'\\);\n    assert\\(res.body, 'Response should have body'\\);\n  }\n}\\);\n\n// Test 2: User Creation\nTESTS.push\\({\n  name: 'User Creation via API',\n  run: async \\(\\) => {\n    const res = await makeRequest\\('POST', '/api/users', {\n      telegram_id: '12345',\n      first_name: 'Test',\n      last_name: 'User',\n      username: 'testuser'\n    }\\);\n    assert.strictEqual\\(res.status, 200 || 201, 'User creation should succeed'\\);\n  }\n}\\);\n\n// Test 3: ePayco Payment Webhook\nTESTS.push\\({\n  name: 'ePayco Payment Webhook',\n  run: async \\(\\) => {\n    const res = await makeRequest\\('POST', '/api/webhooks/epayco', {\n      x_transaction_id: 'test_12345',\n      x_amount: '100.00',\n      x_currency_code: 'USD',\n      x_signature: 'test_signature',\n      x_ref_payco: 'test_ref',\n      x_customer_email: 'test@example.com'\n    }\\);\n    assert\\(res.status >= 200 && res.status < 300, 'Webhook should be accepted'\\);\n  }\n}\\);\n\n// Test 4: Payment Confirmation\nTESTS.push\\({\n  name: 'Payment Confirmation Processing',\n  run: async \\(\\) => {\n    const res = await makeRequest\\('POST', '/api/payments/confirm', {\n      transaction_id: 'test_12345',\n      user_id: '123',\n      amount: 100,\n      provider: 'epayco'\n    }\\);\n    assert\\(res.status >= 200 && res.status < 300, 'Payment confirmation should succeed'\\);\n  }\n}\\);\n\n// Test 5: Telegram Bot Command\nTESTS.push\\({\n  name: 'Telegram /start Command',\n  run: async \\(\\) => {\n    const res = await makeRequest\\('POST', '/webhook/telegram', {\n      update_id: 123456,\n      message: {\n        message_id: 1,\n        date: Math.floor\\(Date.now\\(\\) / 1000\\),\n        chat: {\n          id: 123456,\n          type: 'private'\n        },\n        from: {\n          id: 123456,\n          is_bot: false,\n          first_name: 'Test'\n        },\n        text: '/start'\n      }\n    }\\);\n    assert\\(res.status >= 200 && res.status < 300, 'Bot webhook should accept /start'\\);\n  }\n}\\);\n\n// Test 6: Database Connection\nTESTS.push\\({\n  name: 'Database Connection',\n  run: async \\(\\) => {\n    const res = await makeRequest\\('GET', '/api/database/health'\\);\n    assert\\(res.status === 200 || res.status === 404, 'Database endpoint check'\\);\n  }\n}\\);\n\n// Test 7: API Rate Limiting\nTESTS.push\\({\n  name: 'API Rate Limiting',\n  run: async \\(\\) => {\n    // Make multiple requests\n    const promises = [];\n    for \\(let i = 0; i < 5; i++\\) {\n      promises.push\\(makeRequest\\('GET', '/health'\\)\\);\n    }\n    const results = await Promise.all\\(promises\\);\n    assert\\(results.every\\(r => r.status === 200\\), 'Rate limiting should allow bulk requests'\\);\n  }\n}\\);\n\n// Test 8: ePayco Signature Verification\nTESTS.push\\({\n  name: 'ePayco Signature Validation',\n  run: async \\(\\) => {\n    const res = await makeRequest\\('POST', '/api/webhooks/epayco', {\n      x_transaction_id: 'sig_test_123',\n      x_signature: 'invalid_signature_test'\n    }\\);\n    // Should reject or validate signature\n    assert\\(res.status === 200 || res.status === 400 || res.status === 401, \n      'Should handle signature validation'\\);\n  }\n}\\);\n\n// Test 9: User Plan Upgrade\nTESTS.push\\({\n  name: 'User Plan Upgrade',\n  run: async \\(\\) => {\n    const res = await makeRequest\\('POST', '/api/users/upgrade-plan', {\n      user_id: '123',\n      new_plan: 'premium',\n      payment_method: 'epayco'\n    }\\);\n    assert\\(res.status >= 200 && res.status < 300, 'Plan upgrade should succeed'\\);\n  }\n}\\);\n\n// Test 10: Telegram Update Handling\nTESTS.push\\({\n  name: 'Telegram Update Handler',\n  run: async \\(\\) => {\n    const res = await makeRequest\\('POST', '/webhook/telegram', {\n      update_id: 999,\n      message: {\n        message_id: 99,\n        date: Math.floor\\(Date.now\\(\\) / 1000\\),\n        chat: { id: 999, type: 'private' },\n        from: { id: 999, is_bot: false, first_name: 'Test' },\n        text: '/help'\n      }\n    }\\);\n    assert\\(res.status >= 200 && res.status < 300, 'Bot should handle /help command'\\);\n  }\n}\\);\n\n// Run all tests\nasync function runAllTests\\(\\) {\n  console.log\\('\\\\n╔════════════════════════════════════════════════════════════════╗'\\);\n  console.log\\('║     Integration Tests: pnptvbot + ePayco                       ║'\\);\n  console.log\\('╚════════════════════════════════════════════════════════════════╝\\\\n'\\);\n\n  for \\(const test of TESTS\\) {\n    try {\n      console.log\\(`⏳ Running: ${test.name}...`\\);\n      await test.run\\(\\);\n      console.log\\(`✅ PASSED: ${test.name}\\\\n`\\);\n      passedTests++;\n    } catch \\(error\\) {\n      console.log\\(`❌ FAILED: ${test.name}`\\);\n      console.log\\(`   Error: ${error.message}\\\\n`\\);\n      failedTests++;\n    }\n  }\n\n  console.log\\('╔════════════════════════════════════════════════════════════════╗'\\);\n  console.log\\(`║ Results: ${passedTests} passed, ${failedTests} failed out of ${TESTS.length} tests         ║`\\);\n  console.log\\('╚════════════════════════════════════════════════════════════════╝\\\\n'\\);\n\n  process.exit\\(failedTests > 0 ? 1 : 0\\);\n}\n\n// Start tests\nrunAllTests\\(\\).catch\\(console.error\\);\nEOF)",
      "Bash(__NEW_LINE_67b667668927804d__ echo \"✓ Integration test suite created\")",
      "WebFetch(domain:qatouchautomatesupport.qatouch.com)",
      "Bash(xargs kill -9)",
      "Bash(pm2 resurrect:*)",
      "Bash(# Kill all connections\nPGPASSWORD=\"\"2P15LqNF1hucUilg7ramfZJE9z2T4QUV\"\" psql -h localhost -U pnptvbot -d pnptvbot << 'SQL'\nSELECT pg_terminate_backend\\(pid\\) FROM pg_stat_activity WHERE datname = 'pnptvbot' AND pid <> pg_backend_pid\\(\\);\nSQL\n\nsleep 2\n\n# Kill PM2 completely\npm2 kill\n\nsleep 3\n\n# Restart\npm2 start ecosystem.config.js --env production\nsleep 8\n\necho \"\"=== Bot Status ===\"\" && pm2 list && echo \"\"\"\" && echo \"\"=== Errors ===\"\" && tail -5 /root/pnptvbot-production/logs/error-2026-02-10.log 2>/dev/null | jq -r ''.message'' 2>/dev/null || echo \"\"No new errors!\"\")",
      "Bash(PGPASSWORD=\"Apelo801050#\" psql:*)"
    ],
    "deny": [],
    "ask": []
  }
}
